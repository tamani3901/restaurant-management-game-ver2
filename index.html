<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£²é£Ÿåº—çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ v1.4</title>
<style>
    :root {
        --bg-color: #2c3e50;
        --panel-color: #34495e;
        --text-color: #ecf0f1;
        --accent-color: #e74c3c;
        --success-color: #2ecc71;
        --warning-color: #f1c40f;
        --info-color: #3498db;
    }
    body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; overflow: hidden; }
    button { cursor: pointer; padding: 8px 12px; border: none; border-radius: 5px; background: var(--accent-color); color: white; font-weight: bold; margin: 3px; transition: 0.2s; font-size: 0.9rem;}
    button:hover { opacity: 0.8; }
    button:disabled { background: #7f8c8d; cursor: not-allowed; opacity: 0.6; }
    input, select { padding: 8px; border-radius: 5px; border: none; margin: 5px; color:#333; }

    /* ç”»é¢ãƒ¢ãƒ¼ãƒ‰ */
    #game-container.pc-mode { max-width: 1024px; margin: 0 auto; border: 2px solid #7f8c8d; height: 100vh; display: flex; flex-direction: column; }
    #game-container.mobile-mode { max-width: 450px; margin: 0 auto; border: 2px solid #7f8c8d; height: 100vh; display: flex; flex-direction: column; }

    /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆ */
    .screen { display: none; height: 100%; flex-direction: column; padding: 20px; overflow-y: auto; }
    .screen.active { display: flex; }

    /* ãƒ›ãƒ¼ãƒ ç”»é¢ */
    .home-btn-group { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 50px; }
    h1 { text-align: center; color: var(--warning-color); }

    /* ã‚²ãƒ¼ãƒ ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    #ui-header { display: flex; flex-wrap: wrap; justify-content: space-between; background: #1a252f; padding: 10px; align-items: center; font-size: 0.8rem; }
    #info-bar { text-align: center; font-weight: bold; flex-grow: 1; margin: 0 10px; }
    #main-area { flex: 1; position: relative; background: #ecf0f1; color: #333; padding: 10px; overflow: hidden; }
    
    /* å®¢å¸­ã‚¨ãƒªã‚¢ */
    #seats-container { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); padding: 10px; }
    .seat { background: #bdc3c7; border-radius: 8px; padding: 10px; text-align: center; position: relative; height: 80px; border: 2px solid #7f8c8d; }
    .seat.occupied { background: #f39c12; border-color: #d35400; }
    .seat-status { font-size: 10px; position: absolute; bottom: 2px; left: 0; width: 100%; }

    /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—/ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
    .modal-content { background: var(--panel-color); padding: 20px; border-radius: 10px; max-width: 90%; color: white; text-align: center; max-height: 90vh; overflow-y: auto; width: 650px; }
    
    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    table.help-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 0.9rem; color: #ecf0f1; }
    table.help-table th, table.help-table td { border: 1px solid #7f8c8d; padding: 6px; text-align: left; }
    table.help-table th { background: #2980b9; }
    h4 { margin-top: 20px; margin-bottom: 5px; border-left: 4px solid var(--warning-color); padding-left: 10px; text-align: left; }

    /* æ³¨æ–‡ç”»é¢ */
    #order-modal-content img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid white; }
    .speech-bubble { background: white; color: black; padding: 15px; border-radius: 20px; margin: 10px 0; position: relative; font-weight: bold; max-width: 80%; margin-left: auto; margin-right: auto; }
    .speech-bubble:after { content: ''; position: absolute; top: -10px; left: 50%; border-width: 10px; border-style: solid; border-color: transparent transparent white transparent; margin-left: -10px; }

    /* è¨­å®šãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆ */
    .item-list { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
    .item-select { background: #2980b9; padding: 5px; border-radius: 3px; font-size: 0.8rem; cursor: pointer; }
    .item-select.selected { background: #2ecc71; border: 2px solid white; }
    
    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†ç”¨ãƒªã‚¹ãƒˆ */
    .menu-edit-row { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); margin: 2px 0; padding: 4px; border-radius: 4px; }
    .menu-edit-row input[type="number"] { width: 70px; padding: 4px; }
    .menu-edit-row input[type="checkbox"] { transform: scale(1.2); }

    /* å¾“æ¥­å“¡ç®¡ç†ç”¨ */
    .emp-row { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 5px; margin: 2px 0; border-radius: 4px; }
    .emp-row button { padding: 2px 8px; font-size: 0.8rem; background: #c0392b; margin: 0; }

    /* ãƒ†ãƒ­ãƒƒãƒ— */
    #ticker { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8); color: #0f0; padding: 5px; white-space: nowrap; overflow: hidden; font-family: 'Courier New', monospace; z-index: 900; height: 25px; line-height: 25px; }
</style>
</head>
<body>

<div id="game-container" class="pc-mode">
    
    <div id="ticker">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•: æº–å‚™å®Œäº†...</div>

    <div id="screen-home" class="screen active">
        <h1>ğŸ” Kitchen Tycoon ğŸ</h1>
        <div class="home-btn-group">
            <button onclick="game.showSetup()">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</button>
            <input type="file" id="save-file-input" style="display:none" onchange="game.loadGameData(this)">
            <button onclick="document.getElementById('save-file-input').click()">ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</button>
            <a href="https://tamani3901.github.io/ti-tobann/" target="_blank">
                <button style="background:#8e44ad;">ãƒãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸</button>
            </a>
        </div>
    </div>

    <div id="screen-setup" class="screen">
        <h2>æ–°è¦åº—èˆ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>
        
        <label>åº—ã®ç¨®é¡:</label>
        <select id="setup-type" onchange="setup.updateMenuOptions()">
            <option value="fastfood">ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</option>
            <option value="restaurant">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</option>
        </select>

        <label>å ´æ‰€:</label>
        <select id="setup-location" onchange="setup.updateSizeOptions()">
            <option value="big_city">å¤§éƒ½å¸‚ (MAX 10å¸­)</option>
            <option value="city">éƒ½å¸‚éƒ¨ (MAX 8å¸­)</option>
            <option value="mid_city">ä¸­éƒ½å¸‚ (MAX 6å¸­)</option>
            <option value="small_city">å°éƒ½å¸‚ (MAX 4å¸­)</option>
        </select>

        <label>åˆæœŸå¸­æ•°:</label>
        <select id="setup-seats"></select>

        <label>é›£æ˜“åº¦:</label>
        <select id="setup-difficulty">
            <option value="hard">é›£ã—ã„ (1500ä¸‡, â˜…3.5ä»¥ä¸‹å³æ­»)</option>
            <option value="normal" selected>æ™®é€š (500ä¸‡)</option>
            <option value="easy">ç°¡å˜ (æ¡ä»¶ãªã—)</option>
        </select>

        <label>åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ (5ã¤é¸æŠ):</label>
        <div id="setup-menu-list" class="item-list"></div>

        <div style="margin-top: 20px; text-align: center;">
            <button onclick="game.startGame()">é–‹åº—ã™ã‚‹</button>
            <button onclick="game.showHome()" style="background:#7f8c8d;">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div id="ui-header">
            <div style="display:flex; gap:2px;">
                <button onclick="ui.toggleMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
                <button onclick="ui.toggleSettings()">è¨­å®š</button>
                <button onclick="ui.toggleHelp()" style="background:var(--info-color);">èª¬æ˜æ›¸</button>
            </div>
            <div id="info-bar">
                <span id="display-time">Day 1 (æœˆ) 9:00</span><br>
                <span id="display-money">Â¥15,000,000</span> | <span id="display-stars">â˜…â˜…â˜…â˜…â˜…</span>
            </div>
            <div style="display:flex; align-items:center;">
                <div style="text-align:right; margin-right:5px; font-size:0.7rem;">
                    <span id="ad-buff-display" style="color:var(--success-color); font-weight:bold;">å®£ä¼: +0%</span>
                </div>
                <button onclick="ui.toggleAds()">å®£ä¼</button>
                <span id="display-assets" style="margin-left:5px; font-size:0.8rem;">è³‡ç”£</span>
            </div>
        </div>

        <div id="main-area">
            <div id="seats-container"></div>
        </div>
    </div>

</div>

<div id="modal-order" class="modal-overlay">
    <div class="modal-content" id="order-modal-content">
        <img id="order-customer-img" src="" alt="Customer">
        <div class="speech-bubble" id="order-text">æ³¨æ–‡å†…å®¹...</div>
        <button onclick="game.confirmOrder()">äº†è§£</button>
    </div>
</div>

<div id="modal-menu" class="modal-overlay">
    <div class="modal-content">
        <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
        <button onclick="ui.closeModal('modal-menu')">æˆ»ã‚‹</button>
        <button onclick="game.togglePause()">ä¸€æ™‚åœæ­¢/å†é–‹</button>
        <button onclick="game.saveGame()">ã‚»ãƒ¼ãƒ– (ä¿å­˜)</button>
        <button onclick="game.quitGame()" style="background:#c0392b;">ã‚„ã‚ã‚‹</button>
    </div>
</div>

<div id="modal-help" class="modal-overlay">
    <div class="modal-content" style="text-align: left;">
        <h2 style="text-align:center;">ğŸ“– ã‚²ãƒ¼ãƒ èª¬æ˜æ›¸</h2>
        
        <h4>ğŸ“¢ å®£ä¼ã®åŠ¹æœ (é‡ã­ãŒã‘å¯èƒ½ï¼)</h4>
        <table class="help-table">
            <tr><th>ç¨®é¡</th><th>è²»ç”¨</th><th>åŠ¹æœ</th><th>æŒç¶šæœŸé–“</th></tr>
            <tr><td>ãƒã‚¹ã‚¿ãƒ¼</td><td>Â¥7,000</td><td>å®¢+15% (çµ‚äº†å¾Œ+5%)</td><td>2æ—¥é–“</td></tr>
            <tr><td>ãƒãƒ©ã‚·</td><td>Â¥10,000</td><td>å®¢+20% (çµ‚äº†å¾Œ+5%)</td><td>2æ—¥é–“</td></tr>
            <tr><td>CMæ”¾é€</td><td>Â¥50,000</td><td>å®¢+25% (çµ‚äº†å¾Œ+20%)</td><td>10æ—¥é–“</td></tr>
            <tr><td>TVç•ªçµ„</td><td>Â¥100,000</td><td>å®¢+25% (çµ‚äº†å¾Œ+40%)</td><td>1æ—¥</td></tr>
        </table>

        <h4>ğŸ§‘â€ğŸ³ å¾“æ¥­å“¡ã®èƒ½åŠ›ã¨è²»ç”¨</h4>
        <table class="help-table">
            <tr><th>ãƒ©ãƒ³ã‚¯</th><th>å¥‘ç´„é‡‘</th><th>æä¾›é€Ÿåº¦(å€ç‡)</th><th>æä¾›æ™‚é–“ç›®å®‰</th></tr>
            <tr><td>ãƒã‚¹ã‚¿ãƒ¼</td><td>Â¥20ä¸‡</td><td>2.5å€</td><td>4ç§’</td></tr>
            <tr><td>ãƒ™ãƒ†ãƒ©ãƒ³</td><td>Â¥12ä¸‡</td><td>1.6å€</td><td>6.25ç§’</td></tr>
            <tr><td>æ¨™æº–</td><td>Â¥8ä¸‡</td><td>1.0å€</td><td>10ç§’</td></tr>
            <tr><td>ãƒãƒ³ã‚³ãƒ„</td><td>Â¥4ä¸‡</td><td>0.5å€</td><td>20ç§’</td></tr>
        </table>

        <h4>ğŸ˜Š å®¢ã®æº€è¶³åº¦ã¨è©•ä¾¡</h4>
        <p style="font-size:0.8rem; margin-bottom:10px;">
            æä¾›é€Ÿåº¦ã«ã‚ˆã£ã¦æº€è¶³åº¦ãŒæ±ºã¾ã‚Šã¾ã™ã€‚<br>
            æº€è¶³åº¦ãŒ100ã«è¿‘ã„ã»ã©ã€åº—ã®â˜…è©•ä¾¡ãŒä¸ŠãŒã‚Šã¾ã™ã€‚<br>
            è©•ä¾¡ãŒä¸‹ãŒã‚‹ã¨æ¥åº—å®¢æ•°ãŒæ¿€æ¸›ã—ã¾ã™ã€‚
        </p>

        <h4>ğŸ—ï¸ åº—èˆ—æ‹¡å¼µ</h4>
        <ul style="font-size:0.9rem; padding-left:20px;">
            <li><strong>15å¸­ã¸æ‹¡å¼µ:</strong> ç´¯è¨ˆåˆ©ç›ŠãŒ10ä¸‡å††ã‚’è¶…ãˆã‚‹ã¨è§£ç¦ã€‚</li>
            <li><strong>20å¸­ã¸æ‹¡å¼µ:</strong> ç´¯è¨ˆåˆ©ç›ŠãŒ20ä¸‡å††ã‚’è¶…ãˆã‚‹ã¨è§£ç¦ã€‚</li>
        </ul>

        <div style="text-align:center; margin-top:20px;">
            <button onclick="ui.closeModal('modal-help')">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<div id="modal-settings" class="modal-overlay">
    <div class="modal-content">
        <h3>åº—èˆ—è¨­å®š</h3>
        <button onclick="ui.toggleMode()">ã‚¹ãƒãƒ›/PCãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</button>
        <hr>
        
        <h4>ğŸ—ï¸ åº—èˆ—æ‹¡å¼µãƒªãƒ•ã‚©ãƒ¼ãƒ </h4>
        <div style="display:flex; justify-content:center; gap:10px;">
            <button id="btn-expand-15" onclick="settings.expandSeats(15)" disabled>15å¸­ã«æ‹¡å¼µ</button>
            <button id="btn-expand-20" onclick="settings.expandSeats(20)" disabled>20å¸­ã«æ‹¡å¼µ</button>
        </div>
        <p style="font-size:0.8rem; color:#f1c40f;">
            â€»15å¸­(ç´¯è¨ˆåˆ©ç›Š10ä¸‡ä»¥ä¸Š) / 20å¸­(ç´¯è¨ˆåˆ©ç›Š20ä¸‡ä»¥ä¸Š)
        </p>

        <hr>
        
        <h4>é›‡ç”¨ã‚»ãƒ³ã‚¿ãƒ¼ (å¥‘ç´„é‡‘)</h4>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <button onclick="settings.hire('master')">ãƒã‚¹ã‚¿ãƒ¼ (20ä¸‡)</button>
            <button onclick="settings.hire('veteran')">ãƒ™ãƒ†ãƒ©ãƒ³ (12ä¸‡)</button>
            <button onclick="settings.hire('standard')">æ¨™æº– (8ä¸‡)</button>
            <button onclick="settings.hire('ponkotsu')">ãƒãƒ³ã‚³ãƒ„ (4ä¸‡)</button>
        </div>
        
        <h4>ç¾åœ¨ã®å¾“æ¥­å“¡</h4>
        <div id="current-employees-list" style="max-height: 80px; overflow-y: auto; border:1px solid #7f8c8d; padding:5px; margin-bottom:10px;"></div>
        
        <hr>
        <button onclick="settings.toggleMenuEdit()" style="background:#2980b9; width:100%;">ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ä¾¡æ ¼ã®ç®¡ç†ã‚’é–‹ã</button>
        <div id="menu-edit-area" style="display:none; margin-top:10px; background:#2c3e50; padding:10px; border-radius:5px;">
            <p style="font-size:0.8rem; color:#f1c40f;">â€»5ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚ä¾¡æ ¼ã‚‚å¤‰æ›´å¯èƒ½ã§ã™ã€‚</p>
            <div id="menu-edit-list" style="max-height:200px; overflow-y:auto;"></div>
            <button onclick="settings.saveMenuChanges()" style="background:#2ecc71; width:100%; margin-top:5px;">å¤‰æ›´ã‚’é©ç”¨</button>
        </div>

        <hr>
        <div style="display:flex; justify-content:center; gap:10px;">
            <button id="btn-order-mode" onclick="settings.toggleOrderMode()">æ‰‹å‹•æ³¨æ–‡: OFF</button>
        </div>
        <div style="margin-top:5px;">
            <button onclick="settings.buyItem('trash')">ã‚´ãƒŸç®± (1ä¸‡)</button>
            <button onclick="settings.buyItem('clean')">æ¸…æƒ (5ä¸‡)</button>
        </div>
        <hr>
        <button onclick="ui.closeModal('modal-settings')">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-ads" class="modal-overlay">
    <div class="modal-content">
        <h3>å®£ä¼æ´»å‹•</h3>
        <p>ç¾åœ¨åŠ¹æœ: <span id="ad-status-detail" style="color:#2ecc71; font-weight:bold;">0%</span></p>
        <p style="font-size:0.8rem;">â€»åŠ¹æœã¯é‡è¤‡ï¼ˆé‡ã­ãŒã‘ï¼‰ã•ã‚Œã¾ã™ã€‚</p>
        <button onclick="ads.start('poster')">ãƒã‚¹ã‚¿ãƒ¼ (7,000å††)</button>
        <button onclick="ads.start('flyer')">ãƒãƒ©ã‚· (10,000å††)</button>
        <button onclick="ads.start('cm')">CM (50,000å††)</button>
        <button onclick="ads.start('tv')">TVç•ªçµ„ (100,000å††)</button>
        <br><br>
        <button onclick="ui.closeModal('modal-ads')">é–‰ã˜ã‚‹</button>
    </div>
</div>


<script>
/* =========================================
   ãƒ‡ãƒ¼ã‚¿å®šç¾©
   ========================================= */
const IMAGES = [
    "https://i.ibb.co/2YPFhJ1D/IMG-2529.jpg",
    "https://i.ibb.co/p6DSzpHQ/IMG-2529.jpg",
    "https://i.ibb.co/BHW5cMvS/IMG-2529.jpg",
    "https://i.ibb.co/7tjqbkkX/IMG-2529.jpg",
    "https://i.ibb.co/Xkkr114y/IMG-2529.jpg"
];

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
const MENUS = {
    fastfood: [
        {id: 'b_cheese', name: 'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼', price: 500},
        {id: 'b_teri', name: 'ãƒ†ãƒªãƒ¤ã‚­ãƒãƒ¼ã‚¬ãƒ¼', price: 500},
        {id: 'b_plain', name: 'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼', price: 500},
        {id: 'b_rice', name: 'ç„¼è‚‰ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚¬ãƒ¼', price: 500},
        {id: 'set_burger', name: 'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚»ãƒƒãƒˆ', price: 700},
        {id: 'set_potato', name: 'ãƒãƒ†ãƒˆã‚»ãƒƒãƒˆ', price: 600},
        {id: 'pot_s', name: 'ãƒãƒ†ãƒˆS', price: 200},
        {id: 'pot_m', name: 'ãƒãƒ†ãƒˆM', price: 300},
        {id: 'pot_l', name: 'ãƒãƒ†ãƒˆL', price: 450},
        {id: 'nugget', name: 'ãƒŠã‚²ãƒƒãƒˆ', price: 300},
        {id: 'shake_vanilla', name: 'ãƒãƒ‹ãƒ©ã‚·ã‚§ã‚¤ã‚¯', price: 300},
        {id: 'shake_strawberry', name: 'ã„ã¡ã”ã‚·ã‚§ã‚¤ã‚¯', price: 300},
        {id: 'juice_orange', name: 'ã‚ªãƒ¬ãƒ³ã‚¸ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 300},
        {id: 'juice_apple', name: 'ãƒªãƒ³ã‚´ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 300},
        {id: 'juice_cola', name: 'ã‚³ãƒ¼ãƒ©', price: 300},
        {id: 'juice_melon', name: 'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€', price: 300}
    ],
    restaurant: [
        {id: 'p_mar', name: 'ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿', price: 1200},
        {id: 'p_chs', name: 'ãƒãƒ¼ã‚ºãƒ”ã‚¶', price: 1200},
        {id: 'spa_nap', name: 'ãƒŠãƒãƒªã‚¿ãƒ³', price: 1000},
        {id: 'spa_tom', name: 'ãƒˆãƒãƒˆãƒ‘ã‚¹ã‚¿', price: 1000},
        {id: 'spa_car', name: 'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©', price: 1000},
        {id: 'pancake', name: 'ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­', price: 900},
        {id: 'hamburg', name: 'ãƒãƒ³ãƒãƒ¼ã‚°', price: 1300},
        {id: 'steak', name: 'ã‚¹ãƒ†ãƒ¼ã‚­', price: 1400},
        {id: 'salad', name: 'ã‚µãƒ©ãƒ€', price: 500},
        {id: 'potato', name: 'ãƒãƒ†ãƒˆ', price: 400},
        {id: 'parfait', name: 'ãƒ‘ãƒ•ã‚§', price: 700},
        {id: 'pudding', name: 'ãƒ—ãƒªãƒ³', price: 400},
        {id: 'rice', name: 'ã”é£¯', price: 350},
        {id: 'juice_org', name: 'ã‚ªãƒ¬ãƒ³ã‚¸ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 300},
        {id: 'juice_apl', name: 'ãƒªãƒ³ã‚´ã‚¸ãƒ¥ãƒ¼ã‚¹', price: 300},
        {id: 'juice_cal', name: 'ã‚«ãƒ«ãƒ”ã‚¹', price: 300},
        {id: 'juice_col', name: 'ã‚³ãƒ¼ãƒ©', price: 300},
        {id: 'juice_mel', name: 'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€', price: 300}
    ]
};

// å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿
const EMPLOYEES = {
    master: { name: 'ãƒã‚¹ã‚¿ãƒ¼', speed: 2.5, cost: 200000, wait: 4 }, 
    veteran: { name: 'ãƒ™ãƒ†ãƒ©ãƒ³', speed: 1.6, cost: 120000, wait: 6.25 },
    standard: { name: 'æ¨™æº–', speed: 1.0, cost: 80000, wait: 10 },
    ponkotsu: { name: 'ãƒãƒ³ã‚³ãƒ„', speed: 0.5, cost: 40000, wait: 20 }
};

const LOCATIONS = {
    big_city: { name: 'å¤§éƒ½å¸‚', max: 10, build: 3000000 },
    city: { name: 'éƒ½å¸‚éƒ¨', max: 8, build: 3000000 },
    mid_city: { name: 'ä¸­éƒ½å¸‚', max: 6, build: 2000000 },
    small_city: { name: 'å°éƒ½å¸‚', max: 4, build: 2000000 }
};

/* =========================================
   ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
   ========================================= */
let G = {
    mode: 'pc',
    state: 'home', 
    type: null, 
    location: null,
    maxSeats: 0,
    money: 15000000,
    totalEarnings: 0, 
    reputation: 5.0, 
    day: 1,
    time: 540, 
    weekDay: 0, 
    seats: [], 
    menu: [], 
    employees: ['master'], 
    manualOrder: false,
    difficulty: 'normal',
    activeAds: [], 
    bailoutUsed: false,
    trashBin: false,
    
    timerId: null,
    activeOrder: null
};

const DAYS = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];

/* =========================================
   ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
   ========================================= */
const game = {
    showHome: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-home').classList.add('active');
        G.state = 'home';
    },
    showSetup: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-setup').classList.add('active');
        setup.updateMenuOptions();
        setup.updateSizeOptions();
        G.state = 'setup';
    },
    startGame: () => {
        const selectedMenu = Array.from(document.querySelectorAll('.item-select.selected')).map(e => e.dataset.id);
        if (selectedMenu.length > 5) { alert('åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯5ã¤ã¾ã§ã§ã™'); return; }
        if (selectedMenu.length === 0) { alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„'); return; }

        G.type = document.getElementById('setup-type').value;
        const locKey = document.getElementById('setup-location').value;
        G.location = locKey;
        G.maxSeats = parseInt(document.getElementById('setup-seats').value);
        G.difficulty = document.getElementById('setup-difficulty').value;
        G.menu = selectedMenu;
        G.money = 15000000 - 3000000; 
        if (G.difficulty === 'hard') G.money = 15000000 - 3000000; 
        
        if (G.maxSeats > 8) G.money -= 3000000;
        else if (G.maxSeats > 4) G.money -= 2000000;

        G.employees = ['master']; 
        G.reputation = 5.0;
        G.day = 1;
        G.time = 540;
        G.weekDay = 0;
        G.seats = Array(G.maxSeats).fill(null).map(() => ({ occupied: false, customer: null, status: 'empty', waitTime: 0 }));
        G.totalEarnings = 0;
        G.activeAds = []; 

        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-game').classList.add('active');
        G.state = 'playing';
        ui.renderSeats();
        ui.updateHeader();
        ui.ticker("æœ¬æ—¥ã‚‚é–‹åº—ã§ã™ï¼");

        if (G.timerId) clearInterval(G.timerId);
        G.timerId = setInterval(game.loop, 1000);
    },

    loop: () => {
        if (G.state !== 'playing') return;

        G.time += 5;
        if (G.time >= 1320) { 
            game.endDay();
            return;
        }
        ui.updateHeader();

        game.trySpawnCustomer();

        G.seats.forEach((seat, idx) => {
            if (!seat.occupied) return;
            const c = seat.customer;

            if (seat.status === 'sitting') {
                seat.status = 'ordering';
                if (c.isTablet || !G.manualOrder) {
                    setTimeout(() => game.processOrder(idx), 500); 
                } else {
                    ui.updateSeat(idx);
                    ui.ticker(`å¸­${idx+1}: æ³¨æ–‡ã‚’ãŠé¡˜ã„ã—ã¾ã™`);
                }
            } else if (seat.status === 'cooking') {
                seat.progress += 5;
                
                let bestEmp = { wait: 100 }; 
                if (G.employees.length > 0) {
                    bestEmp = G.employees.map(e => EMPLOYEES[e]).reduce((a,b) => a.speed > b.speed ? a : b);
                }
                
                // å“æ•°ã«å¿œã˜ã¦æ™‚é–“ãŒä¼¸ã³ã‚‹ (1å“ã«ã¤ã+20%ç¨‹åº¦)
                const itemCount = seat.customer.order.length;
                const itemPenalty = 1 + (itemCount - 1) * 0.2;
                const reqTime = ((bestEmp.wait * 60) / 5) * itemPenalty;
                
                seat.realWaitTime = (seat.realWaitTime || 0) + 1; 

                if (seat.progress >= reqTime) {
                    seat.status = 'eating';
                    seat.progress = 0;
                    const sec = seat.realWaitTime; 
                    let sat = 60;
                    if (sec <= 4) sat = 100;
                    else if (sec <= 6.25) sat = 75;
                    else if (sec <= 10) sat = 60;
                    else sat = 45;
                    
                    if (G.trashBin) sat += 5; 
                    seat.satisfaction = sat;
                    ui.updateSeat(idx);
                }
            } else if (seat.status === 'eating') {
                seat.progress += 5;
                if (seat.progress >= 30) { 
                    seat.status = 'paying';
                    game.processPayment(idx);
                }
            }
        });
    },

    trySpawnCustomer: () => {
        let rate = 10; 
        const h = Math.floor(G.time / 60);
        if ((h >= 11 && h < 13)) {
            rate += (G.weekDay >= 5) ? 30 : 10; 
        }
        if (G.weekDay >= 5) rate += 20;

        let adBuff = 0;
        G.activeAds.forEach(ad => {
            if (ad.daysLeft > 0) adBuff += ad.buff;
            else if (ad.afterDays > 0) adBuff += ad.afterBuff;
        });
        rate += adBuff;

        if (G.reputation < 1.5) rate *= 0.4;
        else if (G.reputation < 2.5) rate *= 0.6;
        else if (G.reputation < 3.5) rate *= 0.8;

        if (Math.random() * 100 < rate) {
            const emptyIdx = G.seats.findIndex(s => !s.occupied);
            if (emptyIdx !== -1) {
                const groupSize = Math.floor(Math.random() * 4) + 1;
                const isTablet = Math.random() > 0.5;
                const img = IMAGES[Math.floor(Math.random() * IMAGES.length)];
                
                G.seats[emptyIdx] = {
                    occupied: true,
                    status: 'sitting',
                    progress: 0,
                    realWaitTime: 0,
                    customer: { size: groupSize, isTablet: isTablet, img: img, order: [] }
                };
                ui.updateSeat(emptyIdx);
            }
        }
    },

    processOrder: (seatIdx) => {
        const seat = G.seats[seatIdx];
        if (!seat) return;
        
        const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
        
        // 1ï½5å“ã‚’ãƒ©ãƒ³ãƒ€ãƒ æ³¨æ–‡
        const count = Math.floor(Math.random() * 5) + 1; 
        const orderItems = [];
        for(let i=0; i<count; i++) {
            const item = menuList[Math.floor(Math.random() * menuList.length)];
            orderItems.push(item);
        }
        
        seat.customer.order = orderItems;
        seat.status = 'cooking';
        seat.progress = 0;
        ui.updateSeat(seatIdx);
        ui.ticker(`å¸­${seatIdx+1}: ${count}å“ã‚’æ³¨æ–‡ä¸­`);
    },

    manualOrderClick: (seatIdx) => {
        const seat = G.seats[seatIdx];
        if (seat && seat.status === 'ordering' && !seat.customer.isTablet) {
            G.activeOrder = seatIdx;
            document.getElementById('order-customer-img').src = seat.customer.img;
            
            const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
            
            // æ‰‹å‹•ã§ã‚‚ãƒ©ãƒ³ãƒ€ãƒ 1-5å“ç”Ÿæˆ
            const count = Math.floor(Math.random() * 5) + 1; 
            const orderItems = [];
            for(let i=0; i<count; i++) {
                orderItems.push(menuList[Math.floor(Math.random() * menuList.length)]);
            }
            seat.customer.order = orderItems;

            const itemNames = orderItems.map(i => i.name).join('ã€<br>');
            document.getElementById('order-text').innerHTML = `ã€Œ${itemNames}ã€<br>ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼`;
            document.getElementById('modal-order').style.display = 'flex';
            game.togglePause(true);
        }
    },

    confirmOrder: () => {
        document.getElementById('modal-order').style.display = 'none';
        game.togglePause(false);
        if (G.activeOrder !== null) {
            G.seats[G.activeOrder].status = 'cooking';
            ui.updateSeat(G.activeOrder);
            G.activeOrder = null;
        }
    },

    processPayment: (seatIdx) => {
        const seat = G.seats[seatIdx];
        if (!seat) return;

        // åˆè¨ˆé‡‘é¡è¨ˆç®—
        let totalProfit = 0;
        seat.customer.order.forEach(item => {
            totalProfit += item.price;
        });
        totalProfit *= seat.customer.size; // äººæ•°åˆ†

        G.money += totalProfit;
        G.totalEarnings += totalProfit;
        
        const sat = seat.satisfaction;
        G.reputation = (G.reputation * 0.9) + ((sat / 20) * 0.1); 
        if (G.reputation > 5) G.reputation = 5;
        if (G.reputation < 1) G.reputation = 1;

        G.seats[seatIdx] = { occupied: false, customer: null, status: 'empty' };
        ui.updateSeat(seatIdx);
        ui.updateHeader();
        ui.ticker(`ä¼šè¨ˆ: Â¥${totalProfit} å£²ã‚Šä¸Šã’ï¼ è©•ä¾¡:${G.reputation.toFixed(1)}`);
    },

    endDay: () => {
        G.day++;
        G.weekDay = (G.weekDay + 1) % 7;
        G.time = 540;
        
        G.activeAds.forEach(ad => {
            if (ad.daysLeft > 0) {
                ad.daysLeft--;
                if (ad.daysLeft === 0) {
                    ad.afterDays = (ad.type === 'poster') ? 2 : (ad.type === 'flyer') ? 1 : (ad.type === 'cm') ? 3 : 5;
                }
            } else if (ad.afterDays > 0) {
                ad.afterDays--;
            }
        });
        G.activeAds = G.activeAds.filter(ad => ad.daysLeft > 0 || ad.afterDays > 0);

        if (G.day % 10 === 0) {
            G.money -= 1000000;
            alert('å®¶è³ƒã¨å…‰ç†±è²» 100ä¸‡å††ã‚’æ”¯æ‰•ã„ã¾ã—ãŸã€‚');
        }

        if (G.money < 2000000 && !G.bailoutUsed) {
            G.money += 5000000;
            G.bailoutUsed = true;
            alert('çµŒå–¶å±æ©Ÿã®ãŸã‚æ”¯æ´é‡‘500ä¸‡å††ã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚');
        }

        game.checkWinLose();

        clearInterval(G.timerId);
        alert(`1æ—¥ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚ç¾åœ¨ã®è³‡ç”£: Â¥${G.money.toLocaleString()}`);
        G.timerId = setInterval(game.loop, 1000);
    },

    checkWinLose: () => {
        if (G.difficulty === 'hard') {
            if (G.reputation < 3.5) {
                game.gameOver("è©•ä¾¡ãŒä½ã™ãã¾ã™ã€‚é–‰åº—ã§ã™...");
                return;
            }
            if (G.totalEarnings >= 15000000) {
                game.gameWin();
            }
        } else if (G.difficulty === 'normal') {
            if (G.totalEarnings >= 5000000) {
                game.gameWin();
            }
        }
        if (G.money < 0) {
            game.gameOver("ç ´ç”£ã—ã¾ã—ãŸ...");
        }
    },
    
    gameOver: (msg) => {
        clearInterval(G.timerId);
        alert("GAME OVER\n" + msg);
        game.showHome();
    },
    gameWin: (msg) => {
        clearInterval(G.timerId);
        alert("CONGRATULATIONS!\nç›®æ¨™é‡‘é¡ã‚’é”æˆã—ã¾ã—ãŸï¼çµŒå–¶ã¯å¤§æˆåŠŸã§ã™ï¼");
        game.showHome();
    },

    togglePause: (forceState) => {
        if (forceState !== undefined) {
            if (forceState) clearInterval(G.timerId);
            else G.timerId = setInterval(game.loop, 1000);
        } else {
            if (G.timerId) { clearInterval(G.timerId); G.timerId = null; }
            else G.timerId = setInterval(game.loop, 1000);
        }
    },

    saveGame: () => {
        const json = JSON.stringify(G);
        const blob = new Blob([json], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "kitchen_tycoon_save.json";
        a.click();
    },
    
    loadGameData: (input) => {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const loaded = JSON.parse(e.target.result);
                if(loaded.customMenus) {
                    MENUS.fastfood = loaded.customMenus.fastfood;
                    MENUS.restaurant = loaded.customMenus.restaurant;
                }
                G = loaded;
                document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
                document.getElementById('screen-game').classList.add('active');
                ui.renderSeats();
                ui.updateHeader();
                game.togglePause(false); 
                if(!G.timerId) G.timerId = setInterval(game.loop, 1000);
            } catch (err) {
                alert("ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã¾ã™");
            }
        };
        reader.readAsText(file);
    },

    quitGame: () => {
        if(confirm("ã‚»ãƒ¼ãƒ–ã—ã¾ã—ãŸã‹ï¼Ÿæœ¬å½“ã«ã‚„ã‚ã¾ã™ã‹ï¼Ÿ")) {
            clearInterval(G.timerId);
            game.showHome();
            ui.closeModal('modal-menu');
        }
    }
};

/* =========================================
   è¨­å®šãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯
   ========================================= */
const setup = {
    updateMenuOptions: () => {
        const type = document.getElementById('setup-type').value;
        const list = document.getElementById('setup-menu-list');
        list.innerHTML = '';
        MENUS[type].forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-select';
            div.innerText = `${item.name} (${item.price}å††)`;
            div.dataset.id = item.id;
            div.onclick = () => {
                if (div.classList.contains('selected')) {
                    div.classList.remove('selected');
                } else {
                    if (document.querySelectorAll('.item-select.selected').length < 5) {
                        div.classList.add('selected');
                    }
                }
            };
            list.appendChild(div);
        });
    },
    updateSizeOptions: () => {
        const loc = document.getElementById('setup-location').value;
        const max = LOCATIONS[loc].max;
        const select = document.getElementById('setup-seats');
        select.innerHTML = '';
        for (let i = 4; i <= max; i+=2) {
            const op = document.createElement('option');
            op.value = i;
            op.innerText = `${i}å¸­`;
            if (i===max) op.selected = true;
            select.appendChild(op);
        }
    }
};

const settings = {
    toggleOrderMode: () => {
        G.manualOrder = !G.manualOrder;
        document.getElementById('btn-order-mode').innerText = G.manualOrder ? "æ‰‹å‹•æ³¨æ–‡: ON" : "æ‰‹å‹•æ³¨æ–‡: OFF";
    },
    buyItem: (item) => {
        if (item === 'trash') {
            if (G.money >= 10000) {
                G.money -= 10000;
                G.trashBin = true;
                alert("ã‚´ãƒŸç®±ã‚’è¨­ç½®ã—ã¾ã—ãŸï¼æº€è¶³åº¦UP");
            }
        } else if (item === 'clean') {
            if (G.money >= 50000) {
                G.money -= 50000;
                G.reputation += 0.2;
                alert("æ¸…æƒæ¥­è€…ã‚’å…¥ã‚Œã¾ã—ãŸã€‚è©•ä¾¡UPï¼");
            }
        }
        ui.updateHeader();
    },
    hire: (type) => {
        const emp = EMPLOYEES[type];
        if (G.money >= emp.cost) {
            G.money -= emp.cost;
            G.employees.push(type);
            alert(`${emp.name}ã‚’é›‡ã„ã¾ã—ãŸï¼`);
            settings.renderEmployeeList();
            ui.updateHeader();
        } else {
            alert("è³‡é‡‘ãŒè¶³ã‚Šã¾ã›ã‚“...");
        }
    },
    fire: (index) => {
        if (G.employees.length <= 1) {
            alert("æœ€å¾Œã®å¾“æ¥­å“¡ã¯è§£é›‡ã§ãã¾ã›ã‚“ï¼åº—ãŒå›ã‚Šã¾ã›ã‚“ï¼");
            return;
        }
        if(confirm("æœ¬å½“ã«è§£é›‡ã—ã¾ã™ã‹ï¼Ÿ")) {
            G.employees.splice(index, 1);
            settings.renderEmployeeList();
            ui.updateHeader(); 
        }
    },
    renderEmployeeList: () => {
        const list = document.getElementById('current-employees-list');
        list.innerHTML = '';
        G.employees.forEach((key, idx) => {
            const data = EMPLOYEES[key];
            const row = document.createElement('div');
            row.className = 'emp-row';
            row.innerHTML = `<span>${data.name} (é€Ÿåº¦x${data.speed})</span> <button onclick="settings.fire(${idx})">è§£é›‡</button>`;
            list.appendChild(row);
        });
    },
    toggleMenuEdit: () => {
        const area = document.getElementById('menu-edit-area');
        if (area.style.display === 'none') {
            area.style.display = 'block';
            settings.renderMenuEditList();
        } else {
            area.style.display = 'none';
        }
    },
    renderMenuEditList: () => {
        const list = document.getElementById('menu-edit-list');
        list.innerHTML = '';
        const allMenus = MENUS[G.type];
        
        allMenus.forEach((item, idx) => {
            const row = document.createElement('div');
            row.className = 'menu-edit-row';
            
            const isChecked = G.menu.includes(item.id) ? 'checked' : '';
            
            row.innerHTML = `
                <label style="flex:1; font-size:0.8rem;">
                    <input type="checkbox" class="menu-chk" value="${item.id}" ${isChecked}> ${item.name}
                </label>
                <input type="number" id="price-${item.id}" value="${item.price}" min="10">å††
            `;
            list.appendChild(row);
        });
    },
    saveMenuChanges: () => {
        const checkboxes = document.querySelectorAll('.menu-chk:checked');
        if (checkboxes.length !== 5) {
            alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å¿…ãš5ã¤é¸æŠã—ã¦ãã ã•ã„ï¼");
            return;
        }
        MENUS[G.type].forEach(item => {
            const input = document.getElementById(`price-${item.id}`);
            if(input) {
                item.price = parseInt(input.value);
            }
        });
        G.menu = Array.from(checkboxes).map(cb => cb.value);
        G.customMenus = { fastfood: MENUS.fastfood, restaurant: MENUS.restaurant };

        alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ä¾¡æ ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼");
        settings.toggleMenuEdit();
    },
    // åº—èˆ—æ‹¡å¼µãƒ­ã‚¸ãƒƒã‚¯
    expandSeats: (target) => {
        if (target === 15) {
            if (G.totalEarnings < 100000) { alert("ç´¯è¨ˆåˆ©ç›ŠãŒ10ä¸‡å††ã«é”ã—ã¦ã„ã¾ã›ã‚“"); return; }
        } else if (target === 20) {
            if (G.totalEarnings < 200000) { alert("ç´¯è¨ˆåˆ©ç›ŠãŒ20ä¸‡å††ã«é”ã—ã¦ã„ã¾ã›ã‚“"); return; }
        }

        if (G.maxSeats >= target) {
            alert("ã™ã§ã«æ‹¡å¼µæ¸ˆã¿ã§ã™");
            return;
        }

        const added = target - G.maxSeats;
        G.maxSeats = target;
        for(let i=0; i<added; i++) {
            G.seats.push({ occupied: false, customer: null, status: 'empty', waitTime: 0 });
        }
        
        alert(`åº—èˆ—ã‚’æ‹¡å¼µã—ã¾ã—ãŸï¼å¸­æ•°ãŒ${target}ã«ãªã‚Šã¾ã—ãŸï¼`);
        ui.renderSeats();
        ui.updateSettingsButtons(); // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
    }
};

const ads = {
    start: (type) => {
        let cost = 0, buff = 0, dur = 0, abuff = 0;
        if (type === 'poster') { cost=7000; buff=15; dur=2; abuff=5; }
        if (type === 'flyer') { cost=10000; buff=20; dur=2; abuff=5; }
        if (type === 'cm') { cost=50000; buff=25; dur=10; abuff=20; }
        if (type === 'tv') { cost=100000; buff=25; dur=1; abuff=40; }

        if (G.money < cost) { alert("è³‡é‡‘ä¸è¶³ã§ã™"); return; }
        
        G.money -= cost;
        G.activeAds.push({ type: type, daysLeft: dur, buff: buff, afterBuff: abuff, afterDays: 0 });
        alert("å®£ä¼ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼åŠ¹æœã¯é‡è¤‡ã—ã¾ã™ã€‚");
        ui.updateHeader();
        ui.closeModal('modal-ads');
    }
};

/* =========================================
   UIåˆ¶å¾¡
   ========================================= */
const ui = {
    updateHeader: () => {
        const h = Math.floor(G.time / 60);
        const m = G.time % 60;
        const timeStr = `${('0'+h).slice(-2)}:${('0'+m).slice(-2)}`;
        document.getElementById('display-time').innerText = `Day ${G.day} (${DAYS[G.weekDay]}) ${timeStr}`;
        document.getElementById('display-money').innerText = `Â¥${G.money.toLocaleString()}`;
        document.getElementById('display-assets').innerText = `ç´¯è¨ˆåˆ©ç›Š: Â¥${G.totalEarnings.toLocaleString()}`;
        
        let stars = "";
        for(let i=0; i<5; i++) stars += (i < Math.floor(G.reputation)) ? "â˜…" : "â˜†";
        document.getElementById('display-stars').innerText = stars;
        
        let totalBuff = 0;
        G.activeAds.forEach(ad => {
            if (ad.daysLeft > 0) totalBuff += ad.buff;
            else if (ad.afterDays > 0) totalBuff += ad.afterBuff;
        });
        document.getElementById('ad-buff-display').innerText = `å®£ä¼: +${totalBuff}%`;
        
        if(document.getElementById('ad-status-detail')) {
            document.getElementById('ad-status-detail').innerText = `+${totalBuff}% (ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå®£ä¼: ${G.activeAds.length}ä»¶)`;
        }

        // æ‹¡å¼µãƒœã‚¿ãƒ³ã®æ›´æ–°
        ui.updateSettingsButtons();
    },

    updateSettingsButtons: () => {
        const btn15 = document.getElementById('btn-expand-15');
        const btn20 = document.getElementById('btn-expand-20');
        if(btn15 && btn20) {
            if(G.maxSeats >= 15) btn15.disabled = true;
            else btn15.disabled = (G.totalEarnings < 100000);

            if(G.maxSeats >= 20) btn20.disabled = true;
            else btn20.disabled = (G.totalEarnings < 200000);
        }
    },
    
    renderSeats: () => {
        const con = document.getElementById('seats-container');
        con.innerHTML = '';
        G.seats.forEach((seat, idx) => {
            const div = document.createElement('div');
            div.className = 'seat';
            div.id = `seat-${idx}`;
            div.onclick = () => game.manualOrderClick(idx);
            
            const info = document.createElement('div');
            info.className = 'seat-status';
            info.id = `seat-info-${idx}`;
            info.innerText = 'ç©ºå¸­';
            
            div.appendChild(info);
            con.appendChild(div);
        });
    },

    updateSeat: (idx) => {
        const seat = G.seats[idx];
        const div = document.getElementById(`seat-${idx}`);
        const info = document.getElementById(`seat-info-${idx}`);
        
        if (seat.occupied) {
            div.classList.add('occupied');
            div.style.backgroundImage = `url(${seat.customer.img})`;
            div.style.backgroundSize = 'contain';
            div.style.backgroundRepeat = 'no-repeat';
            div.style.backgroundPosition = 'center';
            
            let txt = "";
            if (seat.status === 'sitting') txt = "ç€å¸­ä¸­";
            if (seat.status === 'ordering') txt = "æ³¨æ–‡ä¸­...";
            if (seat.status === 'cooking') txt = "èª¿ç†ä¸­";
            if (seat.status === 'eating') txt = "é£Ÿäº‹ä¸­";
            if (seat.status === 'paying') txt = "ä¼šè¨ˆä¸­";
            info.innerText = txt;
        } else {
            div.classList.remove('occupied');
            div.style.backgroundImage = 'none';
            info.innerText = 'ç©ºå¸­';
        }
    },

    ticker: (msg) => {
        const t = document.getElementById('ticker');
        t.innerText = msg;
    },
    
    toggleMenu: () => {
        document.getElementById('modal-menu').style.display = 'flex';
        game.togglePause(true);
    },
    
    toggleSettings: () => {
        document.getElementById('modal-settings').style.display = 'flex';
        game.togglePause(true);
        settings.renderEmployeeList();
        document.getElementById('menu-edit-area').style.display = 'none';
        ui.updateSettingsButtons();
    },
    
    toggleAds: () => {
        document.getElementById('modal-ads').style.display = 'flex';
        game.togglePause(true);
        ui.updateHeader(); 
    },

    toggleHelp: () => {
        document.getElementById('modal-help').style.display = 'flex';
        game.togglePause(true);
    },

    toggleMode: () => {
        const c = document.getElementById('game-container');
        if (G.mode === 'pc') {
            c.classList.remove('pc-mode');
            c.classList.add('mobile-mode');
            G.mode = 'mobile';
        } else {
            c.classList.remove('mobile-mode');
            c.classList.add('pc-mode');
            G.mode = 'pc';
        }
    },

    closeModal: (id) => {
        document.getElementById(id).style.display = 'none';
        game.togglePause(false);
    }
};

// åˆæœŸå®Ÿè¡Œ
game.showHome();
</script>
</body>
</html>
