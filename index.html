<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="google-site-verification" content="8o8DGhxsn_70QtPiKPjHgnpjYrCLIzxJJaIbV80KA_w" />
<title id="game-title">é£²é£Ÿåº—çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ v1.25</title>
<style>
    :root {
        --bg-color: #2c3e50;
        --panel-color: #34495e;
        --text-color: #ecf0f1;
        --accent-color: #e74c3c;
        --success-color: #2ecc71;
        --warning-color: #f1c40f;
        --info-color: #3498db;
    }
    * { box-sizing: border-box; }
    body { 
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; 
        background: var(--bg-color); 
        color: var(--text-color); 
        margin: 0; padding: 0; 
        overflow: hidden; height: 100dvh;
    }
    button { 
        cursor: pointer; padding: 8px 10px; border: none; border-radius: 4px; 
        background: var(--accent-color); color: white; font-weight: bold; margin: 2px; 
        font-size: 0.85rem; touch-action: manipulation; white-space: nowrap;
    }
    button:hover { opacity: 0.9; }
    button:disabled { background: #7f8c8d; cursor: not-allowed; opacity: 0.6; }
    input, select { padding: 8px; border-radius: 4px; border: none; margin: 4px; color:#333; font-size: 0.9rem; }

    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    #game-container { width: 100%; height: 100%; display: flex; flex-direction: column; background: var(--bg-color); }
    #game-container.pc-mode { max-width: 1024px; margin: 0 auto; border-left: 2px solid #7f8c8d; border-right: 2px solid #7f8c8d; }

    .screen { display: none; flex: 1; flex-direction: column; padding: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 40px; }
    .screen.active { display: flex; }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    #ui-header { background: #1a252f; padding: 5px; font-size: 0.8rem; flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; }
    .header-row { display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; }
    #info-bar { text-align: center; font-weight: bold; flex-grow: 1; }

    /* ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ */
    .speed-btn { padding: 4px 8px; font-size: 0.75rem; background: #7f8c8d; margin: 0; border-radius: 0; }
    .speed-btn:first-child { border-radius: 4px 0 0 4px; }
    .speed-btn:last-child { border-radius: 0 4px 4px 0; }
    .speed-btn.active { background: var(--success-color); }

    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    #main-area { 
        flex: 1; position: relative; background: #ecf0f1; color: #333; 
        padding: 10px; overflow-y: auto; 
        display: flex; flex-direction: column; gap: 10px;
    }
    #game-container.pc-mode #main-area { flex-direction: row; }
    
    /* å®¢å¸­ã‚¨ãƒªã‚¢ */
    #seats-section { flex: 2; overflow-y: auto; }
    #seats-container { display: grid; gap: 5px; grid-template-columns: repeat(auto-fit, minmax(65px, 1fr)); padding-bottom: 20px; }
    .seat { background: #bdc3c7; border-radius: 6px; text-align: center; position: relative; height: 80px; border: 2px solid #7f8c8d; }
    .seat.occupied { background: #f39c12; border-color: #d35400; }
    .seat-status { font-size: 9px; position: absolute; bottom: 2px; left: 0; width: 100%; background:rgba(255,255,255,0.8); font-weight: bold; line-height: 1.1; }

    /* å¾“æ¥­å“¡ãƒ‘ãƒãƒ« */
    #staff-section { 
        flex: 1; background: #34495e; color: white; border-radius: 5px; padding: 5px; 
        overflow-y: auto; min-height: 150px;
    }
    #staff-section h3 { margin: 5px 0; font-size: 1rem; text-align: center; border-bottom: 1px solid #7f8c8d; }
    .staff-card { 
        background: rgba(0,0,0,0.3); margin-bottom: 4px; padding: 5px; border-radius: 3px; font-size: 0.85rem; 
        display: flex; justify-content: space-between; align-items: center;
    }
    .staff-card.busy { border-left: 4px solid var(--accent-color); }
    .staff-card.free { border-left: 4px solid var(--success-color); }
    .staff-status-text { font-size: 0.75rem; font-weight: bold; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 10px; }
    .modal-content { background: var(--panel-color); padding: 15px; border-radius: 8px; width: 100%; max-width: 650px; color: white; text-align: center; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; }
    
    /* å‰²ã‚Šå½“ã¦UI */
    .assign-row { display: flex; flex-direction:column; background: rgba(255,255,255,0.1); padding: 5px; margin: 4px 0; border-radius: 4px; text-align: left;}
    .assign-name { font-weight: bold; margin-bottom: 3px; font-size: 0.9rem; }
    .assign-selects { display: flex; gap: 2px; overflow-x: auto; }
    .assign-select { padding: 2px; font-size: 0.75rem; width: 80px; }

    /* ã‚°ãƒ©ãƒ•ãªã© */
    #stats-canvas { background: #fff; width: 100%; height: 250px; margin-bottom: 10px; border-radius: 4px; flex-shrink: 0;}
    
    .help-tabs { display: flex; border-bottom: 2px solid #7f8c8d; margin-bottom: 10px; flex-shrink: 0; overflow-x: auto;}
    .help-tab { flex: 1; padding: 10px 5px; font-size: 0.85rem; cursor: pointer; background: #2c3e50; border: 1px solid #7f8c8d; border-bottom: none; color: #95a5a6; white-space: nowrap; }
    .help-tab.active { background: var(--panel-color); color: #fff; font-weight: bold; border-top: 3px solid var(--warning-color); }
    .help-section { display: none; text-align: left; overflow-y: auto; padding: 5px; flex: 1; }
    .help-section.active { display: block; }
    .help-section h4 { border-bottom: 1px solid #fff; padding-bottom: 3px; margin-top: 15px; font-size: 0.95rem; color: var(--warning-color); }
    
    table.help-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 0.8rem; color: #ecf0f1; }
    table.help-table th, table.help-table td { border: 1px solid #7f8c8d; padding: 4px; text-align: left; }
    table.help-table th { background: #2980b9; }

    .home-btn-group { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 30px; }
    .home-btn-group button { width: 80%; max-width: 280px; padding: 12px; font-size: 1rem; }
    .tab-group { display: flex; gap: 5px; margin-bottom: 10px; justify-content: center; }
    .tab-btn { background: #7f8c8d; flex: 1; font-size: 0.8rem; }
    .tab-btn.active { background: var(--info-color); }

    #ticker { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); color: #0f0; padding: 4px; white-space: nowrap; overflow: hidden; font-family: 'Courier New', monospace; z-index: 900; height: 25px; line-height: 25px; font-size: 0.85rem; }
</style>
</head>
<body>

<div id="game-container">
    <div id="ticker">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•: æº–å‚™å®Œäº†...</div>

    <div id="screen-home" class="screen active">
        <h1 style="text-align: center; color: var(--warning-color); margin-top: 30px;" id="home-title">ğŸ” Kitchen Tycoon ğŸ</h1>
        <p style="text-align:center; font-size:0.8rem; color:#bdc3c7;" id="home-version">v1.25 Language Support</p>
        <div class="home-btn-group">
            <button onclick="game.showSetup()" id="btn-home-start">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</button>
            <input type="file" id="save-file-input" style="display:none" onchange="game.loadGameData(this)">
            <button onclick="document.getElementById('save-file-input').click()" id="btn-home-load">ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿èª­è¾¼</button>
            <button onclick="ui.toggleHelp()" style="background:var(--info-color);" id="btn-home-help">èª¬æ˜æ›¸ (éŠã³æ–¹ãƒ»è£ä»•æ§˜)</button>
            <a href="https://tamani3901.github.io/ti-tobann/" target="_blank" style="width:100%; text-align:center;">
                <button style="background:#8e44ad; width:80%;" id="btn-home-cheat">ãƒãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸</button>
            </a>
        </div>
    </div>

    <div id="screen-setup" class="screen">
        <h2 style="text-align:center;" id="setup-title">æ–°è¦åº—èˆ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>
        <div style="margin-bottom:10px;">
            <label id="label-type">åº—ã®ç¨®é¡:</label>
            <select id="setup-type" onchange="setup.updateMenuOptions()" style="width:100%;">
                <option value="fastfood">ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</option>
                <option value="restaurant">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</option>
            </select>
        </div>
        <div style="margin-bottom:10px;">
            <label id="label-location">å ´æ‰€:</label>
            <select id="setup-location" onchange="setup.updateSizeOptions()" style="width:100%;">
                <option value="big_city" id="opt-loc-big">å¤§éƒ½å¸‚ (MAX 10å¸­)</option>
                <option value="city" id="opt-loc-city">éƒ½å¸‚éƒ¨ (MAX 8å¸­)</option>
                <option value="mid_city" id="opt-loc-mid">ä¸­éƒ½å¸‚ (MAX 6å¸­)</option>
                <option value="small_city" id="opt-loc-small">å°éƒ½å¸‚ (MAX 4å¸­)</option>
            </select>
        </div>
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label id="label-seats">åˆæœŸå¸­æ•°:</label>
                <select id="setup-seats" style="width:100%;"></select>
            </div>
            <div style="flex:1;">
                <label id="label-difficulty">é›£æ˜“åº¦:</label>
                <select id="setup-difficulty" style="width:100%;">
                    <option value="hard" id="opt-diff-hard">é›£ã—ã„</option>
                    <option value="normal" selected id="opt-diff-normal">æ™®é€š</option>
                    <option value="easy" id="opt-diff-easy">ç°¡å˜</option>
                </select>
            </div>
        </div>
        <label style="margin-top:15px; display:block;" id="label-menu-select">åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ (5ã¤é¸æŠ):</label>
        <div id="setup-menu-list" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;"></div>
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="game.startGame()" style="width:100%; padding:12px; font-size:1.1rem;" id="btn-setup-start">é–‹åº—ã™ã‚‹</button>
            <button onclick="game.showHome()" style="background:#7f8c8d; width:100%; margin-top:10px;" id="btn-setup-back">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="screen-game" class="screen" style="padding:0; overflow:hidden;">
        <div id="ui-header">
            <div class="header-row">
                <div style="display:flex; flex-wrap:wrap; gap:2px; flex:1;">
                    <button id="btn-lang-toggle" onclick="ui.toggleLanguage()" style="font-size:0.8rem; background:#34495e; color:white; min-width:30px;">EN</button>
                    <button id="btn-menu" onclick="ui.toggleMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
                    <button id="btn-employees" onclick="ui.toggleEmployees()" style="background:#8e44ad;">å¾“æ¥­å“¡</button>
                    <button id="btn-settings" onclick="ui.toggleSettings()">è¨­å®š</button>
                    <button id="btn-stats" onclick="stats.show()">çµ±è¨ˆ</button>
                    <button id="btn-help" onclick="ui.toggleHelp()" style="background:var(--info-color);">èª¬æ˜</button>
                </div>
                <button id="btn-audio-toggle" onclick="bgm.toggle()" style="font-size:0.8rem; background:#34495e; color:white; min-width:30px;">â™ª</button>
                <button id="btn-mode-toggle" onclick="ui.toggleMode()" style="font-size:0.7rem; background:#95a5a6; margin-left:5px; min-width:80px;">ğŸ“± ã‚¹ãƒãƒ›</button>
            </div>
            
            <div class="header-row" style="background:#2c3e50; padding:3px; border-radius:4px; margin-top:3px;">
                <div style="flex:1; text-align:center; font-size:0.85rem;">
                    <span id="display-time">Day 1 9:00</span>
                </div>
                <div style="flex:1; text-align:center; font-weight:bold; color:var(--warning-color); font-size:0.9rem;">
                    <span id="display-money">è³‡ç”£: Â¥15,000,000</span>
                </div>
            </div>

            <div class="header-row" style="font-size:0.75rem; margin-top:2px;">
                 <div style="flex:1;">
                     <span id="display-stars">â˜…â˜…â˜…â˜…â˜…</span>
                     <span style="margin-left:5px;" id="display-earnings">ç´¯è¨ˆ: Â¥0</span>
                 </div>
                 <div style="display:flex; align-items:center; gap:5px;">
                    <span id="ad-buff-display" style="color:var(--success-color);">å®£ä¼:+0%</span>
                    <button id="btn-ad-toggle" onclick="ui.toggleAds()" style="padding:2px 6px; font-size:0.75rem;">å®£ä¼</button>
                    <div style="display:flex; gap:0;">
                        <button class="speed-btn active" id="btn-spd-1" onclick="game.setSpeed(1)">x1</button>
                        <button class="speed-btn" id="btn-spd-2" onclick="game.setSpeed(2)">x2</button>
                        <button class="speed-btn" id="btn-spd-3" onclick="game.setSpeed(3)">x3</button>
                    </div>
                 </div>
            </div>
        </div>

        <div id="main-area">
            <div id="seats-section">
                <div id="seats-container"></div>
            </div>
            <div id="staff-section">
                <h3 id="staff-section-title">ã‚¹ã‚¿ãƒƒãƒ•ãƒ«ãƒ¼ãƒ  (4å“åŒæ™‚)</h3>
                <div id="staff-container">
                    </div>
            </div>
        </div>
    </div>

</div>

<div id="modal-employees" class="modal-overlay">
    <div class="modal-content" style="height:85vh; display:flex; flex-direction:column;">
        <h3 id="emp-modal-title">ğŸ‘©â€ğŸ³ å¾“æ¥­å“¡ & ã‚­ãƒƒãƒãƒ³æ‹…å½“</h3>
        
        <div style="margin-bottom:10px;">
            <h4 id="emp-modal-hire-title">é›‡ç”¨ã‚»ãƒ³ã‚¿ãƒ¼</h4>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                <button onclick="settings.hire('master')" style="font-size:0.8rem;" id="btn-hire-master">ãƒã‚¹ã‚¿ãƒ¼(20ä¸‡)</button>
                <button onclick="settings.hire('veteran')" style="font-size:0.8rem;" id="btn-hire-veteran">ãƒ™ãƒ†ãƒ©ãƒ³(12ä¸‡)</button>
                <button onclick="settings.hire('standard')" style="font-size:0.8rem;" id="btn-hire-standard">æ¨™æº–(8ä¸‡)</button>
                <button onclick="settings.hire('ponkotsu')" style="font-size:0.8rem;" id="btn-hire-ponkotsu">ãƒãƒ³ã‚³ãƒ„(4ä¸‡)</button>
            </div>
            <div id="current-employees-list" style="max-height: 60px; overflow-y: auto; border:1px solid #7f8c8d; padding:5px; margin-top:5px;"></div>
        </div>

        <hr>
        <h4 id="emp-modal-assign-title">ğŸ½ï¸ æ‹…å½“å‰²ã‚Šå½“ã¦ (1å“ã«ã¤ã4äººã¾ã§)</h4>
        <div class="help-tabs">
            <div id="tab-btn-main" class="help-tab active" onclick="settings.switchAssignTab('assign-main')">ãƒ¡ã‚¤ãƒ³</div>
            <div id="tab-btn-side" class="help-tab" onclick="settings.switchAssignTab('assign-side')">ã‚µã‚¤ãƒ‰</div>
            <div id="tab-btn-drink" class="help-tab" onclick="settings.switchAssignTab('assign-drink')">ãƒ‰ãƒªãƒ³ã‚¯</div>
        </div>
        
        <div id="assignment-container" style="flex:1; overflow-y:auto;">
            </div>

        <button onclick="ui.closeModal('modal-employees')" style="width:100%; margin-top:10px;" id="btn-emp-close">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-stats" class="modal-overlay">
    <div class="modal-content">
        <h3 id="stats-modal-title">ğŸ“Š çµŒå–¶çµ±è¨ˆ</h3>
        <div class="tab-group">
            <button class="tab-btn" onclick="stats.setRange(1)">1æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(5)">5æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(10)">10æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(20)">20æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(100)">100æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(0)">å…¨æœŸé–“</button>
        </div>
        <div class="tab-group">
            <button id="btn-graph-rev" class="tab-btn active" onclick="stats.setType('revenue')">å£²ä¸Š</button>
            <button id="btn-graph-asset" class="tab-btn" onclick="stats.setType('assets')">ç·è³‡ç”£</button>
        </div>
        <canvas id="stats-canvas"></canvas>
        <div style="text-align:left; font-size:0.85rem; background:rgba(0,0,0,0.2); padding:5px;">
            <p><span id="stat-label-rev">æœ¬æ—¥ã®å£²ä¸Š</span>: <span id="stat-today-rev">Â¥0</span></p>
            <p><span id="stat-label-exp">æœ¬æ—¥ã®å‡ºè²»</span>: <span id="stat-today-exp" style="color:#e74c3c;">Â¥0</span></p>
        </div>
        <button onclick="ui.closeModal('modal-stats')" style="width:100%; margin-top:10px;" id="btn-stats-close">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-order" class="modal-overlay">
    <div class="modal-content" id="order-modal-content">
        <img id="order-customer-img" src="" alt="Customer" style="width:80px;height:80px;border-radius:50%;">
        <div class="speech-bubble" id="order-text" style="background:white;color:black;padding:10px;margin:10px auto;border-radius:10px;">æ³¨æ–‡å†…å®¹...</div>
        <button onclick="game.confirmOrder()" style="width:80%; padding:10px; margin-top:10px;">äº†è§£</button>
    </div>
</div>

<div id="modal-menu" class="modal-overlay">
    <div class="modal-content">
        <h3 id="menu-modal-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
        <button onclick="ui.closeModal('modal-menu')" style="width:100%;" id="btn-menu-back">æˆ»ã‚‹</button>
        <button onclick="game.togglePause()" style="width:100%;" id="btn-menu-pause">ä¸€æ™‚åœæ­¢/å†é–‹</button>
        <button onclick="game.saveGame()" style="width:100%;" id="btn-menu-save">ã‚»ãƒ¼ãƒ–</button>
        <button onclick="game.quitGame()" style="background:#c0392b; width:100%;" id="btn-menu-quit">ã‚„ã‚ã‚‹</button>
    </div>
</div>

<div id="modal-help" class="modal-overlay">
    <div class="modal-content" style="height:85vh; display:flex; flex-direction:column;">
        <h2 style="text-align:center; margin-top:0;" id="help-modal-title">ğŸ“– ã‚²ãƒ¼ãƒ èª¬æ˜æ›¸</h2>
        
        <div class="help-tabs">
            <div id="ht-btn-basic" class="help-tab active" onclick="ui.switchHelpTab('tab-basic')">åŸºæœ¬</div>
            <div id="ht-btn-how" class="help-tab" onclick="ui.switchHelpTab('tab-how')">æ“ä½œæ–¹æ³•</div>
            <div id="ht-btn-staff" class="help-tab" onclick="ui.switchHelpTab('tab-staff')">å¾“æ¥­å“¡</div>
            <div id="ht-btn-biz" class="help-tab" onclick="ui.switchHelpTab('tab-biz')">çµŒå–¶</div>
        </div>

        <div id="tab-basic" class="help-section active">
            <h4 id="help-basic-h4">ğŸ† å‹åˆ©æ¡ä»¶ã¨é›£æ˜“åº¦</h4>
            <p id="help-basic-p1">**é›£æ˜“åº¦ï¼šæ™®é€š**<br>ç´¯è¨ˆåˆ©ç›Š 500ä¸‡å††ã§ã‚¯ãƒªã‚¢</p>
            <p id="help-basic-p2">**é›£æ˜“åº¦ï¼šé›£ã—ã„**<br>ç´¯è¨ˆåˆ©ç›Š 1500ä¸‡å††ã§ã‚¯ãƒªã‚¢ <br><small id="help-basic-small1" style="color:#e74c3c;">â€»è©•ä¾¡â˜…3.5ä»¥ä¸‹ã§å³ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</small></p>
            <p id="help-basic-p3">**é›£æ˜“åº¦ï¼šç°¡å˜**<br>æ¡ä»¶ãªã— (è©•ä¾¡2.5ä»¥ä¸‹ã«ãªã‚‰ãªã„)</p>
            <p id="help-basic-p4">â€»ã‚¯ãƒªã‚¢å¾Œã¯**ãƒœãƒ¼ãƒŠã‚¹200ä¸‡å††**ã‚’ç²å¾—ã—ã€**æœ€å¤§40å¸­**ã¾ã§æ‹¡å¼µå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
            <p id="help-basic-p5" style="color:#e74c3c;">â€»è³‡ç”£ãŒãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã¨ç ´ç”£ï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼‰ã§ã™ã€‚</p>
        </div>

        <div id="tab-how" class="help-section">
            <h4 id="help-how-h4">ğŸ® éŠã³æ–¹ã®æµã‚Œ</h4>
            <ol>
                <li id="help-how-l1">**é–‹åº—æº–å‚™:** ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨å ´æ‰€ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆã€‚</li>
                <li id="help-how-l2">**æ‹…å½“å‰²ã‚Šå½“ã¦:** ãƒ˜ãƒƒãƒ€ãƒ¼ã®<span style="background:#8e44ad;padding:2px;border-radius:3px;">å¾“æ¥­å“¡</span>ãƒœã‚¿ãƒ³ã‹ã‚‰ã€èª°ãŒã©ã®æ–™ç†ã‚’ä½œã‚‹ã‹æ±ºã‚ã¾ã™ï¼ˆé‡è¦ï¼ï¼‰ã€‚</li>
                <li id="help-how-l3">**å–¶æ¥­é–‹å§‹:** å®¢ãŒæ¥åº—ã—æ³¨æ–‡ã—ã¾ã™ã€‚å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå¾“æ¥­å“¡ãŒè‡ªå‹•ã§èª¿ç†ã—ã¾ã™ã€‚</li>
                <li id="help-how-l4">**ä¼šè¨ˆ:** é£Ÿã¹çµ‚ã‚ã‚‹ã¨è‡ªå‹•ã§å£²ä¸ŠãŒå…¥ã‚Šã¾ã™ã€‚</li>
                <li id="help-how-l5">**22:00 é–‰åº—:** æ–°è¦æ¥åº—ã‚¹ãƒˆãƒƒãƒ—ã€‚åº—å†…ã®å®¢ãŒå…¨å“¡å¸°ã‚‹ã¾ã§å–¶æ¥­ã¯ç¶šãã¾ã™ã€‚</li>
            </ol>
            <p id="help-how-p1">â€»èª¿ç†ãŒå§‹ã¾ã‚‰ãªã„æ™‚ã¯ã€æ‹…å½“å‰²ã‚Šå½“ã¦ã‚’ç¢ºèªã™ã‚‹ã‹ã€å¾“æ¥­å“¡ã®æ‰‹ãŒç©ºãã®ã‚’å¾…ã£ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div id="tab-staff" class="help-section">
            <h4 id="help-staff-h4">ğŸ§‘â€ğŸ³ å¾“æ¥­å“¡ã®ã‚³ã‚¹ãƒˆ</h4>
            <p id="help-staff-p1">é›‡ã†æ™‚ã®ã€Œå¥‘ç´„é‡‘ã€ã«åŠ ãˆã€**10æ—¥ã”ã¨ã«ã€Œç¶­æŒè²»ï¼ˆçµ¦æ–™ï¼‰ã€**ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>
            <table class="help-table">
                <thead><tr><th><span id="help-staff-t1">ãƒ©ãƒ³ã‚¯</span></th><th><span id="help-staff-t2">å¥‘ç´„é‡‘</span></th><th><span id="help-staff-t3">ç¶­æŒè²»(10æ—¥æ¯)</span></th><th><span id="help-staff-t4">é€Ÿåº¦</span></th></tr></thead>
                <tbody>
                    <tr><td>ãƒã‚¹ã‚¿ãƒ¼</td><td id="help-staff-m1">20ä¸‡</td><td id="help-staff-m2">25ä¸‡</td><td id="help-staff-m3">2.5å€</td></tr>
                    <tr><td>ãƒ™ãƒ†ãƒ©ãƒ³</td><td id="help-staff-v1">12ä¸‡</td><td id="help-staff-v2">20ä¸‡</td><td id="help-staff-v3">1.6å€</td></tr>
                    <tr><td>æ¨™æº–</td><td id="help-staff-s1">8ä¸‡</td><td id="help-staff-s2">15ä¸‡</td><td id="help-staff-s3">1.0å€</td></tr>
                    <tr><td>ãƒãƒ³ã‚³ãƒ„</td><td id="help-staff-p1t">4ä¸‡</td><td id="help-staff-p2">10ä¸‡</td><td id="help-staff-p3">0.5å€</td></tr>
                </tbody>
            </table>
            <p id="help-staff-p2">å¾“æ¥­å“¡ã¯1äººã«ã¤ã**åŒæ™‚ã«4å“**ã¾ã§èª¿ç†å¯èƒ½ã§ã™ã€‚</p>
        </div>

        <div id="tab-biz" class="help-section">
            <h4 id="help-biz-h4">ğŸ“¢ å®£ä¼åŠ¹æœ (é‡ã­ãŒã‘OK)</h4>
            <table class="help-table">
                <thead><tr><th><span id="help-biz-t1">ç¨®é¡</span></th><th><span id="help-biz-t2">è²»ç”¨</span></th><th><span id="help-biz-t3">æœŸé–“</span></th><th><span id="help-biz-t4">æ®‹å­˜</span></th></tr></thead>
                <tbody>
                    <tr><td id="help-biz-p1">ãƒã‚¹ã‚¿ãƒ¼</td><td id="help-biz-p2">2ä¸‡</td><td id="help-biz-p3">+15% (2æ—¥)</td><td id="help-biz-p4">+5% (2æ—¥)</td></tr>
                    <tr><td id="help-biz-f1">ãƒãƒ©ã‚·</td><td id="help-biz-f2">5ä¸‡</td><td id="help-biz-f3">+20% (2æ—¥)</td><td id="help-biz-f4">+5% (1æ—¥)</td></tr>
                    <tr><td id="help-biz-c1">CM</td><td id="help-biz-c2">20ä¸‡</td><td id="help-biz-c3">+25% (10æ—¥)</td><td id="help-biz-c4">+20% (3æ—¥)</td></tr>
                    <tr><td id="help-biz-t1t">TV</td><td id="help-biz-t2t">50ä¸‡</td><td id="help-biz-t3t">+25% (1æ—¥)</td><td id="help-biz-t4t">+40% (5æ—¥)</td></tr>
                </tbody>
            </table>

            <h4 id="help-biz-h4-2">âš ï¸ è£ä»•æ§˜ãƒ»å›ºå®šè²»</h4>
            <ul style="font-size:0.85rem;">
                <li id="help-biz-l1">**å¹³æ—¥ãƒ©ãƒ³ãƒ (11-13æ™‚):** å®¢+10%</li>
                <li id="help-biz-l2">**åœŸæ—¥ç¥ (çµ‚æ—¥):** å®¢+20%</li>
                <li id="help-biz-l3">**åœŸæ—¥ãƒ©ãƒ³ãƒ:** å®¢+30%</li>
                <li id="help-biz-l4">**ã‚´ãƒŸç®±è¨­ç½®:** æº€è¶³åº¦+5 (å›ºå®š)</li>
                <li id="help-biz-l5">**å®¶è³ƒ:** 10æ—¥ã”ã¨ã«100ä¸‡å††</li>
                <li id="help-biz-l6">**æ”¯æ´é‡‘:** è³‡ç”£200ä¸‡ä»¥ä¸‹ã§500ä¸‡ (1å›ã®ã¿)</li>
            </ul>
        </div>

        <div style="text-align:center; margin-top:auto; padding-top:10px;">
            <button onclick="ui.closeModal('modal-help')" style="width:100%;" id="btn-help-close">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<div id="modal-settings" class="modal-overlay">
    <div class="modal-content">
        <h3 id="settings-modal-title">åº—èˆ—è¨­å®š</h3>
        
        <h4 id="settings-popup-h4">ğŸ“¢ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®š</h4>
        <button id="btn-toggle-popup" onclick="settings.togglePopup()" style="width:100%;">1æ—¥çµ‚äº†æ™‚ã®çµæœè¡¨ç¤º: ON</button>
        <hr>

        <h4 id="settings-expand-h4">ğŸ—ï¸ åº—èˆ—æ‹¡å¼µ</h4>
        <div id="expansion-normal" style="display:flex; justify-content:center; gap:5px; margin-bottom:10px;">
            <button id="btn-expand-15" onclick="settings.expandSeats(15)" disabled style="font-size:0.8rem;">15å¸­ã¸ (ç´¯è¨ˆ10ä¸‡)</button>
            <button id="btn-expand-20" onclick="settings.expandSeats(20)" disabled style="font-size:0.8rem;">20å¸­ã¸ (ç´¯è¨ˆ20ä¸‡)</button>
        </div>
        <div id="expansion-cleared" style="display:none; background:#2c3e50; padding:10px; border-radius:5px; margin-bottom:10px;">
            <p style="margin:0 0 5px 0; font-size:0.9rem; color:var(--success-color);" id="expand-cleared-title">ğŸ‰ è‡ªç”±æ‹¡å¼µ (Max 40)</p>
            <div style="display:flex; justify-content:center; align-items:center; gap:10px;">
                <button onclick="settings.changeSeats(-5)" style="background:#c0392b;">ï¼5å¸­</button>
                <span id="current-seats-display" style="font-weight:bold; font-size:1.2rem;">20å¸­</span>
                <button onclick="settings.changeSeats(5)" style="background:#2ecc71;">ï¼‹5å¸­</button>
            </div>
        </div>
        
        <hr>
        <button id="btn-menu-edit" onclick="settings.toggleMenuEdit()" style="background:#2980b9; width:100%;">ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¾¡æ ¼ç®¡ç†</button>
        <div id="menu-edit-area" style="display:none; margin-top:10px; background:#2c3e50; padding:10px;">
            <div id="menu-edit-list" style="max-height:150px; overflow-y:auto;"></div>
            <button onclick="settings.saveMenuChanges()" style="background:#2ecc71; width:100%; margin-top:5px;" id="btn-menu-apply">é©ç”¨</button>
        </div>

        <div style="margin-top:10px;">
            <button id="btn-order-mode" onclick="settings.toggleOrderMode()" style="width:100%;">æ‰‹å‹•æ³¨æ–‡: OFF</button>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <button onclick="settings.buyItem('trash')" style="flex:1;" id="btn-buy-trash">ã‚´ãƒŸç®±(1ä¸‡)</button>
                <button onclick="settings.buyItem('clean')" style="flex:1;" id="btn-buy-clean">æ¸…æƒ(5ä¸‡)</button>
            </div>
        </div>
        <button onclick="ui.closeModal('modal-settings')" style="width:100%; margin-top:10px;" id="btn-settings-close">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-ads" class="modal-overlay">
    <div class="modal-content">
        <h3 id="ads-modal-title">å®£ä¼æ´»å‹•</h3>
        <p><span id="ad-status-label">ç¾åœ¨åŠ¹æœ</span>: <span id="ad-status-detail" style="color:#2ecc71; font-weight:bold;">0%</span></p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="ads.start('poster')" id="btn-ad-poster">ãƒã‚¹ã‚¿ãƒ¼<br>(2ä¸‡)</button>
            <button onclick="ads.start('flyer')" id="btn-ad-flyer">ãƒãƒ©ã‚·<br>(5ä¸‡)</button>
            <button onclick="ads.start('cm')" id="btn-ad-cm">CM<br>(20ä¸‡)</button>
            <button onclick="ads.start('tv')" id="btn-ad-tv">TVç•ªçµ„<br>(50ä¸‡)</button>
        </div>
        <button onclick="ui.closeModal('modal-ads')" style="width:100%; margin-top:15px;" id="btn-ads-close">é–‰ã˜ã‚‹</button>
    </div>
</div>


<script>
/* ãƒ‡ãƒ¼ã‚¿å®šç¾© */
const IMAGES = ["https://i.ibb.co/2YPFhJ1D/IMG-2529.jpg","https://i.ibb.co/p6DSzpHQ/IMG-2529.jpg","https://i.ibb.co/BHW5cMvS/IMG-2529.jpg","https://i.ibb.co/7tjqbkkX/IMG-2529.jpg","https://i.ibb.co/Xkkr114y/IMG-2529.jpg"];

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ (ã‚«ãƒ†ã‚´ãƒªä»˜ä¸) - ç¿»è¨³ãŒå¿…è¦ãªã®ã¯nameã ã‘
const MENUS = {
    fastfood: [
        {id:'b_cheese',name_ja:'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼',name_en:'Cheeseburger',price:500,cat:'main'}, {id:'b_teri',name_ja:'ãƒ†ãƒªãƒ¤ã‚­',name_en:'Teriyaki Burger',price:500,cat:'main'}, {id:'b_plain',name_ja:'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼',name_en:'Plain Burger',price:500,cat:'main'}, {id:'b_rice',name_ja:'ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚¬ãƒ¼',name_en:'Rice Burger',price:500,cat:'main'},
        {id:'set_burger',name_ja:'ãƒãƒ¼ã‚¬ãƒ¼ã‚»ãƒƒãƒˆ',name_en:'Burger Set',price:700,cat:'main'}, {id:'set_potato',name_ja:'ãƒãƒ†ãƒˆã‚»ãƒƒãƒˆ',name_en:'Potato Set',price:600,cat:'side'},
        {id:'pot_s',name_ja:'ãƒãƒ†ãƒˆS',name_en:'Fries S',price:200,cat:'side'}, {id:'pot_m',name_ja:'ãƒãƒ†ãƒˆM',name_en:'Fries M',price:300,cat:'side'}, {id:'pot_l',name_ja:'ãƒãƒ†ãƒˆL',name_en:'Fries L',price:450,cat:'side'}, {id:'nugget',name_ja:'ãƒŠã‚²ãƒƒãƒˆ',name_en:'Nuggets',price:300,cat:'side'},
        {id:'shake_v',name_ja:'ãƒãƒ‹ãƒ©ã‚·ã‚§ã‚¤ã‚¯',name_en:'Vanilla Shake',price:300,cat:'drink'}, {id:'shake_s',name_ja:'ã„ã¡ã”ã‚·ã‚§ã‚¤ã‚¯',name_en:'Strawberry Shake',price:300,cat:'drink'},
        {id:'j_org',name_ja:'ã‚ªãƒ¬ãƒ³ã‚¸',name_en:'Orange Juice',price:300,cat:'drink'}, {id:'j_apl',name_ja:'ãƒªãƒ³ã‚´',name_en:'Apple Juice',price:300,cat:'drink'}, {id:'j_col',name:'ã‚³ãƒ¼ãƒ©',name_en:'Coke',price:300,cat:'drink'}, {id:'j_mel',name_ja:'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€',name_en:'Melon Soda',price:300,cat:'drink'}
    ],
    restaurant: [
        {id:'p_mar',name_ja:'ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿',name_en:'Margherita Pizza',price:1200,cat:'main'}, {id:'p_chs',name_ja:'ãƒãƒ¼ã‚ºãƒ”ã‚¶',name_en:'Cheese Pizza',price:1200,cat:'main'},
        {id:'spa_nap',name_ja:'ãƒŠãƒãƒªã‚¿ãƒ³',name_en:'Napolitan Pasta',price:1000,cat:'main'}, {id:'spa_tom',name_ja:'ãƒˆãƒãƒˆãƒ‘ã‚¹ã‚¿',name_en:'Tomato Pasta',price:1000,cat:'main'}, {id:'spa_car',name_ja:'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©',name_en:'Carbonara',price:1000,cat:'main'},
        {id:'pancake',name_ja:'ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­',name_en:'Pancake',price:900,cat:'main'}, {id:'hamburg',name_ja:'ãƒãƒ³ãƒãƒ¼ã‚°',name_en:'Hamburg Steak',price:1300,cat:'main'}, {id:'steak',name_ja:'ã‚¹ãƒ†ãƒ¼ã‚­',name_en:'Steak',price:1400,cat:'main'},
        {id:'salad',name_ja:'ã‚µãƒ©ãƒ€',name_en:'Salad',price:500,cat:'side'}, {id:'potato',name_ja:'ãƒãƒ†ãƒˆ',name_en:'Fries',price:400,cat:'side'}, {id:'parfait',name_ja:'ãƒ‘ãƒ•ã‚§',name_en:'Parfait',price:700,cat:'side'}, {id:'pudding',name_ja:'ãƒ—ãƒªãƒ³',name_en:'Pudding',price:400,cat:'side'},
        {id:'rice',name_ja:'ã”é£¯',name_en:'Rice',price:350,cat:'side'}, {id:'j_org',name_ja:'ã‚ªãƒ¬ãƒ³ã‚¸',name_en:'Orange Juice',price:300,cat:'drink'}, {id:'j_apl',name_ja:'ãƒªãƒ³ã‚´',name_en:'Apple Juice',price:300,cat:'drink'}, {id:'j_cal',name_ja:'ã‚«ãƒ«ãƒ”ã‚¹',name_en:'Calpis',price:300,cat:'drink'}, {id:'j_col',name_ja:'ã‚³ãƒ¼ãƒ©',name_en:'Coke',price:300,cat:'drink'}, {id:'j_mel',name_ja:'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€',name_en:'Melon Soda',price:300,cat:'drink'}
    ]
};

const EMPLOYEES = {
    master: { name_ja: 'ãƒã‚¹ã‚¿ãƒ¼', name_en: 'Master', speed: 2.5, cost: 200000, maintain: 250000, wait: 4, power: 4 }, 
    veteran: { name_ja: 'ãƒ™ãƒ†ãƒ©ãƒ³', name_en: 'Veteran', speed: 1.6, cost: 120000, maintain: 200000, wait: 6.25, power: 3 },
    standard: { name_ja: 'æ¨™æº–', name_en: 'Standard', speed: 1.0, cost: 80000, maintain: 150000, wait: 10, power: 2 },
    ponkotsu: { name_ja: 'ãƒãƒ³ã‚³ãƒ„', name_en: 'Rookie', speed: 0.5, cost: 40000, maintain: 100000, wait: 20, power: 1 }
};

const LOCATIONS = {
    big_city: { max: 10 }, city: { max: 8 }, mid_city: { max: 6 }, small_city: { max: 4 }
};

const DAYS = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];


/* è¨€èªãƒ‡ãƒ¼ã‚¿å®šç¾© (L) */
const L = {
    ja: {
        // æ™‚åˆ»è¡¨ç¤º
        time: (day, wd, h, m) => `Day ${day} (${DAYS[wd]}) ${('0'+h).slice(-2)}:${('0'+m).slice(-2)}`,
        // ãƒ˜ãƒƒãƒ€ãƒ¼
        money: "è³‡ç”£", earnings: "ç´¯è¨ˆ", speed: (s) => `x${s}`,
        menu: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼", employees: "å¾“æ¥­å“¡", settings: "è¨­å®š", stats: "çµ±è¨ˆ", help: "èª¬æ˜", ad_btn: "å®£ä¼",
        mode_pc: "ğŸ’» PC", mode_mobile: "ğŸ“± ã‚¹ãƒãƒ›", ad_buff: (b) => `å®£ä¼:+${b}%`,
        // ãƒ›ãƒ¼ãƒ ç”»é¢
        title: "ğŸ” Kitchen Tycoon ğŸ", title_ver: "v1.25 Language Support",
        home_start: "æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹", home_load: "ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿èª­è¾¼", home_help: "èª¬æ˜æ›¸ (éŠã³æ–¹ãƒ»è£ä»•æ§˜)",
        home_cheat: "ãƒãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸",
        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        setup_title: "æ–°è¦åº—èˆ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—", type: "åº—ã®ç¨®é¡", location: "å ´æ‰€",
        loc_big_city: "å¤§éƒ½å¸‚ (MAX 10å¸­)", loc_city: "éƒ½å¸‚éƒ¨ (MAX 8å¸­)", loc_mid_city: "ä¸­éƒ½å¸‚ (MAX 6å¸­)", loc_small_city: "å°éƒ½å¸‚ (MAX 4å¸­)",
        seats: "åˆæœŸå¸­æ•°", difficulty: "é›£æ˜“åº¦", diff_hard: "é›£ã—ã„", diff_normal: "æ™®é€š", diff_easy: "ç°¡å˜",
        menu_select: "åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ (5ã¤é¸æŠ):", setup_start: "é–‹åº—ã™ã‚‹", setup_back: "æˆ»ã‚‹",
        // ã‚·ãƒ¼ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        seat_empty: "ç©ºå¸­", seat_sitting: "ç€å¸­", seat_ordering: "æ³¨æ–‡", 
        seat_cooking: (r) => `èª¿ç†(${r})`, seat_eating: "é£Ÿäº‹", seat_paying: "ä¼šè¨ˆ",
        staff_room: (load) => `ã‚¹ã‚¿ãƒƒãƒ•ãƒ«ãƒ¼ãƒ  (${load}å“åŒæ™‚)`,
        staff_status: (load) => `${load}/4 èª¿ç†`,
        // å¾“æ¥­å“¡
        emp_title: "ğŸ‘©â€ğŸ³ å¾“æ¥­å“¡ & ã‚­ãƒƒãƒãƒ³æ‹…å½“", emp_hire: "é›‡ç”¨ã‚»ãƒ³ã‚¿ãƒ¼", emp_assign: "ğŸ½ï¸ æ‹…å½“å‰²ã‚Šå½“ã¦ (1å“ã«ã¤ã4äººã¾ã§)",
        main: "ãƒ¡ã‚¤ãƒ³", side: "ã‚µã‚¤ãƒ‰", drink: "ãƒ‰ãƒªãƒ³ã‚¯", assign_empty: "ã“ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“",
        hire_master: "ãƒã‚¹ã‚¿ãƒ¼(20ä¸‡)", hire_veteran: "ãƒ™ãƒ†ãƒ©ãƒ³(12ä¸‡)", hire_standard: "æ¨™æº–(8ä¸‡)", hire_ponkotsu: "ãƒãƒ³ã‚³ãƒ„(4ä¸‡)",
        fire: "è§£é›‡", close: "é–‰ã˜ã‚‹",
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        modal_menu_title: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼", menu_pause: "ä¸€æ™‚åœæ­¢/å†é–‹", menu_save: "ã‚»ãƒ¼ãƒ–", menu_quit: "ã‚„ã‚ã‚‹",
        // è¨­å®š
        settings_title: "åº—èˆ—è¨­å®š", popup_setting: (on) => `1æ—¥çµ‚äº†æ™‚ã®çµæœè¡¨ç¤º: ${on ? 'ON' : 'OFF'}`,
        menu_edit_btn: "ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¾¡æ ¼ç®¡ç†", menu_edit_apply: "é©ç”¨",
        order_mode: (on) => `æ‰‹å‹•æ³¨æ–‡: ${on ? 'ON' : 'OFF'}`,
        buy_trash: "ã‚´ãƒŸç®±(1ä¸‡)", buy_clean: "æ¸…æƒ(5ä¸‡)",
        expand_title: "ğŸ—ï¸ åº—èˆ—æ‹¡å¼µ",
        expand_normal_15: "15å¸­ã¸ (ç´¯è¨ˆ10ä¸‡)", expand_normal_20: "20å¸­ã¸ (ç´¯è¨ˆ20ä¸‡)",
        expand_cleared_title: "ğŸ‰ è‡ªç”±æ‹¡å¼µ (Max 40)",
        // é€šçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
        alert_no_menu: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„", alert_money_short: "è³‡é‡‘ä¸è¶³",
        alert_hired: (name) => `${name}ã‚’é›‡ã„ã¾ã—ãŸï¼`, alert_fire_fail: "æœ€å¾Œã®1äººã¯è§£é›‡ã§ãã¾ã›ã‚“", alert_fire_confirm: "è§£é›‡ã—ã¾ã™ã‹ï¼Ÿ",
        alert_menu_count: "5ã¤é¸æŠã—ã¦ãã ã•ã„", alert_menu_update: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°å®Œäº†",
        alert_ad_start: "å®£ä¼é–‹å§‹", alert_expand_fail: "å®Ÿç¸¾ä¸è¶³", alert_expand_done: (s) => `æ‹¡å¼µå®Œäº†ï¼${s}å¸­`,
        alert_trash: "ã‚´ãƒŸç®±è¨­ç½®ï¼", alert_clean: "æ¸…æƒå®Œäº†ï¼", alert_end_day: (r) => `1æ—¥çµ‚äº†ã€‚å£²ä¸Š: Â¥${r.toLocaleString()}`,
        alert_fixed_cost: (rent, emp) => `10æ—¥ã”ã¨ã®æ”¯æ‰•ã„æ—¥ã§ã™ã€‚\nå®¶è³ƒ: ${rent.toLocaleString()}å††\näººä»¶è²»: ${emp.toLocaleString()}å††\nåˆè¨ˆ: ${(rent+emp).toLocaleString()}å††æ”¯æ‰•ã„ã¾ã—ãŸã€‚`,
        alert_kicked: (n) => `é–‰åº—æ™‚é–“ã€‚${n}çµ„ã‚’ãŠæ–­ã‚Šã—ã¾ã—ãŸã€‚`,
        alert_win: "ğŸ‰ ã‚¯ãƒªã‚¢æ¡ä»¶é”æˆï¼ ğŸ‰\nãƒœãƒ¼ãƒŠã‚¹200ä¸‡å††ã‚’ç²å¾—ï¼\nä¸Šé™40å¸­ã¾ã§æ‹¡å¼µå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼",
        alert_game_over: (msg) => `GAME OVER\n${msg}`,
        alert_game_over_broke: "ç ´ç”£ã—ã¾ã—ãŸ...", alert_game_over_reputation: "è©•ä¾¡ãŒä½ã™ãã¾ã™...",
        // çµ±è¨ˆ
        stats_title: "ğŸ“Š çµŒå–¶çµ±è¨ˆ",
        stats_today_rev: "æœ¬æ—¥ã®å£²ä¸Š", stats_today_exp: "æœ¬æ—¥ã®å‡ºè²»",
        stats_data_short: "ãƒ‡ãƒ¼ã‚¿ä¸è¶³ (2æ—¥ç›®ä»¥é™)", graph_rev: "å£²ä¸Š", graph_asset: "ç·è³‡ç”£",
        // å®£ä¼
        ads_title: "å®£ä¼æ´»å‹•", ads_status: (b) => `ç¾åœ¨åŠ¹æœ: ${b}%`, ads_label: "å®£ä¼",
        ads_poster: "ãƒã‚¹ã‚¿ãƒ¼\n(2ä¸‡)", ads_flyer: "ãƒãƒ©ã‚·\n(5ä¸‡)", ads_cm: "CM\n(20ä¸‡)", ads_tv: "TVç•ªçµ„\n(50ä¸‡)",
        // ãƒ—ãƒ¬ã‚¤ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        play_open: "æœ¬æ—¥ã‚‚é–‹åº—ã§ã™ï¼", play_order: (n) => `å¸­${n}: æ³¨æ–‡å¾…ã¡`, play_order_ok: (n) => `å¸­${n}: ${n}å“æ³¨æ–‡`, play_payment: (p) => `ä¼šè¨ˆ: Â¥${p.toLocaleString()}`,
    },
    en: {
        // Time Display
        time: (day, wd, h, m) => `Day ${day} (${['Mon','Tue','Wed','Thu','Fri','Sat','Sun'][wd]}) ${('0'+h).slice(-2)}:${('0'+m).slice(-2)}`,
        // Header
        money: "Assets", earnings: "Total", speed: (s) => `x${s}`,
        menu: "Menu", employees: "Staff", settings: "Settings", stats: "Stats", help: "Help", ad_btn: "Ad",
        mode_pc: "ğŸ’» PC", mode_mobile: "ğŸ“± Mobile", ad_buff: (b) => `Ad Buff: +${b}%`,
        // Home Screen
        title: "ğŸ” Kitchen Tycoon ğŸ", title_ver: "v1.25 Language Support",
        home_start: "New Game", home_load: "Load Save Data", home_help: "Manual (How to Play)",
        home_cheat: "To Cheat Edition",
        // Setup
        setup_title: "New Store Setup", type: "Store Type", location: "Location",
        loc_big_city: "Big City (MAX 10 Seats)", loc_city: "City (MAX 8 Seats)", loc_mid_city: "Mid City (MAX 6 Seats)", loc_small_city: "Small City (MAX 4 Seats)",
        seats: "Initial Seats", difficulty: "Difficulty", diff_hard: "Hard", diff_normal: "Normal", diff_easy: "Easy",
        menu_select: "Initial Menu (Select 5):", setup_start: "Open Store", setup_back: "Back",
        // Seat Status
        seat_empty: "Empty", seat_sitting: "Sitting", seat_ordering: "Ordering", 
        seat_cooking: (r) => `Cooking(${r})`, seat_eating: "Eating", seat_paying: "Paying",
        staff_room: (load) => `Staff Room (${load} Dishes Max)`,
        staff_status: (load) => `${load}/4 Cooking`,
        // Employees
        emp_title: "ğŸ‘©â€ğŸ³ Staff & Kitchen Assignment", emp_hire: "Hiring Center", emp_assign: "ğŸ½ï¸ Task Assignment (Max 4 per Dish)",
        main: "Main", side: "Side", drink: "Drink", assign_empty: "No menus in this category",
        hire_master: "Master(Â¥200k)", hire_veteran: "Veteran(Â¥120k)", hire_standard: "Standard(Â¥80k)", hire_ponkotsu: "Rookie(Â¥40k)",
        fire: "Fire", close: "Close",
        // Modal Menu
        modal_menu_title: "Menu", menu_pause: "Pause/Resume", menu_save: "Save", menu_quit: "Quit",
        // Settings
        settings_title: "Store Settings", popup_setting: (on) => `Daily Result Pop-up: ${on ? 'ON' : 'OFF'}`,
        menu_edit_btn: "ğŸ“ Manage Menu Prices", menu_edit_apply: "Apply",
        order_mode: (on) => `Manual Ordering: ${on ? 'ON' : 'OFF'}`,
        buy_trash: "Trash Bin(Â¥10k)", buy_clean: "Cleaning(Â¥50k)",
        expand_title: "ğŸ—ï¸ Store Expansion",
        expand_normal_15: "Expand to 15 Seats (Â¥100k)", expand_normal_20: "Expand to 20 Seats (Â¥200k)",
        expand_cleared_title: "ğŸ‰ Free Expansion (Max 40)",
        // Notifications/Alerts
        alert_no_menu: "Please select a menu.", alert_money_short: "Insufficient funds.",
        alert_hired: (name) => `Hired ${name}!`, alert_fire_fail: "Cannot fire the last employee.", alert_fire_confirm: "Are you sure you want to fire?",
        alert_menu_count: "Please select exactly 5 items.", alert_menu_update: "Menu updated.",
        alert_ad_start: "Advertising started.", alert_expand_fail: "Insufficient earnings.", alert_expand_done: (s) => `Expansion complete! ${s} seats.`,
        alert_trash: "Trash bin installed!", alert_clean: "Cleaning complete!", alert_end_day: (r) => `Day finished. Revenue: Â¥${r.toLocaleString()}`,
        alert_fixed_cost: (rent, emp) => `10-day payment due.\nRent: Â¥${rent.toLocaleString()}\nLabor Cost: Â¥${emp.toLocaleString()} paid.`,
        alert_kicked: (n) => `Closing time. Refused ${n} groups.`,
        alert_win: "ğŸ‰ Clear Condition Achieved! ğŸ‰\nReceived Â¥2,000,000 Bonus!\nMax capacity expanded to 40 seats!",
        alert_game_over: (msg) => `GAME OVER\n${msg}`,
        alert_game_over_broke: "Went bankrupt...", alert_game_over_reputation: "Reputation is too low...",
        // Stats
        stats_title: "ğŸ“Š Business Stats",
        stats_today_rev: "Today's Revenue", stats_today_exp: "Today's Expense",
        stats_data_short: "Insufficient data (Day 2 onwards)", graph_rev: "Revenue", graph_asset: "Assets",
        // Ads
        ads_title: "Advertising Campaign", ads_status: (b) => `Current Buff: ${b}%`, ads_label: "Ad",
        ads_poster: "Poster\n(Â¥20k)", ads_flyer: "Flyer\n(Â¥50k)", ads_cm: "CM\n(Â¥200k)", ads_tv: "TV Show\n(Â¥500k)",
        // In-game messages
        play_open: "The store is open!", play_order: (n) => `Seat ${n}: Waiting for order`, play_order_ok: (n) => `Seat ${n}: ${n} items ordered`, play_payment: (p) => `Payment: Â¥${p.toLocaleString()}`,
    }
};


/* BGMè¨­å®š */
const bgm = {
    obj: null,
    base: "https://raw.githubusercontent.com/tamani3901/restaurant-management-game-ver2/main/",
    tracks: { weekday: "å¤•é£Ÿå¾Œã®ã¾ã£ãŸã‚Šã‚¿ã‚¤ãƒ .mp3", weekend: "ã¾ã‚“ã·ãé£Ÿå ‚.mp3" },
    currentType: null,
    muted: false,
    play: () => {
        if(bgm.muted) return;
        const isWeekend = (G.weekDay >= 5);
        const type = isWeekend ? 'weekend' : 'weekday';
        
        if (!bgm.obj) {
            bgm.obj = new Audio();
            bgm.obj.loop = true;
        }
        
        // åœŸæ—¥ã ã‘éŸ³é‡ã‚’ 0.3 ã«ä¸Šã’ã‚‹ (å¹³æ—¥ã¯ 0.1)
        bgm.obj.volume = isWeekend ? 0.3 : 0.1; 

        // URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‡¦ç†
        const targetSrc = bgm.base + encodeURIComponent(bgm.tracks[type]);
        
        if (bgm.currentType !== type) {
            bgm.currentType = type;
            bgm.obj.src = targetSrc;
            bgm.obj.play().catch(e => console.log("Audio Error:", e));
        } else if (bgm.obj.paused) {
            bgm.obj.play().catch(e => console.log("Audio Error:", e));
        }
    },
    stop: () => {
        if (bgm.obj) {
            bgm.obj.pause();
            bgm.obj.currentTime = 0;
        }
    },
    toggle: () => {
        bgm.muted = !bgm.muted;
        const btn = document.getElementById('btn-audio-toggle');
        if(bgm.muted) {
            if(bgm.obj) bgm.obj.pause();
            btn.style.opacity = "0.5";
            btn.innerText = "ğŸ”‡";
        } else {
            btn.style.opacity = "1";
            btn.innerText = "â™ª";
            bgm.play();
        }
    }
};

/* ã‚²ãƒ¼ãƒ çŠ¶æ…‹ */
let G = {
    mode: 'mobile', state: 'home', type: null, location: null, maxSeats: 0,
    money: 15000000, totalEarnings: 0, reputation: 5.0, day: 1, time: 540, weekDay: 0,
    seats: [], menu: [], 
    employees: ['master'], 
    kitchenMap: {}, // menuId -> [empIdx, empIdx, ...] (Array)
    manualOrder: false, difficulty: 'normal', activeAds: [], bailoutUsed: false, trashBin: false,
    timerId: null, activeOrder: null,
    statsHistory: [], dailyRevenue: 0, dailyExpense: 0,
    speed: 1, isCleared: false, showResultPopup: true,
    language: 'ja' // â˜…â˜…â˜… è¨€èªè¨­å®šã‚’è¿½åŠ  â˜…â˜…â˜…
};


/* ãƒ­ã‚¸ãƒƒã‚¯ */
const game = {
    showHome: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-home').classList.add('active');
        bgm.stop();
        G.state = 'home';
        ui.localizeUI(); // ãƒ›ãƒ¼ãƒ ç”»é¢è¡¨ç¤ºæ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º
    },
    showSetup: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-setup').classList.add('active');
        setup.updateMenuOptions();
        setup.updateSizeOptions();
        G.state = 'setup';
        ui.localizeUI(); // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢è¡¨ç¤ºæ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚º
    },
    startGame: () => {
        const selectedMenu = Array.from(document.querySelectorAll('.item-select.selected')).map(e => e.dataset.id);
        if (selectedMenu.length < 5) { game.alert('alert_no_menu'); return; } 
        
        G.type = document.getElementById('setup-type').value;
        const locKey = document.getElementById('setup-location').value;
        G.location = locKey;
        G.maxSeats = parseInt(document.getElementById('setup-seats').value);
        G.difficulty = document.getElementById('setup-difficulty').value;
        G.menu = selectedMenu;
        G.money = (G.difficulty === 'hard') ? 12000000 : 12000000; 
        
        if (G.maxSeats > 8) G.money -= 3000000;
        else if (G.maxSeats > 4) G.money -= 2000000;

        G.employees = ['master']; 
        G.reputation = 5.0;
        G.day = 1; G.time = 540; G.weekDay = 0;
        G.seats = Array(G.maxSeats).fill(null).map(() => ({ occupied: false, customer: null, status: 'empty', waitTime: 0 }));
        G.totalEarnings = 0;
        G.activeAds = [];
        G.statsHistory = [];
        G.dailyRevenue = 0; G.dailyExpense = 0;
        G.speed = 1;
        G.isCleared = false;
        G.showResultPopup = true;
        
        settings.resetAssignments();

        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-game').classList.add('active');
        G.state = 'playing';
        
        game.setSpeed(1);
        ui.localizeUI();
        bgm.play();

        ui.renderSeats();
        ui.updateStaffPanel();
        ui.updateHeader();
        game.ticker(L[G.language].play_open);
    },

    setSpeed: (spd) => {
        G.speed = spd;
        if (G.timerId) clearInterval(G.timerId);
        if (G.state === 'playing') {
            G.timerId = setInterval(game.loop, 1000 / G.speed);
        }
        document.querySelectorAll('.speed-btn').forEach((btn, idx) => {
            btn.innerText = L[G.language].speed(idx + 1); // è¨€èªé©ç”¨
            if (idx + 1 === spd) btn.classList.add('active');
            else btn.classList.remove('active');
        });
    },

    loop: () => {
        if (G.state !== 'playing') return;

        G.time += 5;
        
        if (G.time === 1320) { 
            let kicked = 0;
            G.seats.forEach((s, i) => {
                if (s.occupied && s.status !== 'eating') {
                    s.occupied = false; s.customer = null; s.status = 'empty';
                    kicked++;
                }
            });
            if(kicked > 0) game.ticker(L[G.language].alert_kicked(kicked));
            ui.renderSeats(); ui.updateStaffPanel();
        }

        if (G.time >= 1320) {
            const eaters = G.seats.filter(s => s.occupied);
            if (eaters.length === 0) { game.endDay(); return; }
        } else {
            game.trySpawnCustomer();
        }
        
        ui.updateHeader();
        game.processCooking(); 

        G.seats.forEach((seat, idx) => {
            if (!seat.occupied) return;
            const c = seat.customer;

            if (seat.status === 'sitting') {
                seat.status = 'ordering';
                if (c.isTablet || !G.manualOrder) setTimeout(() => game.processOrder(idx), 500 / G.speed);
                else { ui.updateSeat(idx); game.ticker(L[G.language].play_order(idx + 1)); }
            } else if (seat.status === 'cooking') {
                const pending = c.order.filter(o => o.status !== 'served');
                if (pending.length === 0) {
                    seat.status = 'eating'; seat.progress = 0;
                    const sec = seat.realWaitTime; let sat = 60;
                    if (sec <= 4) sat = 100; else if (sec <= 6.25) sat = 75; else if (sec <= 10) sat = 60; else sat = 45;
                    if (G.trashBin) sat += 5; seat.satisfaction = sat;
                } else {
                    seat.realWaitTime = (seat.realWaitTime || 0) + 1;
                }
                ui.updateSeat(idx);
            } else if (seat.status === 'eating') {
                seat.progress += 5;
                if (seat.progress >= 30) { seat.status = 'paying'; game.processPayment(idx); }
            }
        });
        ui.updateStaffPanel();
    },

    processCooking: () => {
        // ... (çœç•¥: ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã«é–¢ã‚ã‚‰ãªã„ãŸã‚)
        const empLoad = new Array(G.employees.length).fill(0);
        G.seats.forEach(seat => {
            if (seat.occupied && seat.customer.order) {
                seat.customer.order.forEach(item => {
                    if (item.status === 'cooking' && item.chefIdx !== null) {
                        empLoad[item.chefIdx]++;
                    }
                });
            }
        });

        G.seats.forEach(seat => {
            if (seat.occupied && seat.status === 'cooking') {
                seat.customer.order.forEach(item => {
                    if (item.status === 'pending') {
                        const assignedChefs = G.kitchenMap[item.id] || [0];
                        let bestChef = -1;
                        let minLoad = 4; // Max 4
                        assignedChefs.forEach(cIdx => {
                            if (cIdx < G.employees.length && empLoad[cIdx] < minLoad) {
                                bestChef = cIdx;
                                minLoad = empLoad[cIdx];
                            }
                        });
                        if (bestChef !== -1) {
                            item.status = 'cooking';
                            item.chefIdx = bestChef;
                            item.progress = 0;
                            empLoad[bestChef]++;
                        }
                    } else if (item.status === 'cooking') {
                        const emp = EMPLOYEES[G.employees[item.chefIdx]];
                        const reqTime = (emp.wait * 60) / 5; 
                        item.progress += 5;
                        if (item.progress >= reqTime) {
                            item.status = 'served';
                            empLoad[item.chefIdx]--;
                        }
                    }
                });
            }
        });
    },

    trySpawnCustomer: () => {
        let rate = 10; const h = Math.floor(G.time / 60);
        if ((h >= 11 && h < 13)) rate += (G.weekDay >= 5) ? 30 : 10; 
        if (G.weekDay >= 5) rate += 20;
        let adBuff = 0;
        G.activeAds.forEach(ad => { if (ad.daysLeft > 0) adBuff += ad.buff; else if (ad.afterDays > 0) adBuff += ad.afterBuff; });
        rate += adBuff;
        if (G.reputation < 1.5) rate *= 0.4; else if (G.reputation < 2.5) rate *= 0.6; else if (G.reputation < 3.5) rate *= 0.8;

        if (Math.random() * 100 < rate) {
            const emptyIdx = G.seats.findIndex(s => !s.occupied);
            if (emptyIdx !== -1) {
                const groupSize = Math.floor(Math.random() * 4) + 1;
                const isTablet = Math.random() > 0.5;
                const img = IMAGES[Math.floor(Math.random() * IMAGES.length)];
                G.seats[emptyIdx] = { occupied: true, status: 'sitting', progress: 0, realWaitTime: 0, customer: { size: groupSize, isTablet: isTablet, img: img, order: [] } };
                ui.updateSeat(emptyIdx);
            }
        }
    },

    processOrder: (seatIdx) => {
        const seat = G.seats[seatIdx]; if (!seat) return;
        const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
        const count = Math.floor(Math.random() * 5) + 1; 
        const orderItems = [];
        for(let i=0; i<count; i++) {
            const m = menuList[Math.floor(Math.random() * menuList.length)];
            orderItems.push({ ...m, status: 'pending', progress: 0, chefIdx: null });
        }
        seat.customer.order = orderItems; seat.status = 'cooking'; 
        ui.updateSeat(seatIdx); game.ticker(L[G.language].play_order_ok(seatIdx + 1, count));
    },

    manualOrderClick: (seatIdx) => {
        const seat = G.seats[seatIdx];
        if (seat && seat.status === 'ordering' && !seat.customer.isTablet) {
            G.activeOrder = seatIdx; document.getElementById('order-customer-img').src = seat.customer.img;
            const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
            const count = Math.floor(Math.random() * 5) + 1; 
            const orderItems = [];
            for(let i=0; i<count; i++) {
                const m = menuList[Math.floor(Math.random() * menuList.length)];
                orderItems.push({ ...m, status: 'pending', progress: 0, chefIdx: null });
            }
            seat.customer.order = orderItems;
            document.getElementById('order-text').innerText = L[G.language].play_order(count);
            document.getElementById('modal-order').style.display = 'flex'; game.togglePause(true);
        }
    },

    confirmOrder: () => { document.getElementById('modal-order').style.display = 'none'; game.togglePause(false); if (G.activeOrder !== null) { G.seats[G.activeOrder].status = 'cooking'; ui.updateSeat(G.activeOrder); G.activeOrder = null; } },

    processPayment: (seatIdx) => {
        const seat = G.seats[seatIdx]; if (!seat) return;
        let totalProfit = 0; seat.customer.order.forEach(item => { totalProfit += item.price; }); totalProfit *= seat.customer.size; 
        G.money += totalProfit; G.totalEarnings += totalProfit; G.dailyRevenue += totalProfit;
        const sat = seat.satisfaction;
        G.reputation = (G.reputation * 0.9) + ((sat / 20) * 0.1); 
        if (G.reputation > 5) G.reputation = 5; if (G.reputation < 1) G.reputation = 1;
        G.seats[seatIdx] = { occupied: false, customer: null, status: 'empty' };
        ui.updateSeat(seatIdx); ui.updateHeader(); game.ticker(L[G.language].play_payment(totalProfit));
    },

    endDay: () => {
        G.statsHistory.push({ day: G.day, revenue: G.dailyRevenue, assets: G.money, expense: G.dailyExpense });
        G.day++; G.weekDay = (G.weekDay + 1) % 7; G.time = 540; 
        
        bgm.play(); 
        
        G.activeAds.forEach(ad => {
            if (ad.daysLeft > 0) { ad.daysLeft--; if (ad.daysLeft === 0) { ad.afterDays = (ad.type === 'poster') ? 2 : (ad.type === 'flyer') ? 1 : (ad.type === 'cm') ? 3 : 5; } } else if (ad.afterDays > 0) { ad.afterDays--; }
        });
        G.activeAds = G.activeAds.filter(ad => ad.daysLeft > 0 || ad.afterDays > 0);

        if (G.day % 10 === 0) { 
            let empCost = 0;
            G.employees.forEach(key => { empCost += EMPLOYEES[key].maintain; });
            const rent = 1000000;
            const totalFixed = rent + empCost;
            G.money -= totalFixed; 
            G.dailyExpense += totalFixed; 
            alert(L[G.language].alert_fixed_cost(rent, empCost)); 
        }

        if (G.money < 2000000 && !G.bailoutUsed) { G.money += 5000000; G.bailoutUsed = true; alert(L[G.language].alert_bailout); }

        game.checkWinLose();
        clearInterval(G.timerId);
        
        const lastRevenue = G.statsHistory[G.statsHistory.length-1].revenue;
        if(G.showResultPopup) {
            alert(L[G.language].alert_end_day(lastRevenue));
        } else {
            game.ticker(L[G.language].alert_end_day(lastRevenue));
        }

        G.dailyRevenue = 0; G.dailyExpense = 0;
        G.timerId = setInterval(game.loop, 1000 / G.speed);
    },

    checkWinLose: () => {
        if (G.money < 0) { game.gameOver(L[G.language].alert_game_over_broke); return; }
        if (!G.isCleared) {
            let clear = false;
            if (G.difficulty === 'hard') { 
                if (G.reputation < 3.5) { game.gameOver(L[G.language].alert_game_over_reputation); return; } 
                if (G.totalEarnings >= 15000000) clear = true; 
            }
            else if (G.difficulty === 'normal') { if (G.totalEarnings >= 5000000) clear = true; }
            if (clear) {
                G.isCleared = true; G.money += 2000000;
                alert(L[G.language].alert_win);
                ui.updateHeader();
            }
        }
    },
    
    // â˜…â˜…â˜… ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨€èªå¯¾å¿œ
    alert: (key, ...args) => {
        let msg = L[G.language][key];
        if (typeof msg === 'function') msg = msg(...args);
        alert(msg);
    },
    gameOver: (msg) => { clearInterval(G.timerId); alert(L[G.language].alert_game_over(msg)); game.showHome(); },
    ticker: (msg) => { document.getElementById('ticker').innerText = msg; },
    togglePause: (forceState) => { if (forceState !== undefined) { if (forceState) clearInterval(G.timerId); else G.timerId = setInterval(game.loop, 1000 / G.speed); } else { if (G.timerId) { clearInterval(G.timerId); G.timerId = null; } else G.timerId = setInterval(game.loop, 1000 / G.speed); } },
    saveGame: () => { const json = JSON.stringify(G); const blob = new Blob([json], {type: "application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "kitchen_tycoon_save.json"; a.click(); },
    loadGameData: (input) => { const file = input.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const loaded = JSON.parse(e.target.result); if(loaded.customMenus) { MENUS.fastfood = loaded.customMenus.fastfood; MENUS.restaurant = loaded.customMenus.restaurant; } G = loaded; 
        if(typeof Object.values(G.kitchenMap)[0] === 'number') settings.resetAssignments();
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active')); document.getElementById('screen-game').classList.add('active'); game.setSpeed(1); ui.localizeUI(); bgm.play(); ui.renderSeats(); ui.updateStaffPanel(); ui.updateHeader(); } catch (err) { alert("ãƒ‡ãƒ¼ã‚¿ç ´æ"); } }; reader.readAsText(file); },
    quitGame: () => { if(confirm(L[G.language].menu_quit + "?")) { clearInterval(G.timerId); game.showHome(); ui.closeModal('modal-menu'); } }
};

/* è¨­å®šãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— */
const setup = {
    updateMenuOptions: () => {
        const type = document.getElementById('setup-type').value; const list = document.getElementById('setup-menu-list'); list.innerHTML = '';
        MENUS[type].forEach(item => { 
            const nameKey = `name_${G.language}`;
            const name = item[nameKey] || item.name_ja; // ç¿»è¨³ãŒãªã„å ´åˆã¯æ—¥æœ¬èª
            const div = document.createElement('div'); div.className = 'item-select'; div.innerText = `${name} (${item.price})`; div.style.cssText = "background:#2980b9;padding:8px;border-radius:4px;font-size:0.8rem;cursor:pointer;text-align:center;width:30%;"; div.dataset.id = item.id; div.onclick = () => { if (div.classList.contains('selected')) { div.classList.remove('selected'); div.style.background = '#2980b9'; } else if (document.querySelectorAll('.item-select.selected').length < 5) { div.classList.add('selected'); div.style.background = '#2ecc71'; } else { game.alert('alert_menu_count'); } }; 
            list.appendChild(div); 
            // é¸æŠæ¸ˆã¿ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å†é¸æŠ
            if (G.menu && G.menu.includes(item.id)) { div.classList.add('selected'); div.style.background = '#2ecc71'; }
        });
    },
    updateSizeOptions: () => {
        const loc = document.getElementById('setup-location').value; const max = LOCATIONS[loc].max; const select = document.getElementById('setup-seats'); select.innerHTML = '';
        for (let i = 4; i <= max; i+=2) { const op = document.createElement('option'); op.value = i; op.innerText = `${i}å¸­`; if (i===G.maxSeats) op.selected = true; select.appendChild(op); }
        if(G.state !== 'playing' && G.maxSeats === 0) select.value = max; // æ–°è¦ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚
    }
};

const settings = {
    toggleOrderMode: () => { G.manualOrder = !G.manualOrder; document.getElementById('btn-order-mode').innerText = L[G.language].order_mode(G.manualOrder); },
    togglePopup: () => { G.showResultPopup = !G.showResultPopup; document.getElementById('btn-toggle-popup').innerText = L[G.language].popup_setting(G.showResultPopup); },
    buyItem: (item) => { 
        if (item === 'trash' && G.money >= 10000) { G.money -= 10000; G.dailyExpense += 10000; G.trashBin = true; game.alert('alert_trash'); } 
        else if (item === 'clean' && G.money >= 50000) { G.money -= 50000; G.dailyExpense += 50000; G.reputation += 0.2; game.alert('alert_clean'); } 
        else { game.alert('alert_money_short'); } 
        ui.updateHeader(); 
    },
    hire: (type) => { 
        const emp = EMPLOYEES[type]; const nameKey = `name_${G.language}`;
        if (G.money >= emp.cost) { G.money -= emp.cost; G.dailyExpense += emp.cost; G.employees.push(type); game.alert('alert_hired', emp[nameKey] || emp.name_ja); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); ui.updateStaffPanel(); ui.updateHeader(); } else game.alert('alert_money_short'); 
    },
    fire: (index) => { 
        if (G.employees.length <= 1) { game.alert('alert_fire_fail'); return; } 
        if(confirm(L[G.language].alert_fire_confirm)) { G.employees.splice(index, 1); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); ui.updateStaffPanel(); ui.updateHeader(); } 
    },
    renderEmployeeList: () => { 
        const list = document.getElementById('current-employees-list'); list.innerHTML = ''; 
        G.employees.forEach((key, idx) => { 
            const nameKey = `name_${G.language}`;
            const data = EMPLOYEES[key]; const row = document.createElement('div'); row.className = 'emp-row'; row.style.cssText = 'display:flex; justify-content:space-between; align-items:center; font-size:0.8rem;';
            row.innerHTML = `<span>${idx+1}. ${data[nameKey] || data.name_ja}</span> <button onclick="settings.fire(${idx})" style="padding:2px 6px; font-size:0.7rem;">${L[G.language].fire}</button>`; list.appendChild(row); 
        }); 
    },
    
    resetAssignments: () => {
        G.kitchenMap = {};
        if(G.menu) G.menu.forEach(mid => G.kitchenMap[mid] = [0]);
    },
    switchAssignTab: (tabId) => {
        document.querySelectorAll('.help-tab').forEach(t => t.classList.remove('active'));
        const tabBtnMap = { 'assign-main': 'tab-btn-main', 'assign-side': 'tab-btn-side', 'assign-drink': 'tab-btn-drink' };
        document.getElementById(tabBtnMap[tabId]).classList.add('active');
        
        const category = tabId.split('-')[1];
        settings.renderAssignmentList(category);
    },
    renderAssignmentList: (category = 'main') => {
        const list = document.getElementById('assignment-container'); list.innerHTML = '';
        const currentMenu = MENUS[G.type].filter(m => G.menu.includes(m.id) && m.cat === category);
        
        if (currentMenu.length === 0) {
            list.innerHTML = `<p style="padding:10px; text-align:center; color:#bdc3c7;">${L[G.language].assign_empty}</p>`;
            return;
        }

        currentMenu.forEach(item => {
            const nameKey = `name_${G.language}`;
            const row = document.createElement('div'); row.className = 'assign-row';
            const nameDiv = document.createElement('div'); nameDiv.className = 'assign-name'; nameDiv.innerText = item[nameKey] || item.name_ja;
            const selectsDiv = document.createElement('div'); selectsDiv.className = 'assign-selects';

            const assigned = G.kitchenMap[item.id] || [0];
            
            for(let i=0; i<4; i++) {
                const select = document.createElement('select'); select.className = 'assign-select';
                
                const nullOpt = document.createElement('option'); nullOpt.value = -1; nullOpt.innerText = "-"; select.appendChild(nullOpt);

                G.employees.forEach((ekey, idx) => {
                    const empNameKey = `name_${G.language}`;
                    const opt = document.createElement('option');
                    opt.value = idx;
                    opt.innerText = `${idx+1}.${(EMPLOYEES[ekey][empNameKey] || EMPLOYEES[ekey].name_ja).substr(0,3)}`;
                    select.appendChild(opt);
                });

                if (i < assigned.length) select.value = assigned[i];
                else select.value = -1;

                select.onchange = () => {
                    const newAssign = [];
                    const selects = selectsDiv.querySelectorAll('select');
                    selects.forEach(s => {
                        const val = parseInt(s.value);
                        if(val !== -1) newAssign.push(val);
                    });
                    if(newAssign.length === 0) {
                        newAssign.push(0);
                        selectsDiv.querySelectorAll('select')[0].value = 0;
                    }
                    G.kitchenMap[item.id] = newAssign;
                };
                selectsDiv.appendChild(select);
            }

            row.appendChild(nameDiv); row.appendChild(selectsDiv); list.appendChild(row);
        });
    },

    toggleMenuEdit: () => { 
        const area = document.getElementById('menu-edit-area'); 
        if (area.style.display === 'none') { area.style.display = 'block'; settings.renderMenuEditList(); } else area.style.display = 'none'; 
    },
    renderMenuEditList: () => { 
        const list = document.getElementById('menu-edit-list'); list.innerHTML = ''; 
        MENUS[G.type].forEach(item => { 
            const nameKey = `name_${G.language}`;
            const row = document.createElement('div'); row.className = 'menu-edit-row'; 
            const isChecked = G.menu.includes(item.id) ? 'checked' : ''; 
            row.style.cssText = 'display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;';
            row.innerHTML = `<label><input type="checkbox" class="menu-chk" value="${item.id}" ${isChecked}> ${item[nameKey] || item.name_ja}</label><input type="number" id="price-${item.id}" value="${item.price}" min="10" style="width:60px;">`; 
            list.appendChild(row); 
        }); 
    },
    saveMenuChanges: () => { 
        const checkboxes = document.querySelectorAll('.menu-chk:checked'); 
        if (checkboxes.length !== 5) { game.alert("alert_menu_count"); return; } 
        MENUS[G.type].forEach(item => { const input = document.getElementById(`price-${item.id}`); if(input) item.price = parseInt(input.value); }); 
        G.menu = Array.from(checkboxes).map(cb => cb.value); 
        G.customMenus = { fastfood: MENUS.fastfood, restaurant: MENUS.restaurant }; 
        G.menu.forEach(mid => { if(G.kitchenMap[mid] === undefined) G.kitchenMap[mid] = [0]; });
        game.alert("alert_menu_update"); settings.toggleMenuEdit(); 
    },
    expandSeats: (target) => {
        if ((target === 15 && G.totalEarnings < 100000) || (target === 20 && G.totalEarnings < 200000)) { game.alert('alert_expand_fail'); return; }
        if (G.maxSeats >= target) { game.alert('alert_expand_done', target); return; }
        const added = target - G.maxSeats; G.maxSeats = target;
        for(let i=0; i<added; i++) G.seats.push({ occupied: false, customer: null, status: 'empty', waitTime: 0 });
        game.alert('alert_expand_done', target); ui.renderSeats(); ui.updateSettingsButtons();
    },
    changeSeats: (delta) => {
        if(!G.isCleared) return;
        const current = G.maxSeats; const next = current + delta;
        if (next < 4) { alert(L[G.language].expand_cleared_title); return; } if (next > 40) { alert(L[G.language].expand_cleared_title); return; }
        if (delta > 0) { for(let i=0; i<delta; i++) G.seats.push({ occupied: false, customer: null, status: 'empty', waitTime: 0 }); } 
        else { for(let i=0; i<Math.abs(delta); i++) G.seats.pop(); }
        G.maxSeats = next; ui.renderSeats(); ui.updateSettingsButtons();
    }
};

const ads = {
    start: (type) => {
        let cost=0, buff=0, dur=0; 
        if(type==='poster'){cost=20000;buff=15;dur=2;} if(type==='flyer'){cost=50000;buff=20;dur=2;} if(type==='cm'){cost=200000;buff=25;dur=10;} if(type==='tv'){cost=500000;buff=25;dur=1;}
        if (G.money < cost) { game.alert('alert_money_short'); return; }
        G.money -= cost; G.dailyExpense += cost;
        G.activeAds.push({ type: type, daysLeft: dur, buff: buff, afterBuff: 5, afterDays: 0 });
        if(type==='tv') G.activeAds[G.activeAds.length-1].afterBuff = 40; if(type==='cm') G.activeAds[G.activeAds.length-1].afterBuff = 20; 
        game.alert('alert_ad_start'); ui.updateHeader(); ui.closeModal('modal-ads');
    }
};

const stats = {
    range: 100, type: 'revenue',
    show: () => { 
        document.getElementById('modal-stats').style.display = 'flex'; game.togglePause(true); 
        stats.draw(); 
        document.getElementById('stat-label-rev').innerText = L[G.language].stats_today_rev; // è¨€èªå¯¾å¿œ
        document.getElementById('stat-label-exp').innerText = L[G.language].stats_today_exp; // è¨€èªå¯¾å¿œ
        document.getElementById('stat-today-rev').innerText = `Â¥${G.dailyRevenue.toLocaleString()}`; 
        document.getElementById('stat-today-exp').innerText = `Â¥${G.dailyExpense.toLocaleString()}`; 
    },
    setRange: (r) => { stats.range = r; stats.draw(); },
    setType: (t) => { 
        stats.type = t; 
        document.getElementById('btn-graph-rev').classList.remove('active'); document.getElementById('btn-graph-asset').classList.remove('active'); 
        if(t === 'revenue') document.getElementById('btn-graph-rev').classList.add('active'); 
        else document.getElementById('btn-graph-asset').classList.add('active'); 
        stats.draw(); 
    },
    draw: () => {
        const canvas = document.getElementById('stats-canvas'); const ctx = canvas.getContext('2d'); const w = canvas.width = canvas.offsetWidth; const h = canvas.height = canvas.offsetHeight; ctx.clearRect(0,0,w,h);
        let data = [...G.statsHistory]; if (stats.range > 0 && data.length > stats.range) data = data.slice(data.length - stats.range);
        if (data.length < 2) { ctx.fillStyle = "#333"; ctx.font = "14px Arial"; ctx.fillText(L[G.language].stats_data_short, 20, 50); return; } // è¨€èªå¯¾å¿œ
        let maxVal = 0, minVal = Infinity; data.forEach(d => { let val = (stats.type === 'revenue') ? d.revenue : d.assets; if(val > maxVal) maxVal = val; if(val < minVal) minVal = val; }); if (minVal > 0 && stats.type === 'revenue') minVal = 0;
        const padding = 20; ctx.beginPath(); ctx.strokeStyle = (stats.type === 'revenue') ? '#2ecc71' : '#f1c40f'; ctx.lineWidth = 2;
        data.forEach((d, i) => { let val = (stats.type === 'revenue') ? d.revenue : d.assets; let x = padding + (i / (data.length - 1)) * (w - padding * 2); let y = h - padding - ((val - minVal) / (maxVal - minVal || 1)) * (h - padding * 2); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); }); ctx.stroke();
    }
};

const ui = {
    // â˜…â˜…â˜… è¨€èªåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ â˜…â˜…â˜…
    toggleLanguage: () => {
        G.language = (G.language === 'ja') ? 'en' : 'ja';
        ui.localizeUI();
    },

    localizeUI: () => {
        const lang = G.language;
        const L_data = L[lang];
        
        // 1. ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³
        document.getElementById('btn-lang-toggle').innerText = lang === 'ja' ? 'EN' : 'JP';
        document.getElementById('btn-menu').innerText = L_data.menu;
        document.getElementById('btn-employees').innerText = L_data.employees;
        document.getElementById('btn-settings').innerText = L_data.settings;
        document.getElementById('btn-stats').innerText = L_data.stats;
        document.getElementById('btn-help').innerText = L_data.help;
        document.getElementById('btn-ad-toggle').innerText = L_data.ad_btn;
        ui.updateModeBtn();
        game.setSpeed(G.speed); // ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
        
        // 2. ãƒ›ãƒ¼ãƒ ç”»é¢
        document.getElementById('home-title').innerText = L_data.title;
        document.getElementById('home-version').innerText = L_data.title_ver;
        document.getElementById('btn-home-start').innerText = L_data.home_start;
        document.getElementById('btn-home-load').innerText = L_data.home_load;
        document.getElementById('btn-home-help').innerText = L_data.home_help;
        document.getElementById('btn-home-cheat').innerText = L_data.home_cheat;

        // 3. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢
        document.getElementById('setup-title').innerText = L_data.setup_title;
        document.getElementById('label-type').innerText = L_data.type + ':';
        document.getElementById('label-location').innerText = L_data.location + ':';
        document.getElementById('opt-loc-big').innerText = L_data.loc_big_city;
        document.getElementById('opt-loc-city').innerText = L_data.loc_city;
        document.getElementById('opt-loc-mid').innerText = L_data.loc_mid_city;
        document.getElementById('opt-loc-small').innerText = L_data.loc_small_city;
        document.getElementById('label-seats').innerText = L_data.seats + ':';
        document.getElementById('label-difficulty').innerText = L_data.difficulty + ':';
        document.getElementById('opt-diff-hard').innerText = L_data.diff_hard;
        document.getElementById('opt-diff-normal').innerText = L_data.diff_normal;
        document.getElementById('opt-diff-easy').innerText = L_data.diff_easy;
        document.getElementById('label-menu-select').innerText = L_data.menu_select;
        document.getElementById('btn-setup-start').innerText = L_data.setup_start;
        document.getElementById('btn-setup-back').innerText = L_data.setup_back;
        setup.updateMenuOptions();
        
        // 4. ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ UI
        ui.updateHeader();
        document.getElementById('staff-section-title').innerText = L_data.staff_room(4);
        ui.renderSeats(); 
        ui.updateStaffPanel();

        // 5. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¾“æ¥­å“¡ï¼‰
        document.getElementById('emp-modal-title').innerText = L_data.emp_title;
        document.getElementById('emp-modal-hire-title').innerText = L_data.emp_hire;
        document.getElementById('emp-modal-assign-title').innerText = L_data.emp_assign;
        document.getElementById('tab-btn-main').innerText = L_data.main;
        document.getElementById('tab-btn-side').innerText = L_data.side;
        document.getElementById('tab-btn-drink').innerText = L_data.drink;
        document.getElementById('btn-hire-master').innerText = L_data.hire_master;
        document.getElementById('btn-hire-veteran').innerText = L_data.hire_veteran;
        document.getElementById('btn-hire-standard').innerText = L_data.hire_standard;
        document.getElementById('btn-hire-ponkotsu').innerText = L_data.hire_ponkotsu;
        document.getElementById('btn-emp-close').innerText = L_data.close;
        settings.renderEmployeeList();
        
        // 6. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆçµ±è¨ˆï¼‰
        document.getElementById('stats-modal-title').innerText = L_data.stats_title;
        document.getElementById('btn-graph-rev').innerText = L_data.graph_rev;
        document.getElementById('btn-graph-asset').innerText = L_data.graph_asset;
        document.getElementById('btn-stats-close').innerText = L_data.close;
        
        // 7. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
        document.getElementById('menu-modal-title').innerText = L_data.modal_menu_title;
        document.getElementById('btn-menu-back').innerText = L_data.close;
        document.getElementById('btn-menu-pause').innerText = L_data.menu_pause;
        document.getElementById('btn-menu-save').innerText = L_data.menu_save;
        document.getElementById('btn-menu-quit').innerText = L_data.menu_quit;
        
        // 8. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆè¨­å®šï¼‰
        document.getElementById('settings-modal-title').innerText = L_data.settings_title;
        document.getElementById('settings-popup-h4').innerText = L_data.popup_setting(true).split(':')[0];
        document.getElementById('btn-toggle-popup').innerText = L_data.popup_setting(G.showResultPopup);
        document.getElementById('settings-expand-h4').innerText = L_data.expand_title;
        document.getElementById('btn-expand-15').innerText = L_data.expand_normal_15;
        document.getElementById('btn-expand-20').innerText = L_data.expand_normal_20;
        document.getElementById('expand-cleared-title').innerText = L_data.expand_cleared_title;
        document.getElementById('btn-menu-edit').innerText = L_data.menu_edit_btn;
        document.getElementById('btn-menu-apply').innerText = L_data.menu_edit_apply;
        document.getElementById('btn-order-mode').innerText = L_data.order_mode(G.manualOrder);
        document.getElementById('btn-buy-trash').innerText = L_data.buy_trash;
        document.getElementById('btn-buy-clean').innerText = L_data.buy_clean;
        document.getElementById('btn-settings-close').innerText = L_data.close;
        
        // 9. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå®£ä¼ï¼‰
        document.getElementById('ads-modal-title').innerText = L_data.ads_title;
        document.getElementById('ad-status-label').innerText = L_data.ads_status(0).split(':')[0];
        document.getElementById('btn-ad-poster').innerHTML = L_data.ads_poster;
        document.getElementById('btn-ad-flyer').innerHTML = L_data.ads_flyer;
        document.getElementById('btn-ad-cm').innerHTML = L_data.ads_cm;
        document.getElementById('btn-ad-tv').innerHTML = L_data.ads_tv;
        document.getElementById('btn-ads-close').innerText = L_data.close;

        // 10. ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆèª¬æ˜æ›¸ï¼‰
        document.getElementById('help-modal-title').innerText = L_data.help_modal_title || 'ğŸ“– ã‚²ãƒ¼ãƒ èª¬æ˜æ›¸';
        document.getElementById('btn-help-close').innerText = L_data.close;
        // èª¬æ˜æ›¸ã®æœ¬æ–‡ã‚‚æ›´æ–°ãŒå¿…è¦ (ã“ã“ã§ã¯ç°¡ç•¥åŒ–ã®ãŸã‚çœç•¥)
    },
    
    updateHeader: () => {
        const h = Math.floor(G.time / 60); const m = G.time % 60;
        document.getElementById('display-time').innerText = L[G.language].time(G.day, G.weekDay, h, m);
        
        document.getElementById('display-money').innerHTML = `${L[G.language].money}: <span style="color:var(--warning-color);">Â¥${G.money.toLocaleString()}</span>`;
        document.getElementById('display-earnings').innerHTML = `${L[G.language].earnings}: <span>Â¥${G.totalEarnings.toLocaleString()}</span>`;

        let stars = ""; for(let i=0; i<5; i++) stars += (i < Math.floor(G.reputation)) ? "â˜…" : "â˜†"; document.getElementById('display-stars').innerText = stars;
        let totalBuff = 0; G.activeAds.forEach(ad => { if (ad.daysLeft > 0) totalBuff += ad.buff; else if (ad.afterDays > 0) totalBuff += ad.afterBuff; }); document.getElementById('ad-buff-display').innerText = L[G.language].ad_buff(totalBuff);
        ui.updateSettingsButtons();
    },
    updateSettingsButtons: () => {
        const btn15 = document.getElementById('btn-expand-15'); const btn20 = document.getElementById('btn-expand-20');
        if (G.isCleared) {
            document.getElementById('expansion-normal').style.display = 'none';
            document.getElementById('expansion-cleared').style.display = 'block';
            document.getElementById('current-seats-display').innerText = `${G.maxSeats}å¸­`;
        } else {
            if(btn15 && btn20) {
                if(G.maxSeats >= 15) btn15.disabled = true; else btn15.disabled = (G.totalEarnings < 100000);
                if(G.maxSeats >= 20) btn20.disabled = true; else btn20.disabled = (G.totalEarnings < 200000);
            }
        }
    },
    renderSeats: () => {
        const con = document.getElementById('seats-container'); con.innerHTML = '';
        G.seats.forEach((seat, idx) => {
            const div = document.createElement('div'); div.className = 'seat'; div.id = `seat-${idx}`; div.onclick = () => game.manualOrderClick(idx);
            const info = document.createElement('div'); info.className = 'seat-status'; info.id = `seat-info-${idx}`; info.innerText = L[G.language].seat_empty;
            div.appendChild(info); con.appendChild(div);
            ui.updateSeat(idx); // åˆå›æç”»ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
        });
    },
    updateSeat: (idx) => {
        const seat = G.seats[idx]; const div = document.getElementById(`seat-${idx}`); const info = document.getElementById(`seat-info-${idx}`);
        if(!div) return;
        if (seat.occupied) {
            div.classList.add('occupied'); div.style.backgroundImage = `url(${seat.customer.img})`; div.style.backgroundSize = 'contain'; div.style.backgroundRepeat = 'no-repeat'; div.style.backgroundPosition = 'center';
            let txt = "";
            if (seat.status === 'sitting') txt = L[G.language].seat_sitting; 
            else if (seat.status === 'ordering') txt = L[G.language].seat_ordering; 
            else if (seat.status === 'cooking') {
                const remain = seat.customer.order.filter(o => o.status !== 'served').length;
                txt = L[G.language].seat_cooking(remain);
            }
            else if (seat.status === 'eating') txt = L[G.language].seat_eating; 
            else if (seat.status === 'paying') txt = L[G.language].seat_paying;
            info.innerText = txt;
        } else { div.classList.remove('occupied'); div.style.backgroundImage = 'none'; info.innerText = L[G.language].seat_empty; }
    },
    updateStaffPanel: () => {
        const con = document.getElementById('staff-container'); con.innerHTML = '';
        const empLoad = new Array(G.employees.length).fill(0);
        G.seats.forEach(seat => {
            if(seat.occupied && seat.customer.order) {
                seat.customer.order.forEach(item => {
                    if(item.status==='cooking' && item.chefIdx !== null) empLoad[item.chefIdx]++;
                });
            }
        });

        G.employees.forEach((key, idx) => {
            const nameKey = `name_${G.language}`;
            const load = empLoad[idx];
            const data = EMPLOYEES[key];
            const div = document.createElement('div');
            div.className = `staff-card ${load > 0 ? 'busy' : 'free'}`;
            div.innerHTML = `<div>${idx+1}. ${data[nameKey] || data.name_ja}</div><div class="staff-status-text">${L[G.language].staff_status(load)}</div>`;
            con.appendChild(div);
        });
    },
    toggleMenu: () => { document.getElementById('modal-menu').style.display = 'flex'; game.togglePause(true); ui.localizeUI(); },
    toggleSettings: () => { document.getElementById('modal-settings').style.display = 'flex'; game.togglePause(true); settings.renderEmployeeList(); document.getElementById('menu-edit-area').style.display = 'none'; ui.updateSettingsButtons(); ui.localizeUI(); },
    toggleEmployees: () => { document.getElementById('modal-employees').style.display = 'flex'; game.togglePause(true); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); ui.localizeUI(); },
    toggleAds: () => { document.getElementById('modal-ads').style.display = 'flex'; game.togglePause(true); ui.updateHeader(); ui.localizeUI(); },
    toggleHelp: () => { document.getElementById('modal-help').style.display = 'flex'; ui.switchHelpTab('tab-basic'); game.togglePause(true); ui.localizeUI(); },
    switchHelpTab: (tabId) => { 
        document.querySelectorAll('.help-section').forEach(el => el.classList.remove('active')); 
        document.getElementById(tabId).classList.add('active'); 
        
        const tabBtnMap = { 'tab-basic': 'ht-btn-basic', 'tab-how': 'ht-btn-how', 'tab-staff': 'ht-btn-staff', 'tab-biz': 'ht-btn-biz' };
        document.querySelectorAll('.help-tab').forEach(b => b.classList.remove('active'));
        document.getElementById(tabBtnMap[tabId]).classList.add('active');
    },
    
    toggleMode: () => { 
        const c = document.getElementById('game-container'); 
        if (G.mode === 'pc') { c.classList.remove('pc-mode'); G.mode = 'mobile'; } 
        else { c.classList.add('pc-mode'); G.mode = 'pc'; } 
        ui.updateModeBtn();
    },
    updateModeBtn: () => {
        const btn = document.getElementById('btn-mode-toggle');
        btn.innerText = (G.mode === 'pc') ? L[G.language].mode_pc : L[G.language].mode_mobile;
    },
    closeModal: (id) => { document.getElementById(id).style.display = 'none'; game.togglePause(false); }
};

if (window.innerWidth > 768) { document.getElementById('game-container').classList.add('pc-mode'); G.mode = 'pc'; }
game.showHome();
</script>
</body>
</html>
