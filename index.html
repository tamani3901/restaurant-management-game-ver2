<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="google-site-verification" content="8o8DGhxsn_70QtPiKPjHgnpjYrCLIzxJJaIbV80KA_w" />
<title>é£²é£Ÿåº—çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ v1.22</title>
<style>
    :root {
        --bg-color: #2c3e50;
        --panel-color: #34495e;
        --text-color: #ecf0f1;
        --accent-color: #e74c3c;
        --success-color: #2ecc71;
        --warning-color: #f1c40f;
        --info-color: #3498db;
    }
    * { box-sizing: border-box; }
    body { 
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; 
        background: var(--bg-color); 
        color: var(--text-color); 
        margin: 0; padding: 0; 
        overflow: hidden; height: 100dvh;
    }
    button { 
        cursor: pointer; padding: 8px 10px; border: none; border-radius: 4px; 
        background: var(--accent-color); color: white; font-weight: bold; margin: 2px; 
        font-size: 0.85rem; touch-action: manipulation; white-space: nowrap;
    }
    button:hover { opacity: 0.9; }
    button:disabled { background: #7f8c8d; cursor: not-allowed; opacity: 0.6; }
    input, select { padding: 8px; border-radius: 4px; border: none; margin: 4px; color:#333; font-size: 0.9rem; }

    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    #game-container { width: 100%; height: 100%; display: flex; flex-direction: column; background: var(--bg-color); }
    #game-container.pc-mode { max-width: 1024px; margin: 0 auto; border-left: 2px solid #7f8c8d; border-right: 2px solid #7f8c8d; }

    .screen { display: none; flex: 1; flex-direction: column; padding: 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 40px; }
    .screen.active { display: flex; }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    #ui-header { background: #1a252f; padding: 5px; font-size: 0.8rem; flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; }
    .header-row { display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; }
    #info-bar { text-align: center; font-weight: bold; flex-grow: 1; }

    /* ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ */
    .speed-btn { padding: 4px 8px; font-size: 0.75rem; background: #7f8c8d; margin: 0; border-radius: 0; }
    .speed-btn:first-child { border-radius: 4px 0 0 4px; }
    .speed-btn:last-child { border-radius: 0 4px 4px 0; }
    .speed-btn.active { background: var(--success-color); }

    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    #main-area { 
        flex: 1; position: relative; background: #ecf0f1; color: #333; 
        padding: 10px; overflow-y: auto; 
        display: flex; flex-direction: column; gap: 10px;
    }
    #game-container.pc-mode #main-area { flex-direction: row; }
    
    /* å®¢å¸­ã‚¨ãƒªã‚¢ */
    #seats-section { flex: 2; overflow-y: auto; }
    #seats-container { display: grid; gap: 5px; grid-template-columns: repeat(auto-fit, minmax(65px, 1fr)); padding-bottom: 20px; }
    .seat { background: #bdc3c7; border-radius: 6px; text-align: center; position: relative; height: 80px; border: 2px solid #7f8c8d; }
    .seat.occupied { background: #f39c12; border-color: #d35400; }
    .seat-status { font-size: 9px; position: absolute; bottom: 2px; left: 0; width: 100%; background:rgba(255,255,255,0.8); font-weight: bold; line-height: 1.1; }

    /* å¾“æ¥­å“¡ãƒ‘ãƒãƒ« */
    #staff-section { 
        flex: 1; background: #34495e; color: white; border-radius: 5px; padding: 5px; 
        overflow-y: auto; min-height: 150px;
    }
    #staff-section h3 { margin: 5px 0; font-size: 1rem; text-align: center; border-bottom: 1px solid #7f8c8d; }
    .staff-card { 
        background: rgba(0,0,0,0.3); margin-bottom: 4px; padding: 5px; border-radius: 3px; font-size: 0.85rem; 
        display: flex; justify-content: space-between; align-items: center;
    }
    .staff-card.busy { border-left: 4px solid var(--accent-color); }
    .staff-card.free { border-left: 4px solid var(--success-color); }
    .staff-status-text { font-size: 0.75rem; font-weight: bold; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 10px; }
    .modal-content { background: var(--panel-color); padding: 15px; border-radius: 8px; width: 100%; max-width: 650px; color: white; text-align: center; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; }
    
    /* å‰²ã‚Šå½“ã¦UI */
    .assign-row { display: flex; flex-direction:column; background: rgba(255,255,255,0.1); padding: 5px; margin: 4px 0; border-radius: 4px; text-align: left;}
    .assign-name { font-weight: bold; margin-bottom: 3px; font-size: 0.9rem; }
    .assign-selects { display: flex; gap: 2px; overflow-x: auto; }
    .assign-select { padding: 2px; font-size: 0.75rem; width: 80px; }

    /* ã‚°ãƒ©ãƒ•ãªã© */
    #stats-canvas { background: #fff; width: 100%; height: 250px; margin-bottom: 10px; border-radius: 4px; flex-shrink: 0;}
    
    .help-tabs { display: flex; border-bottom: 2px solid #7f8c8d; margin-bottom: 10px; flex-shrink: 0; overflow-x: auto;}
    .help-tab { flex: 1; padding: 10px 5px; font-size: 0.85rem; cursor: pointer; background: #2c3e50; border: 1px solid #7f8c8d; border-bottom: none; color: #95a5a6; white-space: nowrap; }
    .help-tab.active { background: var(--panel-color); color: #fff; font-weight: bold; border-top: 3px solid var(--warning-color); }
    .help-section { display: none; text-align: left; overflow-y: auto; padding: 5px; flex: 1; }
    .help-section.active { display: block; }
    .help-section h4 { border-bottom: 1px solid #fff; padding-bottom: 3px; margin-top: 15px; font-size: 0.95rem; color: var(--warning-color); }
    
    table.help-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 0.8rem; color: #ecf0f1; }
    table.help-table th, table.help-table td { border: 1px solid #7f8c8d; padding: 4px; text-align: left; }
    table.help-table th { background: #2980b9; }

    .home-btn-group { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 30px; }
    .home-btn-group button { width: 80%; max-width: 280px; padding: 12px; font-size: 1rem; }
    .tab-group { display: flex; gap: 5px; margin-bottom: 10px; justify-content: center; }
    .tab-btn { background: #7f8c8d; flex: 1; font-size: 0.8rem; }
    .tab-btn.active { background: var(--info-color); }

    #ticker { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); color: #0f0; padding: 4px; white-space: nowrap; overflow: hidden; font-family: 'Courier New', monospace; z-index: 900; height: 25px; line-height: 25px; font-size: 0.85rem; }
</style>
</head>
<body>

<div id="game-container">
    <div id="ticker">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•: æº–å‚™å®Œäº†...</div>

    <div id="screen-home" class="screen active">
        <h1 style="text-align: center; color: var(--warning-color); margin-top: 30px;">ğŸ” Kitchen Tycoon ğŸ</h1>
        <p style="text-align:center; font-size:0.8rem; color:#bdc3c7;">v1.22 Guide & Salary Update</p>
        <div class="home-btn-group">
            <button onclick="game.showSetup()">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</button>
            <input type="file" id="save-file-input" style="display:none" onchange="game.loadGameData(this)">
            <button onclick="document.getElementById('save-file-input').click()">ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿èª­è¾¼</button>
            <button onclick="ui.toggleHelp()" style="background:var(--info-color);">èª¬æ˜æ›¸ (éŠã³æ–¹ãƒ»è£ä»•æ§˜)</button>
            <a href="https://tamani3901.github.io/ti-tobann/" target="_blank" style="width:100%; text-align:center;">
                <button style="background:#8e44ad; width:80%;">ãƒãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸</button>
            </a>
        </div>
    </div>

    <div id="screen-setup" class="screen">
        <h2 style="text-align:center;">æ–°è¦åº—èˆ—ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>
        <div style="margin-bottom:10px;">
            <label>åº—ã®ç¨®é¡:</label>
            <select id="setup-type" onchange="setup.updateMenuOptions()" style="width:100%;">
                <option value="fastfood">ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</option>
                <option value="restaurant">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</option>
            </select>
        </div>
        <div style="margin-bottom:10px;">
            <label>å ´æ‰€:</label>
            <select id="setup-location" onchange="setup.updateSizeOptions()" style="width:100%;">
                <option value="big_city">å¤§éƒ½å¸‚ (MAX 10å¸­)</option>
                <option value="city">éƒ½å¸‚éƒ¨ (MAX 8å¸­)</option>
                <option value="mid_city">ä¸­éƒ½å¸‚ (MAX 6å¸­)</option>
                <option value="small_city">å°éƒ½å¸‚ (MAX 4å¸­)</option>
            </select>
        </div>
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label>åˆæœŸå¸­æ•°:</label>
                <select id="setup-seats" style="width:100%;"></select>
            </div>
            <div style="flex:1;">
                <label>é›£æ˜“åº¦:</label>
                <select id="setup-difficulty" style="width:100%;">
                    <option value="hard">é›£ã—ã„</option>
                    <option value="normal" selected>æ™®é€š</option>
                    <option value="easy">ç°¡å˜</option>
                </select>
            </div>
        </div>
        <label style="margin-top:15px; display:block;">åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ (5ã¤é¸æŠ):</label>
        <div id="setup-menu-list" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;"></div>
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="game.startGame()" style="width:100%; padding:12px; font-size:1.1rem;">é–‹åº—ã™ã‚‹</button>
            <button onclick="game.showHome()" style="background:#7f8c8d; width:100%; margin-top:10px;">æˆ»ã‚‹</button>
        </div>
    </div>

    <div id="screen-game" class="screen" style="padding:0; overflow:hidden;">
        <div id="ui-header">
            <div class="header-row">
                <div style="display:flex; flex-wrap:wrap; gap:2px; flex:1;">
                    <button onclick="ui.toggleMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
                    <button onclick="ui.toggleEmployees()" style="background:#8e44ad;">å¾“æ¥­å“¡</button>
                    <button onclick="ui.toggleSettings()">è¨­å®š</button>
                    <button onclick="stats.show()">çµ±è¨ˆ</button>
                    <button onclick="ui.toggleHelp()" style="background:var(--info-color);">èª¬æ˜</button>
                </div>
                <button id="btn-audio-toggle" onclick="bgm.toggle()" style="font-size:0.8rem; background:#34495e; color:white; min-width:30px;">â™ª</button>
                <button id="btn-mode-toggle" onclick="ui.toggleMode()" style="font-size:0.7rem; background:#95a5a6; margin-left:5px; min-width:80px;">ğŸ“± ã‚¹ãƒãƒ›</button>
            </div>
            
            <div class="header-row" style="background:#2c3e50; padding:3px; border-radius:4px; margin-top:3px;">
                <div style="flex:1; text-align:center; font-size:0.85rem;">
                    <span id="display-time">Day 1 9:00</span>
                </div>
                <div style="flex:1; text-align:center; font-weight:bold; color:var(--warning-color); font-size:0.9rem;">
                    è³‡ç”£: <span id="display-money">Â¥15,000,000</span>
                </div>
            </div>

            <div class="header-row" style="font-size:0.75rem; margin-top:2px;">
                 <div style="flex:1;">
                     <span id="display-stars">â˜…â˜…â˜…â˜…â˜…</span>
                     <span style="margin-left:5px;">ç´¯è¨ˆ: <span id="display-earnings">Â¥0</span></span>
                 </div>
                 <div style="display:flex; align-items:center; gap:5px;">
                    <span id="ad-buff-display" style="color:var(--success-color);">å®£ä¼:+0%</span>
                    <button onclick="ui.toggleAds()" style="padding:2px 6px; font-size:0.75rem;">å®£ä¼</button>
                    <div style="display:flex; gap:0;">
                        <button class="speed-btn active" id="btn-spd-1" onclick="game.setSpeed(1)">x1</button>
                        <button class="speed-btn" id="btn-spd-2" onclick="game.setSpeed(2)">x2</button>
                        <button class="speed-btn" id="btn-spd-3" onclick="game.setSpeed(3)">x3</button>
                    </div>
                 </div>
            </div>
        </div>

        <div id="main-area">
            <div id="seats-section">
                <div id="seats-container"></div>
            </div>
            <div id="staff-section">
                <h3>ã‚¹ã‚¿ãƒƒãƒ•ãƒ«ãƒ¼ãƒ  (4å“åŒæ™‚)</h3>
                <div id="staff-container">
                    </div>
            </div>
        </div>
    </div>

</div>

<div id="modal-employees" class="modal-overlay">
    <div class="modal-content" style="height:85vh; display:flex; flex-direction:column;">
        <h3>ğŸ‘©â€ğŸ³ å¾“æ¥­å“¡ & ã‚­ãƒƒãƒãƒ³æ‹…å½“</h3>
        
        <div style="margin-bottom:10px;">
            <h4>é›‡ç”¨ã‚»ãƒ³ã‚¿ãƒ¼</h4>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                <button onclick="settings.hire('master')" style="font-size:0.8rem;">ãƒã‚¹ã‚¿ãƒ¼(20ä¸‡)</button>
                <button onclick="settings.hire('veteran')" style="font-size:0.8rem;">ãƒ™ãƒ†ãƒ©ãƒ³(12ä¸‡)</button>
                <button onclick="settings.hire('standard')" style="font-size:0.8rem;">æ¨™æº–(8ä¸‡)</button>
                <button onclick="settings.hire('ponkotsu')" style="font-size:0.8rem;">ãƒãƒ³ã‚³ãƒ„(4ä¸‡)</button>
            </div>
            <div id="current-employees-list" style="max-height: 60px; overflow-y: auto; border:1px solid #7f8c8d; padding:5px; margin-top:5px;"></div>
        </div>

        <hr>
        <h4>ğŸ½ï¸ æ‹…å½“å‰²ã‚Šå½“ã¦ (1å“ã«ã¤ã4äººã¾ã§)</h4>
        <div class="help-tabs">
            <div class="help-tab active" onclick="settings.switchAssignTab('assign-main')">ãƒ¡ã‚¤ãƒ³</div>
            <div class="help-tab" onclick="settings.switchAssignTab('assign-side')">ã‚µã‚¤ãƒ‰</div>
            <div class="help-tab" onclick="settings.switchAssignTab('assign-drink')">ãƒ‰ãƒªãƒ³ã‚¯</div>
        </div>
        
        <div id="assignment-container" style="flex:1; overflow-y:auto;">
            </div>

        <button onclick="ui.closeModal('modal-employees')" style="width:100%; margin-top:10px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-stats" class="modal-overlay">
    <div class="modal-content">
        <h3>ğŸ“Š çµŒå–¶çµ±è¨ˆ</h3>
        <div class="tab-group">
            <button class="tab-btn" onclick="stats.setRange(1)">1æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(5)">5æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(10)">10æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(20)">20æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(100)">100æ—¥</button>
            <button class="tab-btn" onclick="stats.setRange(0)">å…¨æœŸé–“</button>
        </div>
        <div class="tab-group">
            <button id="btn-graph-rev" class="tab-btn active" onclick="stats.setType('revenue')">å£²ä¸Š</button>
            <button id="btn-graph-asset" class="tab-btn" onclick="stats.setType('assets')">ç·è³‡ç”£</button>
        </div>
        <canvas id="stats-canvas"></canvas>
        <div style="text-align:left; font-size:0.85rem; background:rgba(0,0,0,0.2); padding:5px;">
            <p>æœ¬æ—¥ã®å£²ä¸Š: <span id="stat-today-rev">Â¥0</span></p>
            <p>æœ¬æ—¥ã®å‡ºè²»: <span id="stat-today-exp" style="color:#e74c3c;">Â¥0</span></p>
        </div>
        <button onclick="ui.closeModal('modal-stats')" style="width:100%; margin-top:10px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-order" class="modal-overlay">
    <div class="modal-content" id="order-modal-content">
        <img id="order-customer-img" src="" alt="Customer" style="width:80px;height:80px;border-radius:50%;">
        <div class="speech-bubble" id="order-text" style="background:white;color:black;padding:10px;margin:10px auto;border-radius:10px;">æ³¨æ–‡å†…å®¹...</div>
        <button onclick="game.confirmOrder()" style="width:80%; padding:10px; margin-top:10px;">äº†è§£</button>
    </div>
</div>

<div id="modal-menu" class="modal-overlay">
    <div class="modal-content">
        <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
        <button onclick="ui.closeModal('modal-menu')" style="width:100%;">æˆ»ã‚‹</button>
        <button onclick="game.togglePause()" style="width:100%;">ä¸€æ™‚åœæ­¢/å†é–‹</button>
        <button onclick="game.saveGame()" style="width:100%;">ã‚»ãƒ¼ãƒ–</button>
        <button onclick="game.quitGame()" style="background:#c0392b; width:100%;">ã‚„ã‚ã‚‹</button>
    </div>
</div>

<div id="modal-help" class="modal-overlay">
    <div class="modal-content" style="height:85vh; display:flex; flex-direction:column;">
        <h2 style="text-align:center; margin-top:0;">ğŸ“– ã‚²ãƒ¼ãƒ èª¬æ˜æ›¸</h2>
        
        <div class="help-tabs">
            <div class="help-tab active" onclick="ui.switchHelpTab('tab-basic')">åŸºæœ¬</div>
            <div class="help-tab" onclick="ui.switchHelpTab('tab-how')">æ“ä½œæ–¹æ³•</div>
            <div class="help-tab" onclick="ui.switchHelpTab('tab-staff')">å¾“æ¥­å“¡</div>
            <div class="help-tab" onclick="ui.switchHelpTab('tab-biz')">çµŒå–¶</div>
        </div>

        <div id="tab-basic" class="help-section active">
            <h4>ğŸ† å‹åˆ©æ¡ä»¶ã¨é›£æ˜“åº¦</h4>
            <ul>
                <li><strong>æ™®é€š:</strong> åˆ©ç›Š 500ä¸‡å††ã§ã‚¯ãƒªã‚¢</li>
                <li><strong>é›£ã—ã„:</strong> åˆ©ç›Š 1500ä¸‡å†† (è©•ä¾¡â˜…3.5ä»¥ä¸‹å³æ­»)</li>
                <li><strong>ç°¡å˜:</strong> æ¡ä»¶ãªã— (è©•ä¾¡2.5ä»¥ä¸‹ã«ãªã‚‰ãªã„)</li>
            </ul>
            <p>â€»ã‚¯ãƒªã‚¢å¾Œã¯<strong>ãƒœãƒ¼ãƒŠã‚¹200ä¸‡å††</strong>ã‚’ç²å¾—ã—ã€<strong>æœ€å¤§40å¸­</strong>ã¾ã§æ‹¡å¼µå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
            <p style="color:#e74c3c;">â€»è³‡ç”£ãŒãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã¨ç ´ç”£ï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼‰ã§ã™ã€‚</p>
        </div>

        <div id="tab-how" class="help-section">
            <h4>ğŸ® éŠã³æ–¹ã®æµã‚Œ</h4>
            <ol>
                <li><strong>é–‹åº—æº–å‚™:</strong> ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨å ´æ‰€ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆã€‚</li>
                <li><strong>æ‹…å½“å‰²ã‚Šå½“ã¦:</strong> ãƒ˜ãƒƒãƒ€ãƒ¼ã®<span style="background:#8e44ad;padding:2px;border-radius:3px;">å¾“æ¥­å“¡</span>ãƒœã‚¿ãƒ³ã‹ã‚‰ã€èª°ãŒã©ã®æ–™ç†ã‚’ä½œã‚‹ã‹æ±ºã‚ã¾ã™ï¼ˆé‡è¦ï¼ï¼‰ã€‚</li>
                <li><strong>å–¶æ¥­é–‹å§‹:</strong> å®¢ãŒæ¥åº—ã—æ³¨æ–‡ã—ã¾ã™ã€‚å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå¾“æ¥­å“¡ãŒè‡ªå‹•ã§èª¿ç†ã—ã¾ã™ã€‚</li>
                <li><strong>ä¼šè¨ˆ:</strong> é£Ÿã¹çµ‚ã‚ã‚‹ã¨è‡ªå‹•ã§å£²ä¸ŠãŒå…¥ã‚Šã¾ã™ã€‚</li>
                <li><strong>22:00 é–‰åº—:</strong> æ–°è¦æ¥åº—ã‚¹ãƒˆãƒƒãƒ—ã€‚åº—å†…ã®å®¢ãŒå…¨å“¡å¸°ã‚‹ã¾ã§å–¶æ¥­ã¯ç¶šãã¾ã™ã€‚</li>
            </ol>
            <p>â€»èª¿ç†ãŒå§‹ã¾ã‚‰ãªã„æ™‚ã¯ã€æ‹…å½“å‰²ã‚Šå½“ã¦ã‚’ç¢ºèªã™ã‚‹ã‹ã€å¾“æ¥­å“¡ã®æ‰‹ãŒç©ºãã®ã‚’å¾…ã£ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div id="tab-staff" class="help-section">
            <h4>ğŸ§‘â€ğŸ³ å¾“æ¥­å“¡ã®ã‚³ã‚¹ãƒˆ</h4>
            <p>é›‡ã†æ™‚ã®ã€Œå¥‘ç´„é‡‘ã€ã«åŠ ãˆã€<strong>10æ—¥ã”ã¨ã«ã€Œç¶­æŒè²»ï¼ˆçµ¦æ–™ï¼‰ã€</strong>ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>
            <table class="help-table">
                <tr><th>ãƒ©ãƒ³ã‚¯</th><th>å¥‘ç´„é‡‘</th><th>ç¶­æŒè²»(10æ—¥æ¯)</th><th>é€Ÿåº¦</th></tr>
                <tr><td>ãƒã‚¹ã‚¿ãƒ¼</td><td>20ä¸‡</td><td>25ä¸‡</td><td>2.5å€</td></tr>
                <tr><td>ãƒ™ãƒ†ãƒ©ãƒ³</td><td>12ä¸‡</td><td>20ä¸‡</td><td>1.6å€</td></tr>
                <tr><td>æ¨™æº–</td><td>8ä¸‡</td><td>15ä¸‡</td><td>1.0å€</td></tr>
                <tr><td>ãƒãƒ³ã‚³ãƒ„</td><td>4ä¸‡</td><td>10ä¸‡</td><td>0.5å€</td></tr>
            </table>
            <p>å¾“æ¥­å“¡ã¯1äººã«ã¤ã<strong>åŒæ™‚ã«4å“</strong>ã¾ã§èª¿ç†å¯èƒ½ã§ã™ã€‚</p>
        </div>

        <div id="tab-biz" class="help-section">
            <h4>ğŸ“¢ å®£ä¼åŠ¹æœ (é‡ã­ãŒã‘OK)</h4>
            <table class="help-table">
                <tr><th>ç¨®é¡</th><th>è²»ç”¨</th><th>æœŸé–“</th><th>æ®‹å­˜</th></tr>
                <tr><td>ãƒã‚¹ã‚¿ãƒ¼</td><td>2ä¸‡</td><td>+15%</td><td>+5% (2æ—¥)</td></tr>
                <tr><td>ãƒãƒ©ã‚·</td><td>5ä¸‡</td><td>+20%</td><td>+5% (1æ—¥)</td></tr>
                <tr><td>CM</td><td>20ä¸‡</td><td>+25%</td><td>+20% (3æ—¥)</td></tr>
                <tr><td>TV</td><td>50ä¸‡</td><td>+25%</td><td>+40% (5æ—¥)</td></tr>
            </table>

            <h4>âš ï¸ è£ä»•æ§˜ãƒ»å›ºå®šè²»</h4>
            <ul style="font-size:0.85rem;">
                <li><strong>å¹³æ—¥ãƒ©ãƒ³ãƒ (11-13æ™‚):</strong> å®¢+10%</li>
                <li><strong>åœŸæ—¥ç¥ (çµ‚æ—¥):</strong> å®¢+20%</li>
                <li><strong>åœŸæ—¥ãƒ©ãƒ³ãƒ:</strong> å®¢+30%</li>
                <li><strong>ã‚´ãƒŸç®±è¨­ç½®:</strong> æº€è¶³åº¦+5 (å›ºå®š)</li>
                <li><strong>å®¶è³ƒ:</strong> 10æ—¥ã”ã¨ã«100ä¸‡å††</li>
            </ul>
        </div>

        <div style="text-align:center; margin-top:auto; padding-top:10px;">
            <button onclick="ui.closeModal('modal-help')" style="width:100%;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<div id="modal-settings" class="modal-overlay">
    <div class="modal-content">
        <h3>åº—èˆ—è¨­å®š</h3>
        
        <h4>ğŸ“¢ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®š</h4>
        <button id="btn-toggle-popup" onclick="settings.togglePopup()" style="width:100%;">1æ—¥çµ‚äº†æ™‚ã®çµæœè¡¨ç¤º: ON</button>
        <hr>

        <h4>ğŸ—ï¸ åº—èˆ—æ‹¡å¼µ</h4>
        <div id="expansion-normal" style="display:flex; justify-content:center; gap:5px; margin-bottom:10px;">
            <button id="btn-expand-15" onclick="settings.expandSeats(15)" disabled style="font-size:0.8rem;">15å¸­ã¸ (ç´¯è¨ˆ10ä¸‡)</button>
            <button id="btn-expand-20" onclick="settings.expandSeats(20)" disabled style="font-size:0.8rem;">20å¸­ã¸ (ç´¯è¨ˆ20ä¸‡)</button>
        </div>
        <div id="expansion-cleared" style="display:none; background:#2c3e50; padding:10px; border-radius:5px; margin-bottom:10px;">
            <p style="margin:0 0 5px 0; font-size:0.9rem; color:var(--success-color);">ğŸ‰ è‡ªç”±æ‹¡å¼µ (Max 40)</p>
            <div style="display:flex; justify-content:center; align-items:center; gap:10px;">
                <button onclick="settings.changeSeats(-5)" style="background:#c0392b;">ï¼5å¸­</button>
                <span id="current-seats-display" style="font-weight:bold; font-size:1.2rem;">20å¸­</span>
                <button onclick="settings.changeSeats(5)" style="background:#2ecc71;">ï¼‹5å¸­</button>
            </div>
        </div>
        
        <hr>
        <button onclick="settings.toggleMenuEdit()" style="background:#2980b9; width:100%;">ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¾¡æ ¼ç®¡ç†</button>
        <div id="menu-edit-area" style="display:none; margin-top:10px; background:#2c3e50; padding:10px;">
            <div id="menu-edit-list" style="max-height:150px; overflow-y:auto;"></div>
            <button onclick="settings.saveMenuChanges()" style="background:#2ecc71; width:100%; margin-top:5px;">é©ç”¨</button>
        </div>

        <div style="margin-top:10px;">
            <button id="btn-order-mode" onclick="settings.toggleOrderMode()" style="width:100%;">æ‰‹å‹•æ³¨æ–‡: OFF</button>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <button onclick="settings.buyItem('trash')" style="flex:1;">ã‚´ãƒŸç®±(1ä¸‡)</button>
                <button onclick="settings.buyItem('clean')" style="flex:1;">æ¸…æƒ(5ä¸‡)</button>
            </div>
        </div>
        <button onclick="ui.closeModal('modal-settings')" style="width:100%; margin-top:10px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="modal-ads" class="modal-overlay">
    <div class="modal-content">
        <h3>å®£ä¼æ´»å‹•</h3>
        <p>ç¾åœ¨åŠ¹æœ: <span id="ad-status-detail" style="color:#2ecc71; font-weight:bold;">0%</span></p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="ads.start('poster')">ãƒã‚¹ã‚¿ãƒ¼<br>(2ä¸‡)</button>
            <button onclick="ads.start('flyer')">ãƒãƒ©ã‚·<br>(5ä¸‡)</button>
            <button onclick="ads.start('cm')">CM<br>(20ä¸‡)</button>
            <button onclick="ads.start('tv')">TVç•ªçµ„<br>(50ä¸‡)</button>
        </div>
        <button onclick="ui.closeModal('modal-ads')" style="width:100%; margin-top:15px;">é–‰ã˜ã‚‹</button>
    </div>
</div>


<script>
/* ãƒ‡ãƒ¼ã‚¿å®šç¾© */
const IMAGES = ["https://i.ibb.co/2YPFhJ1D/IMG-2529.jpg","https://i.ibb.co/p6DSzpHQ/IMG-2529.jpg","https://i.ibb.co/BHW5cMvS/IMG-2529.jpg","https://i.ibb.co/7tjqbkkX/IMG-2529.jpg","https://i.ibb.co/Xkkr114y/IMG-2529.jpg"];

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ (ã‚«ãƒ†ã‚´ãƒªä»˜ä¸)
const MENUS = {
    fastfood: [
        {id:'b_cheese',name:'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼',price:500,cat:'main'}, {id:'b_teri',name:'ãƒ†ãƒªãƒ¤ã‚­',price:500,cat:'main'}, {id:'b_plain',name:'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼',price:500,cat:'main'}, {id:'b_rice',name:'ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚¬ãƒ¼',price:500,cat:'main'},
        {id:'set_burger',name:'ãƒãƒ¼ã‚¬ãƒ¼ã‚»ãƒƒãƒˆ',price:700,cat:'main'}, {id:'set_potato',name:'ãƒãƒ†ãƒˆã‚»ãƒƒãƒˆ',price:600,cat:'side'},
        {id:'pot_s',name:'ãƒãƒ†ãƒˆS',price:200,cat:'side'}, {id:'pot_m',name:'ãƒãƒ†ãƒˆM',price:300,cat:'side'}, {id:'pot_l',name:'ãƒãƒ†ãƒˆL',price:450,cat:'side'}, {id:'nugget',name:'ãƒŠã‚²ãƒƒãƒˆ',price:300,cat:'side'},
        {id:'shake_v',name:'ãƒãƒ‹ãƒ©ã‚·ã‚§ã‚¤ã‚¯',price:300,cat:'drink'}, {id:'shake_s',name:'ã„ã¡ã”ã‚·ã‚§ã‚¤ã‚¯',price:300,cat:'drink'},
        {id:'j_org',name:'ã‚ªãƒ¬ãƒ³ã‚¸',price:300,cat:'drink'}, {id:'j_apl',name:'ãƒªãƒ³ã‚´',price:300,cat:'drink'}, {id:'j_col',name:'ã‚³ãƒ¼ãƒ©',price:300,cat:'drink'}, {id:'j_mel',name:'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€',price:300,cat:'drink'}
    ],
    restaurant: [
        {id:'p_mar',name:'ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿',price:1200,cat:'main'}, {id:'p_chs',name:'ãƒãƒ¼ã‚ºãƒ”ã‚¶',price:1200,cat:'main'},
        {id:'spa_nap',name:'ãƒŠãƒãƒªã‚¿ãƒ³',price:1000,cat:'main'}, {id:'spa_tom',name:'ãƒˆãƒãƒˆãƒ‘ã‚¹ã‚¿',price:1000,cat:'main'}, {id:'spa_car',name:'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©',price:1000,cat:'main'},
        {id:'pancake',name:'ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­',price:900,cat:'main'}, {id:'hamburg',name:'ãƒãƒ³ãƒãƒ¼ã‚°',price:1300,cat:'main'}, {id:'steak',name:'ã‚¹ãƒ†ãƒ¼ã‚­',price:1400,cat:'main'},
        {id:'salad',name:'ã‚µãƒ©ãƒ€',price:500,cat:'side'}, {id:'potato',name:'ãƒãƒ†ãƒˆ',price:400,cat:'side'}, {id:'parfait',name:'ãƒ‘ãƒ•ã‚§',price:700,cat:'side'}, {id:'pudding',name:'ãƒ—ãƒªãƒ³',price:400,cat:'side'},
        {id:'rice',name:'ã”é£¯',price:350,cat:'side'}, {id:'j_org',name:'ã‚ªãƒ¬ãƒ³ã‚¸',price:300,cat:'drink'}, {id:'j_apl',name:'ãƒªãƒ³ã‚´',price:300,cat:'drink'}, {id:'j_cal',name:'ã‚«ãƒ«ãƒ”ã‚¹',price:300,cat:'drink'}, {id:'j_col',name:'ã‚³ãƒ¼ãƒ©',price:300,cat:'drink'}, {id:'j_mel',name:'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€',price:300,cat:'drink'}
    ]
};

const EMPLOYEES = {
    master: { name: 'ãƒã‚¹ã‚¿ãƒ¼', speed: 2.5, cost: 200000, maintain: 250000, wait: 4, power: 4 }, 
    veteran: { name: 'ãƒ™ãƒ†ãƒ©ãƒ³', speed: 1.6, cost: 120000, maintain: 200000, wait: 6.25, power: 3 },
    standard: { name: 'æ¨™æº–', speed: 1.0, cost: 80000, maintain: 150000, wait: 10, power: 2 },
    ponkotsu: { name: 'ãƒãƒ³ã‚³ãƒ„', speed: 0.5, cost: 40000, maintain: 100000, wait: 20, power: 1 }
};

const LOCATIONS = {
    big_city: { max: 10 }, city: { max: 8 }, mid_city: { max: 6 }, small_city: { max: 4 }
};

/* BGMè¨­å®š */
const bgm = {
    obj: null,
    base: "https://raw.githubusercontent.com/tamani3901/restaurant-management-game-ver2/main/",
    tracks: { weekday: "å¤•é£Ÿå¾Œã®ã¾ã£ãŸã‚Šã‚¿ã‚¤ãƒ .mp3", weekend: "ã¾ã‚“ã·ãé£Ÿå ‚.mp3" },
    currentType: null,
    muted: false,
    play: () => {
        if(bgm.muted) return;
        const isWeekend = (G.weekDay >= 5);
        const type = isWeekend ? 'weekend' : 'weekday';
        if (!bgm.obj) {
            bgm.obj = new Audio();
            bgm.obj.loop = true;
            bgm.obj.volume = 0.1; 
        }
        if (bgm.currentType !== type) {
            bgm.currentType = type;
            bgm.obj.src = bgm.base + bgm.tracks[type];
            bgm.obj.play().catch(e => console.log("Audio Error:", e));
        } else if (bgm.obj.paused) {
            bgm.obj.play().catch(e => console.log("Audio Error:", e));
        }
    },
    stop: () => {
        if (bgm.obj) {
            bgm.obj.pause();
            bgm.obj.currentTime = 0;
        }
    },
    toggle: () => {
        bgm.muted = !bgm.muted;
        const btn = document.getElementById('btn-audio-toggle');
        if(bgm.muted) {
            if(bgm.obj) bgm.obj.pause();
            btn.style.opacity = "0.5";
            btn.innerText = "ğŸ”‡";
        } else {
            btn.style.opacity = "1";
            btn.innerText = "â™ª";
            bgm.play();
        }
    }
};

/* ã‚²ãƒ¼ãƒ çŠ¶æ…‹ */
let G = {
    mode: 'mobile', state: 'home', type: null, location: null, maxSeats: 0,
    money: 15000000, totalEarnings: 0, reputation: 5.0, day: 1, time: 540, weekDay: 0,
    seats: [], menu: [], 
    employees: ['master'], 
    kitchenMap: {}, // menuId -> [empIdx, empIdx, ...] (Array)
    manualOrder: false, difficulty: 'normal', activeAds: [], bailoutUsed: false, trashBin: false,
    timerId: null, activeOrder: null,
    statsHistory: [], dailyRevenue: 0, dailyExpense: 0,
    speed: 1, isCleared: false, showResultPopup: true
};

const DAYS = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];

/* ãƒ­ã‚¸ãƒƒã‚¯ */
const game = {
    showHome: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-home').classList.add('active');
        bgm.stop(); // ãƒ›ãƒ¼ãƒ ã«æˆ»ã£ãŸã‚‰BGMåœæ­¢
        G.state = 'home';
    },
    showSetup: () => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-setup').classList.add('active');
        setup.updateMenuOptions();
        setup.updateSizeOptions();
        G.state = 'setup';
    },
    startGame: () => {
        const selectedMenu = Array.from(document.querySelectorAll('.item-select.selected')).map(e => e.dataset.id);
        if (selectedMenu.length < 1) { alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã‚“ã§ãã ã•ã„'); return; } 
        
        G.type = document.getElementById('setup-type').value;
        const locKey = document.getElementById('setup-location').value;
        G.location = locKey;
        G.maxSeats = parseInt(document.getElementById('setup-seats').value);
        G.difficulty = document.getElementById('setup-difficulty').value;
        G.menu = selectedMenu;
        G.money = (G.difficulty === 'hard') ? 12000000 : 12000000; 
        
        if (G.maxSeats > 8) G.money -= 3000000;
        else if (G.maxSeats > 4) G.money -= 2000000;

        G.employees = ['master']; 
        G.reputation = 5.0;
        G.day = 1; G.time = 540; G.weekDay = 0;
        G.seats = Array(G.maxSeats).fill(null).map(() => ({ occupied: false, customer: null, status: 'empty', waitTime: 0 }));
        G.totalEarnings = 0;
        G.activeAds = [];
        G.statsHistory = [];
        G.dailyRevenue = 0; G.dailyExpense = 0;
        G.speed = 1;
        G.isCleared = false;
        G.showResultPopup = true;
        
        settings.resetAssignments();

        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.getElementById('screen-game').classList.add('active');
        G.state = 'playing';
        
        game.setSpeed(1);
        ui.updateModeBtn();
        bgm.play(); // BGMé–‹å§‹

        ui.renderSeats();
        ui.updateStaffPanel();
        ui.updateHeader();
        ui.ticker("æœ¬æ—¥ã‚‚é–‹åº—ã§ã™ï¼");
    },

    setSpeed: (spd) => {
        G.speed = spd;
        if (G.timerId) clearInterval(G.timerId);
        if (G.state === 'playing') {
            G.timerId = setInterval(game.loop, 1000 / G.speed);
        }
        document.querySelectorAll('.speed-btn').forEach((btn, idx) => {
            if (idx + 1 === spd) btn.classList.add('active');
            else btn.classList.remove('active');
        });
    },

    loop: () => {
        if (G.state !== 'playing') return;

        G.time += 5;
        
        if (G.time === 1320) { 
            let kicked = 0;
            G.seats.forEach((s, i) => {
                if (s.occupied && s.status !== 'eating') {
                    s.occupied = false; s.customer = null; s.status = 'empty';
                    kicked++;
                }
            });
            if(kicked > 0) ui.ticker(`é–‰åº—æ™‚é–“ã€‚${kicked}çµ„ã‚’ãŠæ–­ã‚Šã—ã¾ã—ãŸã€‚`);
            ui.renderSeats(); ui.updateStaffPanel();
        }

        if (G.time >= 1320) {
            const eaters = G.seats.filter(s => s.occupied);
            if (eaters.length === 0) { game.endDay(); return; }
        } else {
            game.trySpawnCustomer();
        }
        
        ui.updateHeader();
        game.processCooking(); 

        G.seats.forEach((seat, idx) => {
            if (!seat.occupied) return;
            const c = seat.customer;

            if (seat.status === 'sitting') {
                seat.status = 'ordering';
                if (c.isTablet || !G.manualOrder) setTimeout(() => game.processOrder(idx), 500 / G.speed);
                else { ui.updateSeat(idx); ui.ticker(`å¸­${idx+1}: æ³¨æ–‡å¾…ã¡`); }
            } else if (seat.status === 'cooking') {
                const pending = c.order.filter(o => o.status !== 'served');
                if (pending.length === 0) {
                    seat.status = 'eating'; seat.progress = 0;
                    const sec = seat.realWaitTime; let sat = 60;
                    if (sec <= 4) sat = 100; else if (sec <= 6.25) sat = 75; else if (sec <= 10) sat = 60; else sat = 45;
                    if (G.trashBin) sat += 5; seat.satisfaction = sat;
                } else {
                    seat.realWaitTime = (seat.realWaitTime || 0) + 1;
                }
                ui.updateSeat(idx);
            } else if (seat.status === 'eating') {
                seat.progress += 5;
                if (seat.progress >= 30) { seat.status = 'paying'; game.processPayment(idx); }
            }
        });
        ui.updateStaffPanel();
    },

    processCooking: () => {
        const empLoad = new Array(G.employees.length).fill(0);
        G.seats.forEach(seat => {
            if (seat.occupied && seat.customer.order) {
                seat.customer.order.forEach(item => {
                    if (item.status === 'cooking' && item.chefIdx !== null) {
                        empLoad[item.chefIdx]++;
                    }
                });
            }
        });

        G.seats.forEach(seat => {
            if (seat.occupied && seat.status === 'cooking') {
                seat.customer.order.forEach(item => {
                    if (item.status === 'pending') {
                        const assignedChefs = G.kitchenMap[item.id] || [0];
                        let bestChef = -1;
                        let minLoad = 4; // Max 4
                        assignedChefs.forEach(cIdx => {
                            if (cIdx < G.employees.length && empLoad[cIdx] < minLoad) {
                                bestChef = cIdx;
                                minLoad = empLoad[cIdx];
                            }
                        });
                        if (bestChef !== -1) {
                            item.status = 'cooking';
                            item.chefIdx = bestChef;
                            item.progress = 0;
                            empLoad[bestChef]++;
                        }
                    } else if (item.status === 'cooking') {
                        const emp = EMPLOYEES[G.employees[item.chefIdx]];
                        const reqTime = (emp.wait * 60) / 5; 
                        item.progress += 5;
                        if (item.progress >= reqTime) {
                            item.status = 'served';
                            empLoad[item.chefIdx]--;
                        }
                    }
                });
            }
        });
    },

    trySpawnCustomer: () => {
        let rate = 10; const h = Math.floor(G.time / 60);
        if ((h >= 11 && h < 13)) rate += (G.weekDay >= 5) ? 30 : 10; 
        if (G.weekDay >= 5) rate += 20;
        let adBuff = 0;
        G.activeAds.forEach(ad => { if (ad.daysLeft > 0) adBuff += ad.buff; else if (ad.afterDays > 0) adBuff += ad.afterBuff; });
        rate += adBuff;
        if (G.reputation < 1.5) rate *= 0.4; else if (G.reputation < 2.5) rate *= 0.6; else if (G.reputation < 3.5) rate *= 0.8;

        if (Math.random() * 100 < rate) {
            const emptyIdx = G.seats.findIndex(s => !s.occupied);
            if (emptyIdx !== -1) {
                const groupSize = Math.floor(Math.random() * 4) + 1;
                const isTablet = Math.random() > 0.5;
                const img = IMAGES[Math.floor(Math.random() * IMAGES.length)];
                G.seats[emptyIdx] = { occupied: true, status: 'sitting', progress: 0, realWaitTime: 0, customer: { size: groupSize, isTablet: isTablet, img: img, order: [] } };
                ui.updateSeat(emptyIdx);
            }
        }
    },

    processOrder: (seatIdx) => {
        const seat = G.seats[seatIdx]; if (!seat) return;
        const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
        const count = Math.floor(Math.random() * 5) + 1; 
        const orderItems = [];
        for(let i=0; i<count; i++) {
            const m = menuList[Math.floor(Math.random() * menuList.length)];
            orderItems.push({ ...m, status: 'pending', progress: 0, chefIdx: null });
        }
        seat.customer.order = orderItems; seat.status = 'cooking'; 
        ui.updateSeat(seatIdx); ui.ticker(`å¸­${seatIdx+1}: ${count}å“æ³¨æ–‡`);
    },

    manualOrderClick: (seatIdx) => {
        const seat = G.seats[seatIdx];
        if (seat && seat.status === 'ordering' && !seat.customer.isTablet) {
            G.activeOrder = seatIdx; document.getElementById('order-customer-img').src = seat.customer.img;
            const menuList = MENUS[G.type].filter(m => G.menu.includes(m.id));
            const count = Math.floor(Math.random() * 5) + 1; 
            const orderItems = [];
            for(let i=0; i<count; i++) {
                const m = menuList[Math.floor(Math.random() * menuList.length)];
                orderItems.push({ ...m, status: 'pending', progress: 0, chefIdx: null });
            }
            seat.customer.order = orderItems;
            document.getElementById('order-text').innerHTML = `${count}å“ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼`;
            document.getElementById('modal-order').style.display = 'flex'; game.togglePause(true);
        }
    },

    confirmOrder: () => { document.getElementById('modal-order').style.display = 'none'; game.togglePause(false); if (G.activeOrder !== null) { G.seats[G.activeOrder].status = 'cooking'; ui.updateSeat(G.activeOrder); G.activeOrder = null; } },

    processPayment: (seatIdx) => {
        const seat = G.seats[seatIdx]; if (!seat) return;
        let totalProfit = 0; seat.customer.order.forEach(item => { totalProfit += item.price; }); totalProfit *= seat.customer.size; 
        G.money += totalProfit; G.totalEarnings += totalProfit; G.dailyRevenue += totalProfit;
        const sat = seat.satisfaction;
        G.reputation = (G.reputation * 0.9) + ((sat / 20) * 0.1); 
        if (G.reputation > 5) G.reputation = 5; if (G.reputation < 1) G.reputation = 1;
        G.seats[seatIdx] = { occupied: false, customer: null, status: 'empty' };
        ui.updateSeat(seatIdx); ui.updateHeader(); ui.ticker(`ä¼šè¨ˆ: Â¥${totalProfit.toLocaleString()}`);
    },

    endDay: () => {
        G.statsHistory.push({ day: G.day, revenue: G.dailyRevenue, assets: G.money, expense: G.dailyExpense });
        G.day++; G.weekDay = (G.weekDay + 1) % 7; G.time = 540; G.dailyRevenue = 0; G.dailyExpense = 0;
        bgm.play(); 
        
        G.activeAds.forEach(ad => {
            if (ad.daysLeft > 0) { ad.daysLeft--; if (ad.daysLeft === 0) { ad.afterDays = (ad.type === 'poster') ? 2 : (ad.type === 'flyer') ? 1 : (ad.type === 'cm') ? 3 : 5; } } else if (ad.afterDays > 0) { ad.afterDays--; }
        });
        G.activeAds = G.activeAds.filter(ad => ad.daysLeft > 0 || ad.afterDays > 0);

        if (G.day % 10 === 0) { 
            // å¾“æ¥­å“¡ã®ç¶­æŒè²»è¨ˆç®—
            let empCost = 0;
            G.employees.forEach(key => { empCost += EMPLOYEES[key].maintain; });
            const rent = 1000000;
            const totalFixed = rent + empCost;
            G.money -= totalFixed; 
            G.dailyExpense += totalFixed; 
            alert(`10æ—¥ã”ã¨ã®æ”¯æ‰•ã„æ—¥ã§ã™ã€‚\nå®¶è³ƒ: 100ä¸‡\näººä»¶è²»: ${empCost.toLocaleString()}\nåˆè¨ˆ: ${totalFixed.toLocaleString()}å††æ”¯æ‰•ã„ã¾ã—ãŸã€‚`); 
        }

        if (G.money < 2000000 && !G.bailoutUsed) { G.money += 5000000; G.bailoutUsed = true; alert('çµŒå–¶å±æ©Ÿã®ãŸã‚æ”¯æ´é‡‘500ä¸‡å††ã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚'); }

        game.checkWinLose();
        clearInterval(G.timerId);
        
        if(G.showResultPopup) {
            alert(`1æ—¥ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚\nå£²ä¸Š: Â¥${G.statsHistory[G.statsHistory.length-1].revenue.toLocaleString()}`);
        } else {
            ui.ticker(`1æ—¥çµ‚äº†ã€‚å£²ä¸Š: Â¥${G.statsHistory[G.statsHistory.length-1].revenue.toLocaleString()}`);
        }
        G.timerId = setInterval(game.loop, 1000 / G.speed);
    },

    checkWinLose: () => {
        if (G.money < 0) { game.gameOver("ç ´ç”£ã—ã¾ã—ãŸ..."); return; }
        if (!G.isCleared) {
            let clear = false;
            if (G.difficulty === 'hard') { if (G.reputation < 3.5) { game.gameOver("è©•ä¾¡ãŒä½ã™ãã¾ã™..."); return; } if (G.totalEarnings >= 15000000) clear = true; }
            else if (G.difficulty === 'normal') { if (G.totalEarnings >= 5000000) clear = true; }
            if (clear) {
                G.isCleared = true; G.money += 2000000;
                alert("ğŸ‰ ã‚¯ãƒªã‚¢æ¡ä»¶é”æˆï¼ ğŸ‰\nãƒœãƒ¼ãƒŠã‚¹200ä¸‡å††ã‚’ç²å¾—ï¼\nä¸Šé™40å¸­ã¾ã§æ‹¡å¼µå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼");
                ui.updateHeader();
            }
        }
    },
    
    gameOver: (msg) => { clearInterval(G.timerId); alert("GAME OVER\n" + msg); game.showHome(); },
    togglePause: (forceState) => { if (forceState !== undefined) { if (forceState) clearInterval(G.timerId); else G.timerId = setInterval(game.loop, 1000 / G.speed); } else { if (G.timerId) { clearInterval(G.timerId); G.timerId = null; } else G.timerId = setInterval(game.loop, 1000 / G.speed); } },
    saveGame: () => { const json = JSON.stringify(G); const blob = new Blob([json], {type: "application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "kitchen_tycoon_save.json"; a.click(); },
    loadGameData: (input) => { const file = input.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const loaded = JSON.parse(e.target.result); if(loaded.customMenus) { MENUS.fastfood = loaded.customMenus.fastfood; MENUS.restaurant = loaded.customMenus.restaurant; } G = loaded; 
        if(typeof Object.values(G.kitchenMap)[0] === 'number') settings.resetAssignments();
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active')); document.getElementById('screen-game').classList.add('active'); game.setSpeed(1); ui.updateModeBtn(); bgm.play(); ui.renderSeats(); ui.updateStaffPanel(); ui.updateHeader(); } catch (err) { alert("ãƒ‡ãƒ¼ã‚¿ç ´æ"); } }; reader.readAsText(file); },
    quitGame: () => { if(confirm("æœ¬å½“ã«ã‚„ã‚ã¾ã™ã‹ï¼Ÿ")) { clearInterval(G.timerId); game.showHome(); ui.closeModal('modal-menu'); } }
};

/* è¨­å®šãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— */
const setup = {
    updateMenuOptions: () => {
        const type = document.getElementById('setup-type').value; const list = document.getElementById('setup-menu-list'); list.innerHTML = '';
        MENUS[type].forEach(item => { const div = document.createElement('div'); div.className = 'item-select'; div.innerText = `${item.name} (${item.price})`; div.style.cssText = "background:#2980b9;padding:8px;border-radius:4px;font-size:0.8rem;cursor:pointer;text-align:center;width:30%;"; div.dataset.id = item.id; div.onclick = () => { if (div.classList.contains('selected')) { div.classList.remove('selected'); div.style.background = '#2980b9'; } else if (document.querySelectorAll('.item-select.selected').length < 5) { div.classList.add('selected'); div.style.background = '#2ecc71'; } }; list.appendChild(div); });
    },
    updateSizeOptions: () => {
        const loc = document.getElementById('setup-location').value; const max = LOCATIONS[loc].max; const select = document.getElementById('setup-seats'); select.innerHTML = '';
        for (let i = 4; i <= max; i+=2) { const op = document.createElement('option'); op.value = i; op.innerText = `${i}å¸­`; if (i===max) op.selected = true; select.appendChild(op); }
    }
};

const settings = {
    toggleOrderMode: () => { G.manualOrder = !G.manualOrder; document.getElementById('btn-order-mode').innerText = G.manualOrder ? "æ‰‹å‹•æ³¨æ–‡: ON" : "æ‰‹å‹•æ³¨æ–‡: OFF"; },
    togglePopup: () => { G.showResultPopup = !G.showResultPopup; document.getElementById('btn-toggle-popup').innerText = `1æ—¥çµ‚äº†æ™‚ã®çµæœè¡¨ç¤º: ${G.showResultPopup ? 'ON' : 'OFF'}`; },
    buyItem: (item) => { if (item === 'trash' && G.money >= 10000) { G.money -= 10000; G.dailyExpense += 10000; G.trashBin = true; alert("ã‚´ãƒŸç®±è¨­ç½®ï¼"); } else if (item === 'clean' && G.money >= 50000) { G.money -= 50000; G.dailyExpense += 50000; G.reputation += 0.2; alert("æ¸…æƒå®Œäº†ï¼"); } ui.updateHeader(); },
    hire: (type) => { const emp = EMPLOYEES[type]; if (G.money >= emp.cost) { G.money -= emp.cost; G.dailyExpense += emp.cost; G.employees.push(type); alert(`${emp.name}ã‚’é›‡ã„ã¾ã—ãŸï¼`); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); ui.updateStaffPanel(); ui.updateHeader(); } else alert("è³‡é‡‘ä¸è¶³"); },
    fire: (index) => { if (G.employees.length <= 1) { alert("æœ€å¾Œã®1äººã¯è§£é›‡ã§ãã¾ã›ã‚“"); return; } if(confirm("è§£é›‡ã—ã¾ã™ã‹ï¼Ÿ")) { G.employees.splice(index, 1); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); ui.updateStaffPanel(); ui.updateHeader(); } },
    renderEmployeeList: () => { const list = document.getElementById('current-employees-list'); list.innerHTML = ''; G.employees.forEach((key, idx) => { const data = EMPLOYEES[key]; const row = document.createElement('div'); row.className = 'emp-row'; row.innerHTML = `<span>${idx+1}. ${data.name}</span> <button onclick="settings.fire(${idx})">è§£é›‡</button>`; list.appendChild(row); }); },
    
    resetAssignments: () => {
        G.kitchenMap = {};
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã”ã¨ã«0(ãƒã‚¹ã‚¿ãƒ¼)ã‚’å‰²ã‚Šå½“ã¦
        if(G.menu) G.menu.forEach(mid => G.kitchenMap[mid] = [0]);
    },
    switchAssignTab: (tabId) => {
        document.querySelectorAll('.help-tab').forEach(t => t.classList.remove('active'));
        // ç°¡æ˜“ã‚¿ãƒ–åˆ¤å®š
        const tabs = document.querySelectorAll('.help-tab');
        let cat = 'main';
        if(tabId === 'assign-main') { tabs[3].classList.add('active'); cat = 'main'; }
        if(tabId === 'assign-side') { tabs[4].classList.add('active'); cat = 'side'; }
        if(tabId === 'assign-drink') { tabs[5].classList.add('active'); cat = 'drink'; }
        settings.renderAssignmentList(cat);
    },
    renderAssignmentList: (category = 'main') => {
        const list = document.getElementById('assignment-container'); list.innerHTML = '';
        const currentMenu = MENUS[G.type].filter(m => G.menu.includes(m.id) && m.cat === category);
        
        if (currentMenu.length === 0) {
            list.innerHTML = '<p style="padding:10px; text-align:center; color:#bdc3c7;">ã“ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            return;
        }

        currentMenu.forEach(item => {
            const row = document.createElement('div'); row.className = 'assign-row';
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'assign-name';
            nameDiv.innerText = item.name;
            
            const selectsDiv = document.createElement('div');
            selectsDiv.className = 'assign-selects';

            // 4æ ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹
            const assigned = G.kitchenMap[item.id] || [0]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0
            
            for(let i=0; i<4; i++) {
                const select = document.createElement('select');
                select.className = 'assign-select';
                
                // é¸æŠè‚¢: ã€Œãªã—ã€ + å…¨å¾“æ¥­å“¡
                const nullOpt = document.createElement('option');
                nullOpt.value = -1; nullOpt.innerText = "-";
                select.appendChild(nullOpt);

                G.employees.forEach((ekey, idx) => {
                    const opt = document.createElement('option');
                    opt.value = idx;
                    opt.innerText = `${idx+1}.${EMPLOYEES[ekey].name.substr(0,3)}`;
                    select.appendChild(opt);
                });

                // ç¾åœ¨ã®å‰²ã‚Šå½“ã¦ã‚’åæ˜ 
                if (i < assigned.length) select.value = assigned[i];
                else select.value = -1;

                // å¤‰æ›´æ™‚ã‚¤ãƒ™ãƒ³ãƒˆ
                select.onchange = () => {
                    // ç¾åœ¨ã®UIã®å…¨ã‚¹ãƒ­ãƒƒãƒˆã‹ã‚‰å€¤ã‚’åé›†ã—ã¦ä¿å­˜
                    const newAssign = [];
                    const selects = selectsDiv.querySelectorAll('select');
                    selects.forEach(s => {
                        const val = parseInt(s.value);
                        if(val !== -1) newAssign.push(val);
                    });
                    // æœ€ä½1äººã¯å¿…è¦(0)
                    if(newAssign.length === 0) {
                        newAssign.push(0);
                        selectsDiv.querySelectorAll('select')[0].value = 0;
                    }
                    G.kitchenMap[item.id] = newAssign;
                };
                selectsDiv.appendChild(select);
            }

            row.appendChild(nameDiv);
            row.appendChild(selectsDiv);
            list.appendChild(row);
        });
    },

    toggleMenuEdit: () => { const area = document.getElementById('menu-edit-area'); if (area.style.display === 'none') { area.style.display = 'block'; settings.renderMenuEditList(); } else area.style.display = 'none'; },
    renderMenuEditList: () => { const list = document.getElementById('menu-edit-list'); list.innerHTML = ''; MENUS[G.type].forEach(item => { const row = document.createElement('div'); row.className = 'menu-edit-row'; const isChecked = G.menu.includes(item.id) ? 'checked' : ''; row.innerHTML = `<label><input type="checkbox" class="menu-chk" value="${item.id}" ${isChecked}> ${item.name}</label><input type="number" id="price-${item.id}" value="${item.price}" min="10">`; list.appendChild(row); }); },
    saveMenuChanges: () => { 
        const checkboxes = document.querySelectorAll('.menu-chk:checked'); 
        if (checkboxes.length !== 5) { alert("5ã¤é¸æŠã—ã¦ãã ã•ã„"); return; } 
        MENUS[G.type].forEach(item => { const input = document.getElementById(`price-${item.id}`); if(input) item.price = parseInt(input.value); }); 
        G.menu = Array.from(checkboxes).map(cb => cb.value); 
        G.customMenus = { fastfood: MENUS.fastfood, restaurant: MENUS.restaurant }; 
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤‰æ›´æ™‚ã®æ•´åˆæ€§ç¢ºä¿
        G.menu.forEach(mid => { if(G.kitchenMap[mid] === undefined) G.kitchenMap[mid] = [0]; });
        alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°å®Œäº†"); settings.toggleMenuEdit(); 
    },
    expandSeats: (target) => {
        if ((target === 15 && G.totalEarnings < 100000) || (target === 20 && G.totalEarnings < 200000)) { alert("å®Ÿç¸¾ä¸è¶³"); return; }
        if (G.maxSeats >= target) { alert("æ‹¡å¼µæ¸ˆã¿"); return; }
        const added = target - G.maxSeats; G.maxSeats = target;
        for(let i=0; i<added; i++) G.seats.push({ occupied: false, customer: null, status: 'empty', waitTime: 0 });
        alert(`æ‹¡å¼µå®Œäº†ï¼${target}å¸­`); ui.renderSeats(); ui.updateSettingsButtons();
    },
    changeSeats: (delta) => {
        if(!G.isCleared) return;
        const current = G.maxSeats; const next = current + delta;
        if (next < 4) { alert("ã“ã‚Œä»¥ä¸Šæ¸›ã‚‰ã›ã¾ã›ã‚“"); return; } if (next > 40) { alert("æœ€å¤§40å¸­ã¾ã§ã§ã™"); return; }
        if (delta > 0) { for(let i=0; i<delta; i++) G.seats.push({ occupied: false, customer: null, status: 'empty', waitTime: 0 }); } 
        else { for(let i=0; i<Math.abs(delta); i++) G.seats.pop(); }
        G.maxSeats = next; ui.renderSeats(); ui.updateSettingsButtons();
    }
};

const ads = {
    start: (type) => {
        let cost=0, buff=0, dur=0; if(type==='poster'){cost=20000;buff=15;dur=2;} if(type==='flyer'){cost=50000;buff=20;dur=2;} if(type==='cm'){cost=200000;buff=25;dur=10;} if(type==='tv'){cost=500000;buff=25;dur=1;}
        if (G.money < cost) { alert("è³‡é‡‘ä¸è¶³"); return; }
        G.money -= cost; G.dailyExpense += cost;
        G.activeAds.push({ type: type, daysLeft: dur, buff: buff, afterBuff: 5, afterDays: 0 });
        if(type==='tv') G.activeAds[G.activeAds.length-1].afterBuff = 40; if(type==='cm') G.activeAds[G.activeAds.length-1].afterBuff = 20; 
        alert("å®£ä¼é–‹å§‹"); ui.updateHeader(); ui.closeModal('modal-ads');
    }
};

const stats = {
    range: 100, type: 'revenue',
    show: () => { document.getElementById('modal-stats').style.display = 'flex'; game.togglePause(true); stats.draw(); document.getElementById('stat-today-rev').innerText = `Â¥${G.dailyRevenue.toLocaleString()}`; document.getElementById('stat-today-exp').innerText = `Â¥${G.dailyExpense.toLocaleString()}`; },
    setRange: (r) => { stats.range = r; stats.draw(); },
    setType: (t) => { stats.type = t; document.getElementById('btn-graph-rev').classList.remove('active'); document.getElementById('btn-graph-asset').classList.remove('active'); if(t === 'revenue') document.getElementById('btn-graph-rev').classList.add('active'); else document.getElementById('btn-graph-asset').classList.add('active'); stats.draw(); },
    draw: () => {
        const canvas = document.getElementById('stats-canvas'); const ctx = canvas.getContext('2d'); const w = canvas.width = canvas.offsetWidth; const h = canvas.height = canvas.offsetHeight; ctx.clearRect(0,0,w,h);
        let data = [...G.statsHistory]; if (stats.range > 0 && data.length > stats.range) data = data.slice(data.length - stats.range);
        if (data.length < 2) { ctx.fillStyle = "#333"; ctx.font = "14px Arial"; ctx.fillText("ãƒ‡ãƒ¼ã‚¿ä¸è¶³ (2æ—¥ç›®ä»¥é™)", 20, 50); return; }
        let maxVal = 0, minVal = Infinity; data.forEach(d => { let val = (stats.type === 'revenue') ? d.revenue : d.assets; if(val > maxVal) maxVal = val; if(val < minVal) minVal = val; }); if (minVal > 0 && stats.type === 'revenue') minVal = 0;
        const padding = 20; ctx.beginPath(); ctx.strokeStyle = (stats.type === 'revenue') ? '#2ecc71' : '#f1c40f'; ctx.lineWidth = 2;
        data.forEach((d, i) => { let val = (stats.type === 'revenue') ? d.revenue : d.assets; let x = padding + (i / (data.length - 1)) * (w - padding * 2); let y = h - padding - ((val - minVal) / (maxVal - minVal || 1)) * (h - padding * 2); if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); }); ctx.stroke();
    }
};

const ui = {
    updateHeader: () => {
        const h = Math.floor(G.time / 60); const m = G.time % 60;
        document.getElementById('display-time').innerText = `Day ${G.day} (${DAYS[G.weekDay]}) ${('0'+h).slice(-2)}:${('0'+m).slice(-2)}`;
        document.getElementById('display-money').innerText = `Â¥${G.money.toLocaleString()}`;
        document.getElementById('display-earnings').innerText = `Â¥${G.totalEarnings.toLocaleString()}`;
        let stars = ""; for(let i=0; i<5; i++) stars += (i < Math.floor(G.reputation)) ? "â˜…" : "â˜†"; document.getElementById('display-stars').innerText = stars;
        let totalBuff = 0; G.activeAds.forEach(ad => { if (ad.daysLeft > 0) totalBuff += ad.buff; else if (ad.afterDays > 0) totalBuff += ad.afterBuff; }); document.getElementById('ad-buff-display').innerText = `å®£ä¼:+${totalBuff}%`;
        ui.updateSettingsButtons();
    },
    updateSettingsButtons: () => {
        const btn15 = document.getElementById('btn-expand-15'); const btn20 = document.getElementById('btn-expand-20');
        if (G.isCleared) {
            document.getElementById('expansion-normal').style.display = 'none';
            document.getElementById('expansion-cleared').style.display = 'block';
            document.getElementById('current-seats-display').innerText = `${G.maxSeats}å¸­`;
        } else {
            if(btn15 && btn20) {
                if(G.maxSeats >= 15) btn15.disabled = true; else btn15.disabled = (G.totalEarnings < 100000);
                if(G.maxSeats >= 20) btn20.disabled = true; else btn20.disabled = (G.totalEarnings < 200000);
            }
        }
    },
    renderSeats: () => {
        const con = document.getElementById('seats-container'); con.innerHTML = '';
        G.seats.forEach((seat, idx) => {
            const div = document.createElement('div'); div.className = 'seat'; div.id = `seat-${idx}`; div.onclick = () => game.manualOrderClick(idx);
            const info = document.createElement('div'); info.className = 'seat-status'; info.id = `seat-info-${idx}`; info.innerText = 'ç©ºå¸­';
            div.appendChild(info); con.appendChild(div);
        });
    },
    updateSeat: (idx) => {
        const seat = G.seats[idx]; const div = document.getElementById(`seat-${idx}`); const info = document.getElementById(`seat-info-${idx}`);
        if(!div) return;
        if (seat.occupied) {
            div.classList.add('occupied'); div.style.backgroundImage = `url(${seat.customer.img})`; div.style.backgroundSize = 'contain'; div.style.backgroundRepeat = 'no-repeat'; div.style.backgroundPosition = 'center';
            let txt = "";
            if (seat.status === 'sitting') txt = "ç€å¸­"; else if (seat.status === 'ordering') txt = "æ³¨æ–‡"; 
            else if (seat.status === 'cooking') {
                const remain = seat.customer.order.filter(o => o.status !== 'served').length;
                txt = `èª¿ç†(${remain})`;
            }
            else if (seat.status === 'eating') txt = "é£Ÿäº‹"; else if (seat.status === 'paying') txt = "ä¼šè¨ˆ";
            info.innerText = txt;
        } else { div.classList.remove('occupied'); div.style.backgroundImage = 'none'; info.innerText = 'ç©ºå¸­'; }
    },
    updateStaffPanel: () => {
        const con = document.getElementById('staff-container'); con.innerHTML = '';
        const empLoad = new Array(G.employees.length).fill(0);
        G.seats.forEach(seat => {
            if(seat.occupied && seat.customer.order) {
                seat.customer.order.forEach(item => {
                    if(item.status==='cooking' && item.chefIdx !== null) empLoad[item.chefIdx]++;
                });
            }
        });

        G.employees.forEach((key, idx) => {
            const load = empLoad[idx];
            const data = EMPLOYEES[key];
            const div = document.createElement('div');
            div.className = `staff-card ${load > 0 ? 'busy' : 'free'}`;
            div.innerHTML = `<div>${idx+1}. ${data.name}</div><div class="staff-status-text">${load}/4 èª¿ç†</div>`;
            con.appendChild(div);
        });
    },
    ticker: (msg) => { document.getElementById('ticker').innerText = msg; },
    toggleMenu: () => { document.getElementById('modal-menu').style.display = 'flex'; game.togglePause(true); },
    toggleSettings: () => { document.getElementById('modal-settings').style.display = 'flex'; game.togglePause(true); settings.renderEmployeeList(); document.getElementById('menu-edit-area').style.display = 'none'; ui.updateSettingsButtons(); },
    toggleEmployees: () => { document.getElementById('modal-employees').style.display = 'flex'; game.togglePause(true); settings.renderEmployeeList(); settings.switchAssignTab('assign-main'); },
    toggleAds: () => { document.getElementById('modal-ads').style.display = 'flex'; game.togglePause(true); ui.updateHeader(); },
    toggleHelp: () => { document.getElementById('modal-help').style.display = 'flex'; ui.switchHelpTab('tab-basic'); game.togglePause(true); },
    switchHelpTab: (tabId) => {
        document.querySelectorAll('.help-section').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        const tabs = document.querySelectorAll('.help-tab');
        tabs.forEach(t => t.classList.remove('active'));
        if(tabId === 'tab-basic') tabs[0].classList.add('active');
        if(tabId === 'tab-how') tabs[1].classList.add('active');
        if(tabId === 'tab-staff') tabs[2].classList.add('active');
        if(tabId === 'tab-biz') tabs[3].classList.add('active');
    },
    toggleMode: () => { 
        const c = document.getElementById('game-container'); 
        if (G.mode === 'pc') { c.classList.remove('pc-mode'); G.mode = 'mobile'; } 
        else { c.classList.add('pc-mode'); G.mode = 'pc'; } 
        ui.updateModeBtn();
    },
    updateModeBtn: () => {
        const btn = document.getElementById('btn-mode-toggle');
        if(G.mode === 'pc') btn.innerText = "ğŸ’» PC"; else btn.innerText = "ğŸ“± ã‚¹ãƒãƒ›";
    },
    closeModal: (id) => { document.getElementById(id).style.display = 'none'; game.togglePause(false); }
};

if (window.innerWidth > 768) { document.getElementById('game-container').classList.add('pc-mode'); G.mode = 'pc'; }
game.showHome();
</script>
</body>
</html>
